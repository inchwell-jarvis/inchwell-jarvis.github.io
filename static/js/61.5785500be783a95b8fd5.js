webpackJsonp([61],{"/kME":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("mvHQ"),a=n.n(i),o=n("BO1k"),r=n.n(o),u={data:function(){return{Id:"",EquDtos:[],returnEquipment:[],buyEquipment:[],textarea:"",drawer:!1,databasebool:!1}},created:function(){var t=this;console.log(this.$route.query),this.Id=this.$route.query.Id,this.EquDtos=this.$route.query.EquDtos,this.EquDtos.forEach(function(e){t.$set(e,"Quantity2",e.Quantity)})},mounted:function(){},computed:{totalReturnEquipmentValue:function(){return this.returnEquipment.reduce(function(t,e){return t+e.Quantity2*e.DiscountPrice},0).toFixed(2)},totalBuyEquipmentValue:function(){return this.buyEquipment.reduce(function(t,e){return t+e.Quantity*e.DiscountPrice},0).toFixed(2)}},watch:{},methods:{choose:function(t){1===t?this.drawer=!0:this.databasebool=!0,console.log(this.EquDtos)},database:function(t){var e=this;console.log(t);var n=function(t){var n=e.buyEquipment.findIndex(function(e){return e.ID===t.ID});-1!==n?e.buyEquipment[n].Quantity+=t.Quantity:(e.$set(t,"Discount",100),e.$set(t,"DiscountPrice",t.UnitPrice),e.buyEquipment.push(t))},i=!0,a=!1,o=void 0;try{for(var u,l=r()(t);!(i=(u=l.next()).done);i=!0){n(u.value)}}catch(t){a=!0,o=t}finally{try{!i&&l.return&&l.return()}finally{if(a)throw o}}console.log(this.buyEquipment)},returnQuantity:function(t,e,n){if("Del"==e||"Add"==e){if(1==t.Quantity2&&"Del"==e)return this.$message.warning("最少退回一个！");if(t.Quantity2==t.Quantity&&"Add"==e)return this.$message.warning("最多退回购买量！");t.Quantity2="Del"==e?t.Quantity2-1:t.Quantity2+1}"saxo"==e&&(t.Quantity2=n)},UpdateMSOEquPrice:function(t,e,n){if("Del"==e||"Add"==e){if(1==t.Quantity&&"Del"==e)return this.$message.warning("最少购买一个！");t.Quantity="Del"==e?t.Quantity-1:t.Quantity+1}"saxo"==e&&(t.Quantity=Number(n))},UpdateMSOEquPrice2:function(t,e,n){if("Del"==e||"Add"==e){if(1==t.Quantity2&&"Del"==e)return this.$message.warning("最少退回一个！");if(t.Quantity2==t.Quantity&&"Add"==e)return this.$message.warning("最多退回购买量！");t.Quantity2="Del"==e?t.Quantity2-1:t.Quantity2+1}"saxo"==e&&(t.Quantity2=Number(n))},Check:function(t){var e=JSON.parse(a()(t)),n=this.returnEquipment.findIndex(function(t){return t.ID===e.ID});-1!==n?this.returnEquipment[n].Quantity2+=e.Quantity2:this.returnEquipment.push(e)},dele:function(t,e){1===e?this.returnEquipment=this.returnEquipment.filter(function(e){return e.ID!==t.ID}):this.buyEquipment=this.buyEquipment.filter(function(e){return e.ID!==t.ID})},modifyDiscount:function(t){t.DiscountPrice=t.UnitPrice*(t.Discount/100)},confirm:function(){var t=this;if(!this.returnEquipment.length&&!this.buyEquipment.length)return this.$message.warning("退回设备与换新设备至少选其一！");var e=[],n=0;this.returnEquipment.forEach(function(t){e.push({NewOrOri:1,TotalAmount:t.Quantity2*t.DiscountPrice,ProId:t.ProductId,OriginalPrice:t.OriginalPrice,Discount:t.Discount,DiscountPrice:t.DiscountPrice,Quantity:t.Quantity2,Desc:t.Describe2,ProCode:t.ProductCode}),n+=t.Quantity2*t.DiscountPrice,console.log(t)});var i=0;this.buyEquipment.forEach(function(t){e.push({NewOrOri:2,TotalAmount:t.Quantity*t.DiscountPrice,ProId:t.ID,OriginalPrice:t.UnitPrice,Discount:t.Discount,DiscountPrice:t.DiscountPrice,Quantity:t.Quantity,Desc:t.Characteristics,ProCode:t.ProductCode}),i+=t.Quantity*t.DiscountPrice,console.log(t)}),console.log(e),console.log(n-i);var a={Id:this.Id,chaAmount:Number((n-i).toFixed(2)),Memo:this.textarea,Dtos:e};console.log(a),this.API_POST("MachineSO/MsoEquChange",a).then(function(e){t.$message.success(e.split("：")[1]),t.$emit("refresh"),t.$router.push({path:"/machine-sales-edit"})})}},beforeCreate:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){},destroyed:function(){},activated:function(){}},l={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("SaxoPage",{scopedSlots:t._u([{key:"title",fn:function(){return[n("saxo-button",{attrs:{mini:"",type:"success"},on:{click:t.confirm}},[t._v("申请")])]},proxy:!0},{key:"content",fn:function(){return[n("div",{staticClass:"alert"},[n("i",{staticClass:"el-icon-warning"}),t._v(" "),n("h4",[t._v("温馨提示")]),t._v(" "),n("p",[t._v("1.有过库存相关的操作，无法退换")]),t._v(" "),n("p",[t._v("2.已拿过奖金且导致合同总金额发生变化，无法退换")])]),t._v(" "),n("h3",[t._v("退回设备\n            "),n("saxo-button",{attrs:{type:"success",mini:"",plain:""},on:{click:function(e){return t.choose(1)}}},[n("i",{staticClass:"el-icon-plus"})])],1),t._v(" "),n("el-table",{staticStyle:{width:"100%"},attrs:{data:t.returnEquipment,stripe:"","header-cell-style":t.$store.state.headerCellStyle,size:"mini"}},[n("el-table-column",{attrs:{label:"序号",type:"index",width:"60"}}),t._v(" "),n("el-table-column",{attrs:{prop:"ProductCode",label:"对内编码",width:"150"}}),t._v(" "),n("el-table-column",{attrs:{prop:"LongCode",label:"对外编码",width:"150"}}),t._v(" "),n("el-table-column",{attrs:{prop:"Brand",label:"品牌",width:"120"}}),t._v(" "),n("el-table-column",{attrs:{prop:"Describe2",label:"描述","show-overflow-tooltip":!0}}),t._v(" "),n("el-table-column",{attrs:{label:"原始单价","header-align":"center",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("span",{staticStyle:{float:"right"}},[t._v(" "+t._s("￥"+e.row.OriginalPrice.toFixed(2)))])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"折扣",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("span",[t._v(" "+t._s(e.row.Discount)+" %")])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"优惠后单价","header-align":"center",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("span",{staticStyle:{float:"right"}},[t._v(" "+t._s("￥"+e.row.DiscountPrice.toFixed(2)))])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"优惠后合计","header-align":"center",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("span",{staticStyle:{float:"right"}},[t._v(" "+t._s("￥"+(e.row.DiscountPrice*e.row.Quantity2).toFixed(2)))])]}}])}),t._v(" "),n("el-table-column",{attrs:{fixed:"right",label:"数量",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("div",{attrs:{id:"Number_input"}},[n("div",{staticClass:"div_icon_text",on:{click:function(n){return t.UpdateMSOEquPrice2(e.row,"Del")}}},[n("i",{staticClass:"el-icon-minus"})]),t._v(" "),n("div",{staticClass:"div_icon_textConter"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.row.Quantity2,expression:"scope.row.Quantity2"}],staticStyle:{"text-align":"center","border-style":"none",outline:"none",width:"100%"},attrs:{type:"text",name:"",id:""},domProps:{value:e.row.Quantity2},on:{blur:function(n){return t.UpdateMSOEquPrice2(e.row,"saxo",e.row.Quantity2)},input:function(n){n.target.composing||t.$set(e.row,"Quantity2",n.target.value)}}})]),t._v(" "),n("div",{staticClass:"div_icon_text",on:{click:function(n){return t.UpdateMSOEquPrice2(e.row,"Add")}}},[n("i",{staticClass:"el-icon-plus"})])])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"操作",fixed:"right",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("saxo-button",{attrs:{mini:"",type:"danger"},on:{click:function(n){return t.dele(e.row,1)}}},[t._v("删除")])]}}])})],1),t._v(" "),n("h3",[t._v("换新设备\n            "),n("saxo-button",{attrs:{type:"success",mini:"",plain:""},on:{click:function(e){return t.choose()}}},[n("i",{staticClass:"el-icon-plus"})])],1),t._v(" "),n("el-table",{staticStyle:{width:"100%"},attrs:{data:t.buyEquipment,stripe:"","header-cell-style":t.$store.state.headerCellStyle,size:"mini"}},[n("el-table-column",{attrs:{label:"序号",type:"index",width:"60"}}),t._v(" "),n("el-table-column",{attrs:{prop:"ProductCode",label:"产品编号",width:"170"}}),t._v(" "),n("el-table-column",{attrs:{label:"内部编码",width:"140"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("p",{domProps:{innerHTML:t._s(e.row.BarcodeMemo)}})]}}])}),t._v(" "),n("el-table-column",{attrs:{prop:"Manufacturer",label:"品牌",width:"120"}}),t._v(" "),n("el-table-column",{attrs:{prop:"Characteristics",label:"描述","show-overflow-tooltip":!0}}),t._v(" "),n("el-table-column",{attrs:{label:"原始单价","header-align":"center",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("span",{staticStyle:{float:"right"}},[t._v(" "+t._s("￥"+e.row.UnitPrice.toFixed(2)))])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"折扣",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-input",{staticStyle:{"max-width":"100px"},attrs:{size:"mini",placeholder:"折扣"},on:{change:function(n){return t.modifyDiscount(e.row)}},model:{value:e.row.Discount,callback:function(n){t.$set(e.row,"Discount",n)},expression:"scope.row.Discount"}},[n("i",{staticStyle:{"line-height":"30px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("%")])])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"优惠后单价","header-align":"center",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("span",{staticStyle:{float:"right"}},[t._v(" "+t._s("￥"+e.row.DiscountPrice.toFixed(2)))])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"优惠后合计","header-align":"center",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("span",{staticStyle:{float:"right"}},[t._v(" "+t._s("￥"+(e.row.DiscountPrice*e.row.Quantity).toFixed(2)))])]}}])}),t._v(" "),n("el-table-column",{attrs:{fixed:"right",label:"数量",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("div",{attrs:{id:"Number_input"}},[n("div",{staticClass:"div_icon_text",on:{click:function(n){return t.UpdateMSOEquPrice(e.row,"Del")}}},[n("i",{staticClass:"el-icon-minus"})]),t._v(" "),n("div",{staticClass:"div_icon_textConter"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.row.Quantity,expression:"scope.row.Quantity"}],staticStyle:{"text-align":"center","border-style":"none",outline:"none",width:"100%"},attrs:{type:"text",name:"",id:""},domProps:{value:e.row.Quantity},on:{blur:function(n){return t.UpdateMSOEquPrice(e.row,"saxo",e.row.Quantity)},input:function(n){n.target.composing||t.$set(e.row,"Quantity",n.target.value)}}})]),t._v(" "),n("div",{staticClass:"div_icon_text",on:{click:function(n){return t.UpdateMSOEquPrice(e.row,"Add")}}},[n("i",{staticClass:"el-icon-plus"})])])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"操作",fixed:"right",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("saxo-button",{attrs:{mini:"",type:"danger"},on:{click:function(n){return t.dele(e.row,2)}}},[t._v("删除")])]}}])})],1),t._v(" "),n("div",{staticStyle:{width:"100%"}},[n("div",{staticStyle:{width:"50%",float:"left"}},[n("h3",[t._v("备注")]),t._v(" "),n("el-input",{staticStyle:{width:"500px"},attrs:{type:"textarea",rows:6,placeholder:"请输入内容"},model:{value:t.textarea,callback:function(e){t.textarea=e},expression:"textarea"}})],1),t._v(" "),n("div",{staticStyle:{width:"50%",float:"left"}},[n("h3",[t._v("差额")]),t._v(" "),n("p",{staticStyle:{"font-size":"16px"}},[n("span",{staticStyle:{"margin-right":"10px"}}),t._v("\n                    "+t._s(t.totalReturnEquipmentValue)+"\n                    "),n("span",{staticStyle:{"margin-right":"10px"}}),t._v("\n                    -\n                    "),n("span",{staticStyle:{"margin-right":"10px"}}),t._v("\n                    "+t._s(t.totalBuyEquipmentValue)+"\n                    "),n("span",{staticStyle:{"margin-right":"10px"}}),t._v("\n                    =\n                    "),n("span",{staticStyle:{"margin-right":"10px"}}),t._v("\n                    "+t._s((t.totalReturnEquipmentValue-t.totalBuyEquipmentValue).toFixed(2))+"\n                ")])])]),t._v(" "),n("SaxoDrawer",{attrs:{show:t.drawer,title:"退回设备"},on:{ShowFalse:function(e){t.drawer=!1}}},[n("el-table",{staticStyle:{width:"100%"},attrs:{data:t.EquDtos,size:"mini",stripe:"",height:"100%"}},[n("el-table-column",{attrs:{label:"序号",type:"index",width:"60"}}),t._v(" "),n("el-table-column",{attrs:{prop:"ProductCode",label:"对内编码",width:"150"}}),t._v(" "),n("el-table-column",{attrs:{prop:"LongCode",label:"对外编码",width:"150"}}),t._v(" "),n("el-table-column",{attrs:{prop:"Describe2",label:"描述","show-overflow-tooltip":!0}}),t._v(" "),n("el-table-column",{attrs:{label:"原始单价","header-align":"center",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("span",{staticStyle:{float:"right"}},[t._v(" "+t._s("￥"+e.row.OriginalPrice.toFixed(2)))])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"优惠后单价","header-align":"center",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("span",{staticStyle:{float:"right"}},[t._v(" "+t._s("￥"+e.row.DiscountPrice.toFixed(2)))])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"优惠后合计","header-align":"center",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("span",{staticStyle:{float:"right"}},[t._v(" "+t._s("￥"+(e.row.DiscountPrice*e.row.Quantity).toFixed(2)))])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"数量",width:"70",prop:"Quantity"}}),t._v(" "),n("el-table-column",{attrs:{fixed:"right",label:"退回数量",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("div",{attrs:{id:"Number_input"}},[n("div",{staticClass:"div_icon_text",on:{click:function(n){return t.returnQuantity(e.row,"Del")}}},[n("i",{staticClass:"el-icon-minus"})]),t._v(" "),n("div",{staticClass:"div_icon_textConter"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.row.Quantity2,expression:"scope.row.Quantity2"}],staticStyle:{"text-align":"center","border-style":"none",outline:"none",width:"100%"},attrs:{type:"text"},domProps:{value:e.row.Quantity2},on:{blur:function(n){return t.returnQuantity(e.row,"saxo",e.row.Quantity2)},input:function(n){n.target.composing||t.$set(e.row,"Quantity2",n.target.value)}}})]),t._v(" "),n("div",{staticClass:"div_icon_text",on:{click:function(n){return t.returnQuantity(e.row,"Add")}}},[n("i",{staticClass:"el-icon-plus"})])])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"已发量",width:"70",prop:"NoSentQuantity"}}),t._v(" "),n("el-table-column",{attrs:{label:"操作",width:"100px",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("saxo-button",{attrs:{mini:"",type:"primary"},on:{click:function(n){return t.Check(e.row)}}},[t._v("添加")])]}}])})],1)],1),t._v(" "),n("DeviceDatabase",{attrs:{show:t.databasebool,protype:"6"},on:{ShowFalse:function(e){t.databasebool=!1},DataBase:t.database}})]},proxy:!0}])})},staticRenderFns:[]};var s=n("VU/8")(u,l,!1,function(t){n("pqCJ")},"data-v-984dbae8",null);e.default=s.exports},pqCJ:function(t,e){}});