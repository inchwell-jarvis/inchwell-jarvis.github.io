webpackJsonp([154],{"/NKK":function(t,e){},MTMp:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("Gu7T"),a=n.n(r),i=n("gRE1"),o=n.n(i),l=n("Xxa5"),c=n.n(l),s=n("//Fk"),u=n.n(s),d=n("exGp"),h=n.n(d),f=n("BO1k"),p=n.n(f),v={data:function(){return{data:[],checkedCities:!1,checkedList:[],expandedRowKeys:[],selectAll:!1,isIndeterminate:!1,colorIndex:0,colors:["#67C23A","#E6A23C","#F56C6C","#909399","#409EFF","#005bea","#6e45e2","#f83600"]}},created:function(){this.start()},mounted:function(){},computed:{},watch:{data:{deep:!0,handler:function(t,e){this.checkedList=t.filter(function(t){return t.checked})}}},methods:{handleCheckChange:function(t){var e=this.data.filter(function(e){return e.MergeId===t.MergeId&&e.MergeId}),n=!0,r=!1,a=void 0;try{for(var i,o=p()(e);!(n=(i=o.next()).done);n=!0){i.value.checked=t.checked}}catch(t){r=!0,a=t}finally{try{!n&&o.return&&o.return()}finally{if(r)throw a}}var l=this.data.filter(function(t){return t.checked}).length;this.isIndeterminate=l>0&&l<this.data.length,this.selectAll=l==this.data.length},handleSelectAllChange:function(t){console.log(t);var e=!0,n=!1,r=void 0;try{for(var a,i=p()(this.data);!(e=(a=i.next()).done);e=!0){a.value.checked=t}}catch(t){n=!0,r=t}finally{try{!e&&i.return&&i.return()}finally{if(n)throw r}}var o=this.data.filter(function(t){return t.checked}).length;this.isIndeterminate=o>0&&o<this.data.length,this.selectAll=o==this.data.length},start:function(){var t=h()(c.a.mark(function t(){var e,n,r,a,i,o=this;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e={search:"",buyer:"",paystate:1,invoicestate:-1,auditstate:-1,pageNum:1,numPerPage:20,orderField:"",orderDirection:"",forTo:"index"},t.next=3,this.API_GET("MachineSO/GetFinanceMPOPays",e);case 3:return n=t.sent,r=n.MachinePOPayDtos.map(function(t){return t.ID}),t.next=7,u.a.all(r.map(function(t){return o.GetFinanceMPOPays(t)}));case 7:for(this.data=t.sent,a=0;a<this.data.length;a++)i=this.data[a],this.$set(i,"checked",!1),i.CreateDate=i.CreateDate.split("T")[0],i.ConfirmDt&&(i.ConfirmDt=i.ConfirmDt.split("T")[0]),i.AuditorA&&(i.AuditorA=i.AuditorA.split("/")[0].slice(0,i.AuditorA.split("/")[0].length-4)),i.AuditorB&&(i.AuditorB=i.AuditorB.split("/")[0].slice(0,i.AuditorB.split("/")[0].length-4)),i.AuditorC&&(i.AuditorC=i.AuditorC.split("/")[0].slice(0,i.AuditorC.split("/")[0].length-4)),i.AuditorD&&(i.AuditorD=i.AuditorD.split("/")[0].slice(0,i.AuditorD.split("/")[0].length-4));this.data=this.sortByMergeId(this.data),console.log(this.data);case 11:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),generateRandomColor:function(){var t=this.colors[this.colorIndex];return this.colorIndex=(this.colorIndex+1)%this.colors.length,t},sortByMergeId:function(t){var e,n=[],r=[],i=!0,l=!1,c=void 0;try{for(var s,u=p()(t);!(i=(s=u.next()).done);i=!0){var d=s.value;void 0!==d.MergeId&&null!==d.MergeId?n.push(d):r.push(d)}}catch(t){l=!0,c=t}finally{try{!i&&u.return&&u.return()}finally{if(l)throw c}}var h={},f=!0,v=!1,y=void 0;try{for(var m,g=p()(n);!(f=(m=g.next()).done);f=!0){var b=m.value;b.MergeId in h?h[b.MergeId].push(b):h[b.MergeId]=[b]}}catch(t){v=!0,y=t}finally{try{!f&&g.return&&g.return()}finally{if(v)throw y}}var w=o()(h),k=!0,_=!1,x=void 0;try{for(var A,C=p()(w);!(k=(A=C.next()).done);k=!0){var M=A.value,P=this.generateRandomColor(),I=!0,O=!1,S=void 0;try{for(var D,F=p()(M);!(I=(D=F.next()).done);I=!0){D.value.bgcolor=P}}catch(t){O=!0,S=t}finally{try{!I&&F.return&&F.return()}finally{if(O)throw S}}}}catch(t){_=!0,x=t}finally{try{!k&&C.return&&C.return()}finally{if(_)throw x}}var B=!0,R=!1,K=void 0;try{for(var T,G=p()(r);!(B=(T=G.next()).done);B=!0){T.value.bgcolor=""}}catch(t){R=!0,K=t}finally{try{!B&&G.return&&G.return()}finally{if(R)throw K}}return[].concat(a()((e=[]).concat.apply(e,a()(w))),r)},GetFinanceMPOPays:function(){var t=h()(c.a.mark(function t(e){var n,r;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n={id:e,search:"",buyer:"",paystate:-1,invoicestate:-1,auditstate:-1,pageNum:1,numPerPage:30,memo:"",orderField:"",orderDirection:""},t.next=3,this.API_GET("MachineSO/GetFinanceMPOPays",n);case 3:return(r=t.sent).MachinePOPayDtos[0].Files=r.MachinePOFiles,t.abrupt("return",r.MachinePOPayDtos[0]);case 6:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),MPOApproval:function(){var t=h()(c.a.mark(function t(e,n){var r,a,i=this,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments[3];return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this.data.reduce(function(t,n){return n.MergeId===e.MergeId&&null!=e.MergeId&&t++,t},0),console.log(r),o||l.stopPropagation(),o||!(r>1)){t.next=5;break}return t.abrupt("return",this.$message.success("合并订单只能通过全选后批量审核！"));case 5:return a={Id:e.ID,Other:e.Memo,Str:n},t.next=8,this.API_POST("MachineSO/MPOPayAuditC",a,!1).then(function(t){o||(i.$message.success("审核成功！"),i.start())});case 8:case"end":return t.stop()}},t,this)}));return function(e,n){return t.apply(this,arguments)}}(),review:function(){var t=h()(c.a.mark(function t(e){var n=this;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.a.all(this.checkedList.map(function(t){return n.MPOApproval(t,e,!0)}));case 2:this.start(),this.$message.success("审核成功！");case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),handleRowClick:function(t){this.expandedRowKeys.includes(t.ID)?this.expandedRowKeys=this.expandedRowKeys.filter(function(e){return e!==t.ID}):this.expandedRowKeys.push(t.ID)}},beforeCreate:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){},destroyed:function(){},activated:function(){}},y={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"box"},[n("SaxoPage",{scopedSlots:t._u([{key:"title",fn:function(){return[t.checkedList.length>0?n("saxo-button",{attrs:{mini:"",type:"primary"},on:{click:function(e){return t.review(1)}}},[t._v("批量付款 ("+t._s(t.checkedList.length)+")")]):t._e(),t._v(" "),t.checkedList.length>0?n("saxo-button",{attrs:{mini:"",type:"danger"},on:{click:function(e){return t.review(0)}}},[t._v("批量驳回 ("+t._s(t.checkedList.length)+")")]):t._e()]},proxy:!0},{key:"content",fn:function(){return[n("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{"expand-row-keys":t.expandedRowKeys,data:t.data,"row-key":function(t){return t.ID},"header-cell-style":t.$store.state.headerCellStyle,"cell-style":t.$store.state.cellStyle,stripe:"",height:"100%"},on:{"row-click":t.handleRowClick}},[n("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("div",{staticClass:"device_information"},[n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.row.MachinePOEquDtos,stripe:"",size:"mini"}},[n("el-table-column",{attrs:{prop:"Describe",label:"设备描述","show-overflow-tooltip":!0}}),t._v(" "),n("el-table-column",{attrs:{prop:"Brand",label:"品牌",width:"200"}}),t._v(" "),n("el-table-column",{attrs:{prop:"POQuantity",label:"数量",width:"100"}}),t._v(" "),n("el-table-column",{attrs:{label:"价格",width:"150"},scopedSlots:t._u([{key:"default",fn:function(r){return[n("span",{staticStyle:{float:"right"}},[t._v(t._s(t.FinancialAmountFormat(r.row.UnitPrice,t.FinancialAmountSymbol(e.row.BuyingCurrency))))])]}}],null,!0)})],1),t._v(" "),t._l(e.row.Files,function(e){return n("p",{key:e.FileUrl,staticStyle:{"text-align":"right","line-height":"30px"}},[n("el-link",{attrs:{type:"primary",underline:!1,href:"http://icms.inchwell.com.cn"+e.FileUrl,target:"_blank"}},[t._v(t._s(e.FileName))])],1)})],2)]}}])}),t._v(" "),n("el-table-column",{attrs:{prop:"CusFullName",label:"供应商名称","show-overflow-tooltip":!0}}),t._v(" "),n("el-table-column",{attrs:{prop:"BelongCompany",label:"隶属公司",width:"100"}}),t._v(" "),n("el-table-column",{attrs:{prop:"CreateDate",label:"创建时间",width:"100"}}),t._v(" "),n("el-table-column",{attrs:{label:"付款金额",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("span",{staticStyle:{float:"right"}},[t._v(" "+t._s(t.FinancialAmountFormat(e.row.Amount,t.FinancialAmountSymbol(e.row.BuyingCurrency))))])]}}])}),t._v(" "),n("el-table-column",{attrs:{prop:"AuditorA",label:"付款",width:"100"}}),t._v(" "),n("el-table-column",{attrs:{prop:"AuditorB",label:"审核付款",width:"80"}}),t._v(" "),n("el-table-column",{attrs:{prop:"AuditorC",label:"批准付款",width:"80"}}),t._v(" "),n("el-table-column",{attrs:{prop:"Buyer",label:"采购员",width:"80"}}),t._v(" "),n("el-table-column",{attrs:{prop:"POCode",label:"采购单编号",width:"160"}}),t._v(" "),n("el-table-column",{attrs:{prop:"Memo",label:"备注",width:"200","show-overflow-tooltip":!0}}),t._v(" "),n("el-table-column",{attrs:{label:"是否合并",width:"90"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("nav",{staticStyle:{"text-align":"center"}},[e.row.bgcolor?n("el-tag",{style:{background:e.row.bgcolor?e.row.bgcolor:"",color:"transparent"},attrs:{size:"mini"}},[t._v("++++")]):t._e()],1)]}}])}),t._v(" "),n("el-table-column",{attrs:{width:"70"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-checkbox",{on:{change:function(n){return t.handleCheckChange(e.row)}},model:{value:e.row.checked,callback:function(n){t.$set(e.row,"checked",n)},expression:"scope.row.checked"}})]}},{key:"header",fn:function(){return[n("el-checkbox",{attrs:{indeterminate:t.isIndeterminate},on:{change:t.handleSelectAllChange},model:{value:t.selectAll,callback:function(e){t.selectAll=e},expression:"selectAll"}})]},proxy:!0}])}),t._v(" "),n("el-table-column",{attrs:{label:"操作",fixed:"right",width:"160"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("saxo-button",{attrs:{mini:"",type:"danger"},nativeOn:{click:function(n){return t.MPOApproval(e.row,0,!1,n)}}},[t._v("驳回")]),t._v(" "),n("saxo-button",{attrs:{mini:"",type:"primary"},nativeOn:{click:function(n){return t.MPOApproval(e.row,1,!1,n)}}},[t._v("付款")])]}}])})],1)]},proxy:!0}])})],1)},staticRenderFns:[]};var m=n("VU/8")(v,y,!1,function(t){n("/NKK")},"data-v-2b7409ba",null);e.default=m.exports}});