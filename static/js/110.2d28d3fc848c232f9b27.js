webpackJsonp([110],{"24S/":function(t,e){},PQs9:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=a("Dd8w"),n=a.n(l),i=a("mvHQ"),s=a.n(i),o={data:function(){return{create:{},MCSupplieStatDtos:[],numberOfDevicesData:[],selectedDevices:[],meno:"",gridData:[],MCEquSupplieData:[],DetailDtos:[],LInKman:{ChineseName:"",MobilePhone:"",EMail:"",Address:""},explanation:!1}},created:function(){this.create=this.$route.query.rv,console.log(this.create),this.start(),this.GetMCEquSupplie(),this.GetAllSupplies()},mounted:function(){},computed:{numberOfDevicesDataStr:function(){return s()(this.numberOfDevicesData)}},watch:{numberOfDevicesDataStr:function(t){var e=this,a=JSON.parse(t);this.selectedDevices=[],a.forEach(function(t){0!=t.Number&&e.selectedDevices.push(t)})}},methods:{start:function(){var t=this;this.API_GET("Maintain/GetMCSupplieStat",{Id:this.create.ContractId}).then(function(e){t.MCSupplieStatDtos=e.MCSupplieStatDtos})},GetAllSupplies:function(){var t=this;this.API_GET("Product/GetAllSupplies").then(function(e){console.log(e),t.numberOfDevicesData=[],e.map(function(e,a){t.numberOfDevicesData.push({Number:0,ProName:e.Characteristics,Other:e.Unit,ProductId:e.ID})})})},apply:function(){var t=this;return 0==this.selectedDevices.length?(this.$message.warning("请输入申请耗材数量!"),!1):this.LInKman.ChineseName&&this.LInKman.MobilePhone&&this.LInKman.Address?void this.API_POST("Maintain/CreateMSSO",{Id:this.create.Id,Euqs:this.selectedDevices,Other:this.meno,LInKman:this.LInKman}).then(function(e){t.$message.success("申请成功！"),t.$router.push({path:"/MaintenanceTasks"}),t.$emit("refresh")}):(this.$message.warning("请补充姓名、手机号、地址!"),!1)},cellStyle:function(t){if(t.row.OrderCode==this.create.OrderCode)return"color:red;"},GetMCEquSupplie:function(){var t=this;this.API_GET("Maintain/GetMCEquSupplie",{Id:this.create.ContractId}).then(function(e){console.log(e),t.MCEquSupplieData=e.Dtos,t.DetailDtos=e.DetailDtos})},look:function(t){var e=this;this.gridData=[],this.API_GET("Maintain/GetMSSO",{Id:t.MSSOId}).then(function(t){console.log(t.Dto),e.gridData=t.Dto.GoosDtos})},querySearch:function(t,e){if(""==this.create.CusId)return!1;var a={cusId:this.create.CusId};this.API_GET("CRM/GetCusLinkManMini",a).then(function(t){var a=t.Dtos.map(function(t){return n()({value:t.Name},t)});e(a)})},handleSelect:function(t){this.LInKman={ChineseName:t.Name,MobilePhone:t.Mobile,EMail:t.Email,Address:t.Address}}},beforeCreate:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){},destroyed:function(){},activated:function(){}},r={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("SaxoPage",{scopedSlots:t._u([{key:"title",fn:function(){return[t.explanation?t._e():a("el-link",{staticStyle:{"line-height":"60px"},attrs:{type:"primary"},on:{click:function(e){t.explanation=!0}}},[t._v("使用说明")]),t._v(" "),t.explanation?a("el-link",{staticStyle:{"line-height":"60px"},attrs:{type:"danger"},on:{click:function(e){t.explanation=!1}}},[t._v("关闭使用说明")]):t._e(),t._v(" "),a("el-dialog",{attrs:{title:"使用说明",visible:t.explanation,width:"30%","append-to-body":!0},on:{"update:visible":function(e){t.explanation=e}}},[a("div",{staticClass:"dia"},[a("h3",[t._v("保养所需耗材")]),t._v(" "),a("p",[t._v("本次保养需要使用到的耗材清单，申请耗材时请注意所需耗材的数量与单位")]),t._v(" "),a("br"),t._v(" "),a("h3",[t._v("保养记录")]),t._v(" "),a("p",[t._v("本合同下的保养记录，红色为本条任务")]),t._v(" "),a("br"),t._v(" "),a("h3",[t._v("申请耗材")]),t._v(" "),a("p",[t._v("填写你所需要的耗材量，耗材申请量满足耗材所需即可，不可过多申请")])]),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){t.explanation=!1}}},[t._v("确 定")])],1)]),t._v(" "),a("saxo-button",{attrs:{mini:"",type:"success"},on:{click:function(e){return t.apply()}}},[t._v("申请")])]},proxy:!0},{key:"content",fn:function(){return[a("h3",[t._v("保养所需耗材")]),t._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.MCEquSupplieData,size:"mini"}},[a("el-table-column",{attrs:{label:"产品编码 ",prop:"ProdcutCode",width:"200"}}),t._v(" "),a("el-table-column",{attrs:{label:"长编码",prop:"LongCode",width:"200"}}),t._v(" "),a("el-table-column",{attrs:{label:"描述",prop:"Desc"}}),t._v(" "),a("el-table-column",{attrs:{label:"数量",prop:"Numner",width:"100"}}),t._v(" "),a("el-table-column",{attrs:{label:"单位",prop:"Unit",width:"100"}}),t._v(" "),a("el-table-column",{attrs:{label:"合计",prop:"Total",width:"100"}})],1),t._v(" "),a("div",{staticStyle:{width:"95%","margin-left":"5%"}},[a("el-collapse",[a("el-collapse-item",{attrs:{title:"保养设备内容 点击查看"}},[a("el-table",{attrs:{data:t.DetailDtos}},[a("el-table-column",{attrs:{prop:"ProType",label:"名称",width:"300","show-overflow-tooltip":!0}}),t._v(" "),a("el-table-column",{attrs:{prop:"ProductCode",label:"编号",width:"180"}}),t._v(" "),a("el-table-column",{attrs:{prop:"ProductDesc",label:"描述","show-overflow-tooltip":!0}}),t._v(" "),a("el-table-column",{attrs:{prop:"Numner",label:"数量",width:"100"}})],1)],1)],1)],1),t._v(" "),a("h3",[t._v("保养记录")]),t._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.MCSupplieStatDtos,size:"mini","cell-style":t.cellStyle}},[a("el-table-column",{attrs:{label:"任务编号",prop:"OrderCode",width:"140"}}),t._v(" "),a("el-table-column",{attrs:{label:"状态",prop:"StateStr",width:"100"}}),t._v(" "),a("el-table-column",{attrs:{label:"预计日期",prop:"EstimatedTime"}}),t._v(" "),a("el-table-column",{attrs:{label:"开始日期",prop:"ActualTime"}}),t._v(" "),a("el-table-column",{attrs:{label:"完成日期",prop:"EndTime"}}),t._v(" "),a("el-table-column",{attrs:{label:"耗材状态",prop:"MSSOStateStr"}}),t._v(" "),a("el-table-column",{attrs:{label:"发货日期",prop:"SentDate"}}),t._v(" "),a("el-table-column",{attrs:{label:"查看"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-popover",{attrs:{placement:"left",trigger:"click"}},[a("el-table",{attrs:{data:t.gridData}},[a("el-table-column",{attrs:{prop:"ProDesc",label:" 产品描述",width:"500","show-overflow-tooltip":!0}}),t._v(" "),a("el-table-column",{attrs:{prop:"Brand",label:"品牌",width:"100","show-overflow-tooltip":!0}}),t._v(" "),a("el-table-column",{attrs:{prop:"Quantity",label:"数量",width:"60"}}),t._v(" "),a("el-table-column",{attrs:{prop:"Delivered",label:"已发货",width:"100"}})],1),t._v(" "),null!=e.row.MSSOId?a("el-link",{attrs:{slot:"reference",type:"primary",underline:!1},on:{click:function(a){return t.look(e.row)}},slot:"reference"},[t._v("查看")]):t._e()],1)]}}])})],1),t._v(" "),a("h3",[t._v("申请耗材")]),t._v(" "),t._l(t.numberOfDevicesData,function(e){return a("p",{key:e.ProName,staticClass:"from"},[a("span",{staticClass:"Name"},[t._v(t._s(e.ProName))]),t._v(" "),a("el-input-number",{attrs:{step:1,min:0,size:"mini","step-strictly":""},model:{value:e.Number,callback:function(a){t.$set(e,"Number",a)},expression:"item.Number"}}),t._v(" "),a("span",{staticClass:"Company"},[t._v(t._s(e.Other))])],1)}),t._v(" "),a("h3",[t._v("联系人")]),t._v(" "),a("p",{staticClass:"from"},[a("span",{staticClass:"Name2"},[t._v("姓名")]),t._v(" "),a("el-autocomplete",{staticStyle:{width:"400px"},attrs:{"fetch-suggestions":t.querySearch,placeholder:"请输入内容",size:"mini"},on:{select:t.handleSelect},model:{value:t.LInKman.ChineseName,callback:function(e){t.$set(t.LInKman,"ChineseName",e)},expression:"LInKman.ChineseName"}})],1),t._v(" "),a("p",{staticClass:"from"},[a("span",{staticClass:"Name2"},[t._v("手机")]),t._v(" "),a("el-input",{staticStyle:{width:"400px"},attrs:{placeholder:"请输入内容",size:"mini"},model:{value:t.LInKman.MobilePhone,callback:function(e){t.$set(t.LInKman,"MobilePhone",e)},expression:"LInKman.MobilePhone"}})],1),t._v(" "),a("p",{staticClass:"from"},[a("span",{staticClass:"Name2"},[t._v("地址")]),t._v(" "),a("el-input",{staticStyle:{width:"400px"},attrs:{placeholder:"请输入内容",size:"mini"},model:{value:t.LInKman.Address,callback:function(e){t.$set(t.LInKman,"Address",e)},expression:"LInKman.Address"}})],1),t._v(" "),a("p",{staticClass:"from"},[a("span",{staticClass:"Name2"},[t._v("邮箱")]),t._v(" "),a("el-input",{staticStyle:{width:"400px"},attrs:{placeholder:"请输入内容",size:"mini"},model:{value:t.LInKman.EMail,callback:function(e){t.$set(t.LInKman,"EMail",e)},expression:"LInKman.EMail"}})],1),t._v(" "),a("h3",[t._v("备注")]),t._v(" "),a("el-input",{staticStyle:{width:"400px"},attrs:{type:"textarea",rows:2,placeholder:"请输入备注",autosize:{minRows:4,maxRows:4}},model:{value:t.meno,callback:function(e){t.meno=e},expression:"meno"}})]},proxy:!0}])})},staticRenderFns:[]};var c=a("VU/8")(o,r,!1,function(t){a("24S/")},"data-v-5af5eb26",null);e.default=c.exports}});