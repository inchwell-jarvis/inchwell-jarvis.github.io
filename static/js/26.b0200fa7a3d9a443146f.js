webpackJsonp([26],{ew8E:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("mvHQ"),a=i.n(n),o=i("bOdI"),s=i.n(o),l=i("qy1k"),r=i("t4zo"),c=i.n(r),u=i("uXZL"),v=i.n(u),d={data:function(){var t;return{show:!1,UData:[],PayAmount:0,UsageFeeDtos:0,headerCellStyle:(t={background:"#f7f8fd",fontSize:"12px",fontWeight:400,fontStyle:"normal"},s()(t,"fontSize","11px"),s()(t,"padding","5px"),s()(t,"paddingLeft","0px"),t),cellStyle:{height:"48px",fontSize:"12px"},twoClick:!0,TableData:[],selected:[],Other:"",footings:0,Memo:"",Files:[],BCode:"",dialogVisible:!1,InvoiceRedTitle1:"",inputValue1:"",inputValue2:"",retrieveInvoiceNumber:"",BId:""}},computed:{newArray:function(){return JSON.parse(a()(this.TableData))}},watch:{UsageFeeDtos:function(t){console.log(t)}},methods:{querySearch:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments[1],i={search:t,pageNum:1,numPerPage:10,orderField:"",orderDirection:""};this.API_GET("Finance/GetInvCodes",i).then(function(t){for(var i=[],n=0;n<t.Dtos.length;n++)t.Dtos[n].value=t.Dtos[n].InvCode,i.push(t.Dtos[n]);e(i)})},handleSelect:function(t){this.BCode="",this.inputValue2="",this.BId=t.Id},RejectInvoice:function(){var t=this;this.API_POST("Finance/RejectInvoice",{id:this.UData.ID}).then(function(e){t.$message.success("发票已驳回！"),t.start()})},openDialog:function(){this.inputValue1=this.UData.Amount,this.InvoiceRedTitle1="本次发票总额为："+this.UData.Amount.toFixed(2),this.dialogVisible=!0},confirm:function(){var t=this;return this.inputValue1?this.inputValue2||this.retrieveInvoiceNumber?void this.API_POST("Finance/AtRedInvoice",{ID:this.UData.ID,Str:this.inputValue1,Append:this.inputValue2,BId:this.BId}).then(function(e){t.$message.success("操作成功！"),t.start(),t.dialogVisible=!1}).catch(function(e){t.$message.error("操作失败！"),t.dialogVisible=!1}):this.$message.warning("请输入或选择发票号！"):this.$message.warning("请输入冲红金额！")},deleteFun:function(t){var e=this;console.log(t);var i={api:"post",url:this.$store.state.http+"Finance/DeleteFinanceInvAtt",data:{id:t.ID}};this.$https(i).then(function(t){e.$message({showClose:!0,message:"删除成功!",type:"success"}),e.start()})},receive:function(t){var e=this;console.log(t);var i={api:"post",url:this.$store.state.http+"Finance/UploadFinanceInvAtt",data:{Id:this.UData.ID,FileName:t.name,Type:t.type,FileStr:t.Base64}};this.$https(i).then(function(t){e.$message({showClose:!0,message:"上传成功!",type:"success"}),e.start()})},derivation:function(){var t=this.UData.CusFullName+"_"+this.UData.POCode+"_设备明细",e=v.a.utils.table_to_book(document.querySelector("#out-table"),{raw:!0}),i=v.a.write(e,{bookType:"xlsx",bookSST:!0,type:"array"});try{c.a.saveAs(new Blob([i],{type:"application/octet-stream"}),t+".xlsx")}catch(t){"undefined"!=typeof console&&console.log(t,i)}return i},InvoiceInvalidated:function(){var t=this,e={data:{Id:this.UData.ID},api:"post",url:this.$store.state.http+"Finance/VoideInvoice"};this.$https(e).then(function(e){t.$message({showClose:!0,message:"作废成功!",type:"success"}),t.start()})},SelectConfirm:function(){for(var t=[],e=0;e<this.TableData.length;e++){var i=this.TableData[e];isNaN(parseFloat(i.amount))||(this.selected.push(i),t.push({SourceId:i.ID,UsageAmount:Number(i.amount)}))}if(0==t.length)return this.$message.error("请输入使用量"),!1;this.show=!1},iFOther:function(){var t=this;return t.BCode||this.retrieveInvoiceNumber?""==t.Other?(t.$confirm("你没有输入物流单号，是否修改？","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"仍然提交",cancelButtonText:"修改单号"}).then(function(){t.WriteAnInvoice()}),!1):void t.WriteAnInvoice():this.$message.warning("请输入或选择发票号！")},WriteAnInvoice:function(){var t=this,e={Id:this.UData.ID,PayAmount:this.UData.Amount,Other:this.Other,BCode:this.BCode,Memo:this.Memo,BId:this.BId};this.API_POST("Finance/WriteAnInvoice",e).then(function(e){t.$message.success("开票成功"),t.start()})},start:function(){var t=this,e={data:{search:"",creater:"",invoicestate:-1,type:" ",pageNum:1,numPerPage:99,orderField:"",orderDirection:"",id:this.ID},api:"get",url:this.$store.state.http+"Finance/GetSOFinanceInvoices"};this.$https(e).then(function(e){if(console.log(e),t.UData=e.Data.InvoiceDtos[0],t.PayAmount=t.UData.Amount,t.Memo=t.UData.Memo,t.Files=t.UData.Files,t.footings=0,null==t.UData.MachinePOInvoiceEquDtos)return!1;t.UData.MachinePOInvoiceEquDtos.forEach(function(e){e.footing=l.a.times(e.Quantity,e.DisUnitPrice),t.footings=l.a.plus(t.footings,e.footing)}),t.UData.MachinePOInvoiceEquDtos.push({ProductDesc:"",ProductCode:"",Unit:"",Quantity:"",OriUnitPrice:"",DisUnitPrice:"",footing:"合计："+t.footings},{ProductDesc:"",ProductCode:"",Unit:"",Quantity:"",OriUnitPrice:"",DisUnitPrice:"",footing:"优惠后合计："+t.UData.ContractAmount})})}},created:function(){this.ID=this.$route.query.Id,console.log(this.ID),this.start()},mounted:function(){},beforeCreate:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){this.$emit("refresh")},destroyed:function(){}},p={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"box_s"},[i("div",{staticClass:"retrieve"},[i("span",{staticClass:"retrieveSpan"},[t._v("编辑财务发票")]),t._v(" "),-1!=[2,8].indexOf(t.UData.InvoiceState)?i("saxo-button",{staticStyle:{float:"right"},attrs:{mini:"",type:"danger"},on:{click:function(e){return t.InvoiceInvalidated()}}},[t._v("发票作废")]):t._e(),t._v(" "),1==t.UData.InvoiceState?i("saxo-button",{staticStyle:{float:"right"},attrs:{mini:"",type:"danger"},on:{click:function(e){return t.RejectInvoice()}}},[t._v("发票驳回")]):t._e(),t._v(" "),8==t.UData.InvoiceState?i("saxo-button",{staticStyle:{float:"right","margin-right":"10px"},attrs:{mini:""},on:{click:function(e){return t.openDialog()}}},[t._v("发票冲红")]):t._e()],1),t._v(" "),i("div",{staticClass:"Con"},[i("el-descriptions",{staticClass:"margin-top",attrs:{title:"基础信息",column:3,size:"mini",border:""}},[i("el-descriptions-item",[i("template",{slot:"label"},[i("i",{staticClass:"el-icon-location-outline"}),t._v("\n                    客户名称\n                ")]),t._v("\n                "+t._s("  "+t.UData.CusFullName)+"\n            ")],2),t._v(" "),t.UData.CreateDate?i("el-descriptions-item",[i("template",{slot:"label"},[t._v("\n                    创建时间\n                ")]),t._v("\n                "+t._s("  "+t.UData.CreateDate.split("T")[0])+"\n            ")],2):t._e(),t._v(" "),i("el-descriptions-item",[i("template",{slot:"label"},[i("i",{staticClass:"el-icon-location-outline"}),t._v("\n                    类别\n                ")]),t._v("\n                "+t._s("  "+t.UData.Type)+"\n            ")],2),t._v(" "),i("el-descriptions-item",[i("template",{slot:"label"},[i("i",{staticClass:"el-icon-location-outline"}),t._v("\n                    隶属公司\n                ")]),t._v("\n                "+t._s("  "+t.UData.BelongCompany)+"\n            ")],2),t._v(" "),i("el-descriptions-item",[i("template",{slot:"label"},[i("i",{staticClass:"el-icon-location-outline"}),t._v("\n                    申请人\n                ")]),t._v("\n                "+t._s("  "+t.UData.Creater)+"\n            ")],2),t._v(" "),i("el-descriptions-item",[i("template",{slot:"label"},[i("i",{staticClass:"el-icon-location-outline"}),t._v("\n                    单号\n                ")]),t._v("\n                "+t._s("  "+t.UData.POCode)+"\n            ")],2),t._v(" "),t.UData.Amount?i("el-descriptions-item",[i("template",{slot:"label"},[i("i",{staticClass:"el-icon-office-building"}),t._v("\n                    金额\n                ")]),t._v("\n                "+t._s("  ￥"+t.UData.Amount.toFixed(2))+"\n            ")],2):t._e(),t._v(" "),i("el-descriptions-item",[i("template",{slot:"label"},[i("i",{staticClass:"el-icon-location-outline"}),t._v("\n                    发票状态\n                ")]),t._v("\n                "+t._s("  "+t.UData.InvoiceStateStr)+"\n            ")],2),t._v(" "),i("el-descriptions-item",[i("template",{slot:"label"},[i("i",{staticClass:"el-icon-location-outline"}),t._v("\n                    物流单号\n                ")]),t._v("\n                "+t._s("  "+t.UData.Logistics)+"\n            ")],2),t._v(" "),i("el-descriptions-item",[i("template",{slot:"label"},[i("i",{staticClass:"el-icon-location-outline"}),t._v("\n                    发票号\n                ")]),t._v("\n                "+t._s("  "+t.UData.InvCode)+"\n            ")],2)],1),t._v(" "),i("br"),t._v(" "),i("div",{staticClass:"saxo"},[i("div",{staticClass:"saxoleft"},[i("div",{staticClass:"el-descriptions__title"},[t._v("金额")]),t._v(" "),i("br"),t._v(" "),i("span",{staticClass:"price"},[t._v("￥"),i("span",[t._v(t._s(t.UData.Amount))])])]),t._v(" "),i("div",{staticClass:"saxoright"},[i("div",{staticClass:"el-descriptions__title"},[t._v("备注")]),t._v(" "),i("br"),t._v(" "),i("el-input",{attrs:{type:"textarea",autosize:{minRows:4,maxRows:4},placeholder:"请输入内容"},model:{value:t.Memo,callback:function(e){t.Memo=e},expression:"Memo"}})],1)]),t._v(" "),i("br"),t._v(" "),1==t.UData.InvoiceState?i("div",{staticClass:"el-descriptions__title"},[t._v("发票\n            "),i("saxo-button",{staticStyle:{float:"right"},attrs:{mini:"",type:"primary"},on:{click:function(e){return t.iFOther()}}},[t._v("开发票")]),t._v(" "),i("el-input",{staticStyle:{width:"200px",float:"right"},attrs:{size:"mini",placeholder:"请输入物流单号"},model:{value:t.Other,callback:function(e){t.Other=e},expression:"Other"}}),t._v(" "),i("el-input",{staticStyle:{width:"200px",float:"right"},attrs:{size:"mini",placeholder:"请输入发票代码及号码"},on:{input:function(e){t.retrieveInvoiceNumber=""}},model:{value:t.BCode,callback:function(e){t.BCode=e},expression:"BCode"}}),t._v(" "),i("el-autocomplete",{staticStyle:{width:"200px",float:"right"},attrs:{"fetch-suggestions":t.querySearch,placeholder:"请选择发票号",size:"mini"},on:{select:t.handleSelect},model:{value:t.retrieveInvoiceNumber,callback:function(e){t.retrieveInvoiceNumber=e},expression:"retrieveInvoiceNumber"}})],1):t._e(),t._v(" "),i("br"),t._v(" "),i("div",{staticStyle:{width:"100%"}},[i("el-form",{ref:"form",attrs:{"label-width":"150px"}},[i("el-form-item",{attrs:{label:"联系人姓名"}},[t._v("\n                    "+t._s(t.UData.Receiver)+"\n                ")]),t._v(" "),i("el-form-item",{attrs:{label:"联系人电话"}},[t._v("\n                    "+t._s(t.UData.ReceiverTel)+"\n                ")]),t._v(" "),i("el-form-item",{attrs:{label:"联系人邮箱"}},[t._v("\n                    "+t._s(t.UData.ReceiverEmail)+"\n                ")]),t._v(" "),i("el-form-item",{attrs:{label:"联系人地址"}},[t._v("\n                    "+t._s(t.UData.ReceiverAddress)+"\n                ")])],1)],1),t._v(" "),i("br"),t._v(" "),i("div",{staticClass:"el-descriptions__title"},[t._v("系统信息 ")]),t._v(" "),t.UData.SystemInfo?i("el-timeline",{staticStyle:{margin:"30px 0 0 20px"}},t._l(t.UData.SystemInfo.split("@"),function(e,n){return i("el-timeline-item",{directives:[{name:"show",rawName:"v-show",value:""!=e,expression:"activity != ''"}],key:n,attrs:{timestamp:e.timestamp}},[t._v("\n                "+t._s(e)+"\n            ")])}),1):t._e(),t._v(" "),i("div",{staticClass:"el-descriptions__title"},[t._v("附件")]),t._v(" "),i("br"),t._v(" "),i("div",{staticStyle:{width:"100%"}},[i("uploadFile",{attrs:{FileData:t.Files},on:{receive:t.receive,deleteFun:t.deleteFun}})],1),t._v(" "),i("br"),t._v(" "),i("div",{staticClass:"el-descriptions__title"},[t._v("设备明细\n            "),i("saxo-button",{staticStyle:{float:"right"},attrs:{mini:"",type:"primary"},on:{click:function(e){return t.derivation()}}},[t._v("导出")])],1),t._v(" "),i("br"),t._v(" "),i("el-table",{staticStyle:{width:"100%"},attrs:{data:t.UData.MachinePOInvoiceEquDtos,size:"mini",id:"out-table"}},[i("el-table-column",{attrs:{prop:"ProductDesc",label:"名称"}}),t._v(" "),i("el-table-column",{attrs:{prop:"ProductCode",label:"编码"}}),t._v(" "),i("el-table-column",{attrs:{prop:"Unit",label:"单位"}}),t._v(" "),i("el-table-column",{attrs:{prop:"Quantity",label:"数量"}}),t._v(" "),i("el-table-column",{attrs:{prop:"OriUnitPrice",label:"原始单价"}}),t._v(" "),i("el-table-column",{attrs:{prop:"DisUnitPrice",label:"优惠后单价"}}),t._v(" "),i("el-table-column",{attrs:{prop:"footing",label:"合计"}})],1),t._v(" "),i("el-dialog",{attrs:{visible:t.dialogVisible,"append-to-body":!0,title:"发票冲红",width:"500px"},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("p",{staticStyle:{margin:"10px 0"}},[t._v(t._s(t.InvoiceRedTitle1))]),t._v(" "),i("el-input",{attrs:{placeholder:"发票冲红",size:"mini"},model:{value:t.inputValue1,callback:function(e){t.inputValue1=e},expression:"inputValue1"}}),t._v(" "),i("p",{staticStyle:{margin:"10px 0"}},[t._v("请输入发票号")]),t._v(" "),i("el-input",{attrs:{placeholder:"请输入发票代码及号码",size:"mini"},on:{input:function(e){t.retrieveInvoiceNumber=""}},model:{value:t.inputValue2,callback:function(e){t.inputValue2=e},expression:"inputValue2"}}),t._v(" "),i("p",{staticStyle:{margin:"10px 0"}},[t._v("或")]),t._v(" "),i("el-autocomplete",{staticStyle:{width:"100%"},attrs:{"fetch-suggestions":t.querySearch,placeholder:"请选择发票号",size:"mini"},on:{select:t.handleSelect},model:{value:t.retrieveInvoiceNumber,callback:function(e){t.retrieveInvoiceNumber=e},expression:"retrieveInvoiceNumber"}}),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("saxo-button",{attrs:{type:"info",mini:""},on:{click:function(e){t.dialogVisible=!1}}},[t._v("取消")]),t._v(" "),i("saxo-button",{attrs:{type:"primary",mini:""},on:{click:t.confirm}},[t._v("确定")])],1)],1)],1)])},staticRenderFns:[]};var h=i("VU/8")(d,p,!1,function(t){i("vjTY")},"data-v-04d6534c",null);e.default=h.exports},qy1k:function(t,e,i){"use strict";function n(t,e){return void 0===e&&(e=15),+parseFloat(Number(t).toPrecision(e))}function a(t){var e=t.toString().split(/[eE]/),i=(e[0].split(".")[1]||"").length-+(e[1]||0);return i>0?i:0}function o(t){if(-1===t.toString().indexOf("e"))return Number(t.toString().replace(".",""));var e=a(t);return e>0?n(Number(t)*Math.pow(10,e)):Number(t)}function s(t){d&&(t>Number.MAX_SAFE_INTEGER||t<Number.MIN_SAFE_INTEGER)&&console.warn(t+" is beyond boundary when transfer to integer, the results may not be accurate")}function l(t){return function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n=e[0];return e.slice(1).reduce(function(e,i){return t(e,i)},n)}}var r=l(function(t,e){var i=o(t),n=o(e),l=a(t)+a(e),r=i*n;return s(r),r/Math.pow(10,l)}),c=l(function(t,e){var i=Math.pow(10,Math.max(a(t),a(e)));return(r(t,i)+r(e,i))/i}),u=l(function(t,e){var i=Math.pow(10,Math.max(a(t),a(e)));return(r(t,i)-r(e,i))/i}),v=l(function(t,e){var i=o(t),l=o(e);return s(i),s(l),r(i/l,n(Math.pow(10,a(e)-a(t))))});var d=!0;var p={strip:n,plus:c,minus:u,times:r,divide:v,round:function(t,e){var i=Math.pow(10,e),n=v(Math.round(Math.abs(r(t,i))),i);return t<0&&0!==n&&(n=r(n,-1)),n},digitLength:a,float2Fixed:o,enableBoundaryChecking:function(t){void 0===t&&(t=!0),d=t}};e.a=p},vjTY:function(t,e){}});