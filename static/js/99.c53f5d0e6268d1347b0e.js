webpackJsonp([99],{DIUX:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e("Xxa5"),s=e.n(i),n=e("//Fk"),l=e.n(n),o=e("exGp"),r=e.n(o),c=e("mvHQ"),v=e.n(c),_={data:function(){return{UData:[],Remarks:"",active:-1,MachinePOFiles:[],PdfStyle:{display:"none"},SaxoDrawer:!1,Subscription:0,CapitalPoolDtos:[]}},computed:{newCapitalPoolDtos:function(){return JSON.parse(v()(this.CapitalPoolDtos))}},watch:{newCapitalPoolDtos:function(t){var a=this;this.Subscription=0,t.forEach(function(t){t.Number>0&&(a.Subscription+=Number(t.Number))})}},methods:{PrintPDF:function(){var t=this;return r()(s.a.mark(function a(){var e,i;return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return e=t,i=document.getElementById("pdf"),e.PdfStyle={display:"block"},a.next=5,new l.a(function(t,a){setTimeout(function(){e.$print(i),e.PdfStyle={display:"none"}},500)});case 5:case"end":return a.stop()}},a,t)}))()},AddMSOPaymentFun:function(){var t=this;console.log(this.CapitalPoolDtos);for(var a=[],e=0;e<this.CapitalPoolDtos.length;e++){var i=this.CapitalPoolDtos[e];isNaN(parseFloat(i.Number))||a.push({SourceId:i.ID,UsageAmount:Number(i.Number),From:2})}if(0==a.length)return this.$message.error("请输入使用量"),!1;console.log(a);var s={api:"post",url:this.$store.state.http+"MachineSO/MPOUseBBOC",data:{Id:this.UData.ID,PayAmount:this.Subscription,UsageFeeDtos:a}};this.$https(s).then(function(a){t.SaxoDrawer=!1,t.$message({showClose:!0,message:"认款成功!",type:"success"}),t.start()})},GetCusCapitalPool:function(t){var a=this;this.SaxoDrawer=!0;var e={api:"get",url:this.$store.state.http+"CRM/GetCusCapitalPool",data:{cusId:this.UData.CusId,onlyPart:!0,includebboc:!0,includebuming:!1}};this.$https(e).then(function(t){a.CapitalPoolDtos=[];var e=t.Data,i=e.BBOCDtos,s=e.CapitalPoolDtos;null!=i&&t.Data.BBOCDtos.forEach(function(t){t.LB="挂帐款",t.CreateDate=t.CreateDate.split("T")[0],a.$set(t,"Number",""),""!=t.SystemInfo&&null!=t.SystemInfo?t.SystemInfo2=t.SystemInfo.split("@"):element.SystemInfo2=[],a.CapitalPoolDtos.push(t)}),null!=s&&s.forEach(function(t){t.LB=t.Type,t.CreateDate=t.CreateDate.split("T")[0],a.$set(t,"Number",""),""!=t.SystemInfo&&null!=t.SystemInfo?t.SystemInfo2=t.SystemInfo.split("@"):element.SystemInfo2=[],a.CapitalPoolDtos.push(t)}),console.log(a.CapitalPoolDtos)})},MPOPayAudit:function(t){var a=this,e="";0==this.active&&(e="MPOPayAuditA"),1==this.active&&(e="MPOPayAuditB"),2==this.active&&(e="MPOPayAuditC"),3==this.active&&(e="MPOPayAuditD");var i={data:{id:this.UData.ID,Other:this.UData.Memo,Str:t},api:"post",url:this.$store.state.http+"MachineSO/"+e};this.$https(i).then(function(e){1==t?a.$message({message:"已同意！",type:"success"}):a.$message({message:"已驳回！",type:"warning"}),a.start()})},start:function(t){var a=this,e={data:{id:this.UData.ID,search:"",buyer:"",paystate:-1,invoicestate:-1,auditstate:-1,pageNum:1,numPerPage:30,memo:"",orderField:"",orderDirection:""},api:"get",url:this.$store.state.http+"MachineSO/GetFinanceMPOPays"};this.$https(e).then(function(t){a.MachinePOFiles=t.Data.MachinePOFiles,console.log(a.MachinePOFiles),a.UData=t.Data.MachinePOPayDtos[0],a.UData.CreateDate=a.UData.CreateDate.split("T")[0],a.UData.ConfirmDt&&(a.UData.ConfirmDt=a.UData.ConfirmDt.split("T")[0]),null==a.UData.AuditorA?a.active=0:null==a.UData.AuditorB?a.active=1:null==a.UData.AuditorC?a.active=2:null==a.UData.AuditorD?a.active=3:null!=a.UData.AuditorD&&(a.active=4),"已驳回"==a.UData.PayStateStr&&(a.active-=1)})}},created:function(){this.UData=this.$route.query.row,console.log(this.UData),this.start()},mounted:function(){},beforeCreate:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){this.$emit("refresh")},destroyed:function(){}},u={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"box_s"},[e("div",{staticClass:"retrieve"},[e("span",{staticClass:"retrieveSpan"},[t._v("编辑整机采购付款")]),t._v(" "),e("saxo-button",{staticStyle:{float:"right"},attrs:{mini:"",type:"primary"},on:{click:function(a){return t.PrintPDF()}}},[t._v("打印")])],1),t._v(" "),e("div",{staticClass:"Con",attrs:{id:"dom"}},[e("el-descriptions",{staticClass:"margin-top",attrs:{title:"基础信息",column:3,size:"mini",border:""}},[e("el-descriptions-item",[e("template",{slot:"label"},[t._v("\n                    供应商名称\n                ")]),t._v("\n                "+t._s("  "+t.UData.CusFullName)+"\n            ")],2),t._v(" "),e("el-descriptions-item",[e("template",{slot:"label"},[t._v("\n                    创建时间\n                ")]),t._v("\n                "+t._s("  "+t.UData.CreateDate)+"\n            ")],2),t._v(" "),e("el-descriptions-item",[e("template",{slot:"label"},[e("i",{staticClass:"el-icon-mobile-phone"}),t._v("\n                    金额\n                ")]),t._v("\n                "+t._s(t.FinancialAmountFormat(t.UData.Amount,t.FinancialAmountSymbol(t.UData.BuyingCurrency)))+"\n                (\n                "+t._s((t.UData.Amount/t.UData.ContractAmount*100).toFixed(2)+"%")+"\n                 \n                No."+t._s(t.UData.Number)+"\n                )\n            ")],2),t._v(" "),e("el-descriptions-item",[e("template",{slot:"label"},[e("i",{staticClass:"el-icon-tickets"}),t._v("\n                    申请人 采购员\n                ")]),t._v("\n                "+t._s("  "+t.UData.Creater)+"\n            ")],2),t._v(" "),e("el-descriptions-item",[e("template",{slot:"label"},[e("i",{staticClass:"el-icon-office-building"}),t._v("\n                    财务 付款\n                ")]),t._v("\n                "+t._s("  "+(t.UData.AuditorA?t.UData.AuditorA:""))+"\n            ")],2),t._v(" "),e("el-descriptions-item",[e("template",{slot:"label"},[e("i",{staticClass:"el-icon-office-building"}),t._v("\n                    财务经理 审核付款\n                ")]),t._v("\n                "+t._s("  "+(t.UData.AuditorB?t.UData.AuditorB:""))+"\n            ")],2),t._v(" "),e("el-descriptions-item",[e("template",{slot:"label"},[e("i",{staticClass:"el-icon-office-building"}),t._v("\n                    总经理 批准付款\n                ")]),t._v("\n                "+t._s("  "+(t.UData.AuditorC?t.UData.AuditorC:""))+"\n            ")],2),t._v(" "),e("el-descriptions-item",[e("template",{slot:"label"},[e("i",{staticClass:"el-icon-office-building"}),t._v("\n                    付款状态\n                ")]),t._v("\n                "+t._s("  "+t.UData.PayStateStr)+"\n            ")],2),t._v(" "),e("el-descriptions-item",[e("template",{slot:"label"},[e("i",{staticClass:"el-icon-office-building"}),t._v("\n                    采购员\n                ")]),t._v("\n                "+t._s("  "+t.UData.Buyer)+"\n            ")],2),t._v(" "),e("el-descriptions-item",[e("template",{slot:"label"},[e("i",{staticClass:"el-icon-office-building"}),t._v("\n                    采购单编号\n                ")]),t._v("\n                "+t._s("  "+t.UData.POCode)+"\n            ")],2),t._v(" "),e("el-descriptions-item",[e("template",{slot:"label"},[e("i",{staticClass:"el-icon-office-building"}),t._v("\n                    付款资金源\n                ")]),t._v("\n                "+t._s("  "+t.UData.PayBy)+"\n            ")],2)],1),t._v(" "),e("br"),t._v(" "),e("div",{staticClass:"RQbox"},[e("div",{staticClass:"RQboxLeft"},[e("div",{staticClass:"el-descriptions__title"},[t._v("金额")]),t._v(" "),e("br"),t._v(" "),e("span",{staticClass:"price"},[t._v("\n                    "+t._s(t.FinancialAmountSymbol(t.UData.BuyingCurrency))+"\n                    "),e("span",[t._v(t._s(t.FinancialAmountFormat(t.UData.Amount,"")))]),t._v("\n                    (\n                    "+t._s((t.UData.Amount/t.UData.ContractAmount*100).toFixed(2)+"%")+"\n                     \n                    No."+t._s(t.UData.Number)+"\n                    )\n                ")]),t._v(" "),e("br")]),t._v(" "),e("div",{staticClass:"RQboxRight"},[e("div",{staticClass:"el-descriptions__title"},[t._v("备注")]),t._v(" "),e("br"),t._v(" "),e("el-input",{staticStyle:{width:"500px"},attrs:{type:"textarea",autosize:{minRows:5,maxRows:10},placeholder:"请输入内容"},model:{value:t.UData.Memo,callback:function(a){t.$set(t.UData,"Memo",a)},expression:"UData.Memo"}})],1)]),t._v(" "),e("br"),t._v(" "),e("br"),t._v(" "),e("br"),t._v(" "),e("div",{staticClass:"el-descriptions__title"},[t._v("进度")]),t._v(" "),e("br"),t._v(" "),e("div",{staticClass:"schedule"},[e("el-steps",{attrs:{active:t.active,"align-center":""}},[e("el-step",[e("span",{attrs:{slot:"title",id:"挂账款"==t.UData.PayBy?"colored-text":""},slot:"title"},[t._v(t._s("挂账款"==t.UData.PayBy?"财务 使用挂账款":"财务 付款"))]),t._v(" "),e("template",{slot:"description"},[e("div",{staticClass:"downloadList"},["已驳回"!=t.UData.PayStateStr?e("span",[t._v(t._s(t.UData.AuditorA))]):t._e(),t._v(" "),"已驳回"==t.UData.PayStateStr&&0==t.active?e("span",{staticStyle:{color:"red"}},[t._v(t._s("已驳回:"+t.UData.AuditorA))]):t._e(),t._v(" "),0==t.active&&"已驳回"!=t.UData.PayStateStr?e("saxo-button",{attrs:{mini:"",type:"danger"},on:{click:function(a){return t.MPOPayAudit(0)}}},[t._v("驳回")]):t._e(),t._v(" "),0==t.active&&"已驳回"!=t.UData.PayStateStr?e("saxo-button",{attrs:{mini:"",type:"primary"},on:{click:function(a){return t.MPOPayAudit(1)}}},[t._v(t._s("挂账款"==t.UData.PayBy?"同意使用挂账款":"同意"))]):t._e()],1)])],2),t._v(" "),e("el-step",{attrs:{title:"财务经理 审核付款"}},[e("template",{slot:"description"},[e("div",{staticClass:"downloadList"},["已驳回"!=t.UData.PayStateStr?e("span",[t._v(t._s(t.UData.AuditorB))]):t._e(),t._v(" "),"已驳回"==t.UData.PayStateStr&&1==t.active?e("span",{staticStyle:{color:"red"}},[t._v(t._s("已驳回:"+t.UData.AuditorB))]):t._e(),t._v(" "),1==t.active&&"已驳回"!=t.UData.PayStateStr?e("saxo-button",{attrs:{mini:"",type:"danger"},on:{click:function(a){return t.MPOPayAudit(0)}}},[t._v("驳回")]):t._e(),t._v(" "),1==t.active&&"已驳回"!=t.UData.PayStateStr?e("saxo-button",{attrs:{mini:"",type:"primary"},on:{click:function(a){return t.MPOPayAudit(1)}}},[t._v("同意")]):t._e()],1)])],2),t._v(" "),e("el-step",{attrs:{title:"总经理 批准付款"}},[e("template",{slot:"description"},[e("div",{staticClass:"downloadList"},["已驳回"!=t.UData.PayStateStr?e("span",[t._v(t._s(t.UData.AuditorC))]):t._e(),t._v(" "),"已驳回"==t.UData.PayStateStr&&2==t.active?e("span",{staticStyle:{color:"red"}},[t._v(t._s("已驳回:"+t.UData.AuditorC))]):t._e(),t._v(" "),2==t.active&&"已驳回"!=t.UData.PayStateStr?e("saxo-button",{attrs:{mini:"",type:"danger"},on:{click:function(a){return t.MPOPayAudit(0)}}},[t._v("驳回")]):t._e(),t._v(" "),2==t.active&&"已驳回"!=t.UData.PayStateStr?e("saxo-button",{attrs:{mini:"",type:"primary"},on:{click:function(a){return t.MPOPayAudit(1)}}},[t._v("同意")]):t._e()],1)])],2)],1)],1),t._v(" "),e("br"),t._v(" "),e("div",{staticClass:"el-descriptions__title"},[t._v("附件")]),t._v(" "),e("br"),t._v(" "),e("uploadFile",{attrs:{FileData:t.MachinePOFiles,ShowUpload:!1}}),t._v(" "),e("br"),t._v(" "),e("br"),t._v(" "),e("br"),t._v(" "),e("br"),t._v(" "),e("br")],1),t._v(" "),e("div",{style:t.PdfStyle,attrs:{id:"pdf"}},[e("h4",[t._v("基础信息")]),t._v(" "),e("br"),t._v(" "),e("div",{staticStyle:{height:"130px"}},[e("div",{staticClass:"li"},[e("div",{staticClass:"label"},[t._v("供应商名称")]),t._v(" "),e("div",{staticClass:"value"},[t._v(t._s(t.UData.CusFullName))])]),t._v(" "),e("div",{staticClass:"li"},[e("div",{staticClass:"label"},[t._v("创建时间")]),t._v(" "),e("div",{staticClass:"value"},[t._v(t._s(t.UData.CreateDate))])]),t._v(" "),e("div",{staticClass:"li"},[e("div",{staticClass:"label"},[t._v("金额")]),t._v(" "),e("div",{staticClass:"value"},[t._v(t._s(t.UData.Amount))])]),t._v(" "),e("div",{staticClass:"li"},[e("div",{staticClass:"label"},[t._v("申请人 采购员")]),t._v(" "),e("div",{staticClass:"value"},[t._v(t._s(t.UData.Creater))])]),t._v(" "),e("div",{staticClass:"li"},[e("div",{staticClass:"label"},[t._v("财务 付款")]),t._v(" "),e("div",{staticClass:"value"},[t._v(t._s(t.UData.AuditorA))])]),t._v(" "),e("div",{staticClass:"li"},[e("div",{staticClass:"label"},[t._v("财务经理 审核付款")]),t._v(" "),e("div",{staticClass:"value"},[t._v(t._s(t.UData.AuditorB))])]),t._v(" "),e("div",{staticClass:"li"},[e("div",{staticClass:"label"},[t._v("总经理 批准付款")]),t._v(" "),e("div",{staticClass:"value"},[t._v(t._s(t.UData.AuditorC))])]),t._v(" "),e("div",{staticClass:"li"},[e("div",{staticClass:"label"},[t._v("付款状态")]),t._v(" "),e("div",{staticClass:"value"},[t._v(t._s(t.UData.PayStateStr))])]),t._v(" "),e("div",{staticClass:"li"},[e("div",{staticClass:"label"},[t._v("采购员")]),t._v(" "),e("div",{staticClass:"value"},[t._v(t._s(t.UData.Buyer))])]),t._v(" "),e("div",{staticClass:"li"},[e("div",{staticClass:"label"},[t._v("采购单编号")]),t._v(" "),e("div",{staticClass:"value"},[t._v(t._s(t.UData.POCode))])])]),t._v(" "),e("h4",[t._v("金额")]),t._v(" "),e("br"),t._v(" "),e("span",{staticClass:"price"},[t._v(t._s(t.FinancialAmountFormat(t.UData.Amount,t.FinancialAmountSymbol(t.UData.BuyingCurrency))))]),t._v(" "),e("br"),t._v(" "),e("br"),t._v(" "),e("h4",[t._v("备注")]),t._v(" "),e("span",{staticStyle:{display:"block",margin:"10px 0"}},[t._v(t._s(t.UData.Memo))]),t._v(" "),e("h4",[t._v("签字")]),t._v(" "),e("br"),t._v(" "),e("el-steps",{attrs:{active:t.active,"align-center":""}},[e("el-step",{attrs:{title:"挂账款"==t.UData.PayBy?"财务 使用挂账款":"财务 付款"}},[e("template",{slot:"description"},[e("div",{staticClass:"downloadList"},["已驳回"!=t.UData.PayStateStr?e("span",[t._v(t._s(t.UData.AuditorA))]):t._e(),t._v(" "),"已驳回"==t.UData.PayStateStr&&0==t.active?e("span",{staticStyle:{color:"red"}},[t._v(t._s("已驳回:"+t.UData.AuditorA))]):t._e(),t._v(" "),0==t.active&&"已驳回"!=t.UData.PayStateStr?e("saxo-button",{attrs:{mini:"",type:"danger"},on:{click:function(a){return t.MPOPayAudit(0)}}},[t._v("驳回")]):t._e(),t._v(" "),0==t.active&&"已驳回"!=t.UData.PayStateStr?e("saxo-button",{attrs:{mini:"",type:"primary"},on:{click:function(a){return t.MPOPayAudit(1)}}},[t._v(t._s("挂账款"==t.UData.PayBy?"同意使用挂账款":"同意"))]):t._e()],1)])],2),t._v(" "),e("el-step",{attrs:{title:"财务经理 审核付款"}},[e("template",{slot:"description"},[e("div",{staticClass:"downloadList"},["已驳回"!=t.UData.PayStateStr?e("span",[t._v(t._s(t.UData.AuditorB))]):t._e(),t._v(" "),"已驳回"==t.UData.PayStateStr&&1==t.active?e("span",{staticStyle:{color:"red"}},[t._v(t._s("已驳回:"+t.UData.AuditorB))]):t._e(),t._v(" "),1==t.active&&"已驳回"!=t.UData.PayStateStr?e("saxo-button",{attrs:{mini:"",type:"danger"},on:{click:function(a){return t.MPOPayAudit(0)}}},[t._v("驳回")]):t._e(),t._v(" "),1==t.active&&"已驳回"!=t.UData.PayStateStr?e("saxo-button",{attrs:{mini:"",type:"primary"},on:{click:function(a){return t.MPOPayAudit(1)}}},[t._v("同意")]):t._e()],1)])],2),t._v(" "),e("el-step",{attrs:{title:"总经理 批准付款"}},[e("template",{slot:"description"},[e("div",{staticClass:"downloadList"},["已驳回"!=t.UData.PayStateStr?e("span",[t._v(t._s(t.UData.AuditorC))]):t._e(),t._v(" "),"已驳回"==t.UData.PayStateStr&&2==t.active?e("span",{staticStyle:{color:"red"}},[t._v(t._s("已驳回:"+t.UData.AuditorC))]):t._e(),t._v(" "),2==t.active&&"已驳回"!=t.UData.PayStateStr?e("saxo-button",{attrs:{mini:"",type:"danger"},on:{click:function(a){return t.MPOPayAudit(0)}}},[t._v("驳回")]):t._e(),t._v(" "),2==t.active&&"已驳回"!=t.UData.PayStateStr?e("saxo-button",{attrs:{mini:"",type:"primary"},on:{click:function(a){return t.MPOPayAudit(1)}}},[t._v("同意")]):t._e()],1)])],2)],1),t._v(" "),e("br")],1),t._v(" "),e("SaxoDrawer",{attrs:{show:t.SaxoDrawer,title:t.UData.CusFullName+"(挂账款 & 不明款 & 资金池)"},on:{ShowFalse:function(a){t.SaxoDrawer=!1}}},[e("div",{staticClass:"DeawerBox"},[e("div",{staticClass:"table"},[e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.CapitalPoolDtos,height:"100%"}},[e("el-table-column",{attrs:{label:"类别",width:"150"},scopedSlots:t._u([{key:"default",fn:function(a){return["挂帐款"==a.row.LB?e("span",[t._v(" "+t._s(a.row.LB+"("+a.row.InvoiceStateStr+")"))]):t._e(),t._v(" "),"挂帐款"!=a.row.LB?e("span",[t._v(" "+t._s(a.row.LB))]):t._e()]}}])}),t._v(" "),e("el-table-column",{attrs:{label:"资金量",width:"120"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",{staticStyle:{float:"right"}},[t._v(" "+t._s("￥"+a.row.Amount.toFixed(2)))])]}}])}),t._v(" "),e("el-table-column",{attrs:{label:"使用量",width:"120"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",{staticStyle:{float:"right"}},[t._v(" "+t._s("￥"+a.row.UsageAmount.toFixed(2)))])]}}])}),t._v(" "),e("el-table-column",{attrs:{prop:"Creater",label:"创建人",width:"120"}}),t._v(" "),e("el-table-column",{attrs:{prop:"CreateDate",label:"创建时间",width:"120"}}),t._v(" "),e("el-table-column",{attrs:{prop:"StateStr",label:"状态",width:"120"}}),t._v(" "),e("el-table-column",{attrs:{label:"系统信息","show-overflow-tooltip":!0,width:"120"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-popover",{attrs:{placement:"top-start",title:"系统信息",trigger:"hover"}},[t._l(a.row.SystemInfo2,function(a,i){return e("p",{key:i},[t._v(t._s(a))])}),t._v(" "),e("span",{attrs:{slot:"reference"},slot:"reference"},[t._v("系统信息"),e("i",{staticClass:"el-icon-warning-outline"})])],2)]}}])}),t._v(" "),e("el-table-column",{attrs:{prop:"Memo",label:"备注"}}),t._v(" "),e("el-table-column",{attrs:{label:"使用量",fixed:"right",width:"150px"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-input",{attrs:{size:"mini",type:"number",placeholder:"请输入使用量"},model:{value:a.row.Number,callback:function(e){t.$set(a.row,"Number",e)},expression:"scope.row.Number"}})]}}])})],1)],1),t._v(" "),e("div",{staticClass:"but"},[e("div",[t._v("认款合计：￥"),e("span",[t._v(" "+t._s(t.Subscription))])]),t._v(" "),e("saxo-button",{staticClass:"butState",attrs:{mini:"",type:"primary"},on:{click:t.AddMSOPaymentFun}},[t._v("确认")])],1)])])],1)},staticRenderFns:[]};var d=e("VU/8")(_,u,!1,function(t){e("eduV")},"data-v-5f5ee41f",null);a.default=d.exports},eduV:function(t,a){}});