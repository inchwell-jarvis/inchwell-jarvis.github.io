webpackJsonp([108],{IzpI:function(t,e){},qoOp:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("Xxa5"),o=a.n(n),s=a("exGp"),i=a.n(s),l=a("mvHQ"),r=a.n(l),u=a("bOdI"),c=a.n(u),p=a("Xu46"),d=a("PXCl").Base64,h={name:"",data:function(){var t;return t={TotalAmountBig:0,ViewRebate:!1,returngoods:!1,GetSoReturnPurchasesData:[],returnthegoods:!1,RebateData:[],RebateState:!1,form:{SourceType:"零配件销售",region:"",num:0,textarea:""},MaintainRHF:!1,BelongCompany:"",SoQuoteType:"",optionsASAndSP:[{value:"AS",label:"AS"},{value:"SP",label:"SP"},{value:"SC",label:"SC"},{value:"RV",label:"RV"},{value:"QC",label:"QC"}],options:[{value:"技术公司",label:"技术公司"},{value:"服务公司",label:"服务公司"}],afsdfsdf:[c()({name:"22"},"name","12")],Data:{},SOEquipmentList:[],TotalPrice:{},Consignee:{},State:"",pricesOfParts:0,TravelAmount:"",TravelAmounts:0,Discount:"",DiscountAmount:0,DiscountAmountIndex:!1,GoodsDH:"",ShipmentQuantity:[],DeliDetails:[],ShowAdd:!0,dialogTableVisible:!1,gridData:[],TkeyData:[],col1:[{label:"序号",prop:"Sort",width:"50",sortable:!1},{label:"产品编号",prop:"ProcodeCode",width:"150",sortable:!1},{label:"品牌",prop:"Brand",width:"150",sortable:!1},{label:"描述",prop:"Desc",width:"",widths:!0,sortable:!1}],col11:[{label:"库位",prop:"Locations",width:"90",sortable:!1},{label:"库存",prop:"NetInventory",width:"90",sortable:!1},{label:"销售单价",prop:"UnitPrice",width:"90",sortable:!1},{label:"安装费单价",prop:"AssemblyPeice",width:"90",sortable:!1}],col2:[{label:"序号",prop:"Sort",width:"50",sortable:!1},{label:"产品编号",prop:"ProcodeCode",width:"150",sortable:!1},{label:"品牌",prop:"Brand",width:"150",sortable:!1},{label:"描述",prop:"Desc",width:"",widths:!0,sortable:!1}],col22:[{label:"库位",prop:"Locations",width:"90",sortable:!1},{label:"库存",prop:"NetInventory",width:"90",sortable:!1},{label:"采购单价",prop:"PurchaseUnitPrice",width:"90",sortable:!1},{label:"销售单价",prop:"UnitPrice",width:"90",sortable:!1},{label:"安装费单价",prop:"AssemblyPeice",width:"90",sortable:!1}],SaxoDrawer:!1,CapitalPoolDtos:[]},c()(t,"DiscountAmount","cxxx"),c()(t,"Subscription",0),t},created:function(){this.init(),this.GetRebateData(),this.GetSoReturnPurchases()},computed:{newCapitalPoolDtos:function(){return JSON.parse(r()(this.CapitalPoolDtos))}},watch:{$route:function(t,e){"/EditOrder"==t.path&&(this.ShowAdd=!0)},newCapitalPoolDtos:function(t){var e=this;this.Subscription=0,t.forEach(function(t){t.Number>0&&(e.Subscription+=Number(t.Number))})}},beforeDestroy:function(){document.onkeydown=""},methods:{oneClickShipping:function(){var t=this,e=JSON.parse(r()(this.SOEquipmentList)),a=!1;e.forEach(function(e){if(1==e.arr.length&&""!=e.arr[0].name){var n=e.arr[0],o=Number(n.name.split("[")[1].split("]")[0]),s=0;t.DeliDetails.length>0&&t.DeliDetails.forEach(function(t){t.forEach(function(t){t.ProductId==e.ProductId&&(s+=e.Number)})});var i=e.Number-s;i>0&&(o>=i?(t.$set(n,"value",i),a=!0):(t.$set(n,"value",o),a=!0),console.log(n.value))}}),this.SOEquipmentList=e,a&&this.$message({message:"一键填充完成！",type:"success"}),a||this.$message({message:"没有符合填充要求的发货单",type:"warning"})},DownloadShippingList:function(t){var e=this,a=this.DeliDetails[t],n=this.Data.Deliverys[t].LogisticsInfo;a.forEach(function(t){t.SY="";var a=e.SOEquipmentList.find(function(e){return e.ProductId===t.ProductId});if(a){var n=a.arr.find(function(e){return e.name.includes(t.SentKuwei)});n&&(t.SY=n.name)}});var o=[];a.forEach(function(t){e.SOEquipmentList.forEach(function(e){if(t.ProductId==e.ProductId){var a=e;a.shipmentQuantity=t.Number,a.SentKuwei=t.SentKuwei,a.SY=t.SY,o.push(e)}})}),console.log(o),console.log(this.Consignee),console.log(this.DeliDetails),console.log(a);for(var s=this.Data.CusName+"_"+this.Data.SOCode+"_发货单_"+(Number(t)+1),i="height:40px;line-height:40px;font-size:20px;font-weight: bold;",l="height:40px;line-height:40px;font-size:20px;text-align: left;",r="text-align: left;font-size:18px;",u="text-align: center;font-size:18px;",c=new Date,p="",d=0;d<o.length;d++){var h=o[d];-1!=h.SY.indexOf("供应商库")&&(h.SY=h.SY.split("-")[0]+"["+h.SY.split("[")[1],h.SentKuwei=h.SY.split("-")[0]),p+="<tr>\n                                <td style='"+u+"'>"+Number(d+1)+"</td>\n                                <td style='"+r+"'>"+h.SY+" &nbsp;</td>\n                                <td style='"+r+"'>"+h.Desc+"</td>\n                                <td style='"+r+"'>&emsp;"+h.SentKuwei+"</td>\n                                <td style='"+u+"'>"+h.shipmentQuantity+"</td>\n                            </tr>"}var m='\n\n            <html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40">\n                <head>\n                <meta charset="utf-8">\n                </head>\n                <body>\n                <table border=1 style="font-family: "宋体";padding:10px">\n\n                    <tr>\n                       <th colspan=\'5\' style=\'font-size:40px;line-height:100px;height:100px;color:rgb(20,25,244)'+"'>北京英之杰天祥发货单</th>\n                    </tr>\n\n                    <tr>\n                       <td colspan='2' style='"+i+"'>客户名称</td>\n                       <td colspan='3' style='"+l+"'>"+this.Data.CusName+"</td>\n                    </tr>\n                    <tr>\n                       <td colspan='2' style='"+i+"'>订单编号</td>\n                       <td colspan='3' style='"+l+"'>"+this.Data.SOCode+"</td>\n                    </tr>\n                    <tr>\n                       <td colspan='2' style='"+i+"'>联系人</td>\n                       <td colspan='3' style='"+l+"'>"+this.Consignee.Name+"</td>\n                    </tr>\n                    <tr>\n                       <td colspan='2' style='"+i+"'>手 机</td>\n                       <td colspan='3' style='"+l+"'>"+this.Consignee.MobilePhone+"</td>\n                    </tr>\n                    <tr>\n                       <td colspan='2' style='"+i+"'>地 址</td>\n                       <td colspan='3' style='"+l+"'>"+this.Consignee.Address+"</td>\n                    </tr>\n                    <tr>\n                       <td colspan='2' style='"+i+"'>当前日期</td>\n                       <td colspan='3' style='"+l+"'>"+c.getFullYear()+"/"+(c.getMonth()+1)+"/"+c.getDate()+" "+c.getHours()+" : "+c.getMinutes()+" </td>\n                    </tr>\n                    <tr>\n                       <td colspan='2' style='"+i+"'>物流单号</td>\n                       <td colspan='3' style='"+l+"'>"+n+"</td>\n                    </tr>\n                    <tr style='height:60px;line-height:60px;font-size:25px;margin:0 20px'>\n                       <th>序号</th>\n                       <th>发货后剩余</th>\n                       <th>描述</th>\n                       <th>库位</th>\n                       <th>发货数量</th>\n                    </tr>\n                    "+p+"\n                </table>\n                </body>\n                </html>",v=document.createElement("a");v.download=s+".xls",v.href="data:application/vnd.ms-excel;base64,"+window.btoa(unescape(encodeURIComponent(m))),document.body.appendChild(v),v.click(),document.body.removeChild(v)},AddMSOPaymentFun:function(){var t=this;console.log(this.CapitalPoolDtos);for(var e=[],a=0;a<this.CapitalPoolDtos.length;a++){var n=this.CapitalPoolDtos[a];isNaN(parseFloat(n.Number))||e.push({SourceId:n.ID,UsageAmount:Number(n.Number),From:"资金池"==n.LB||"不明款"==n.LB?1:2})}if(0==e.length)return this.$message.error("请输入使用量"),!1;var o={api:"post",url:this.$store.state.http+"SO/AddSOPayment",data:{Id:this.$store.state.Vuex.SOId,PayAmount:this.Subscription,UsageFeeDtos:e}};this.$https(o).then(function(e){t.SaxoDrawer=!1,t.$message({showClose:!0,message:"认款成功!",type:"success"}),t.init()})},paymentList:function(){var t=this;console.log(this.Data),this.SaxoDrawer=!0;var e={api:"get",url:this.$store.state.http+"CRM/GetCusCapitalPool",data:{cusId:this.CusId,onlyPart:!0,includebboc:!0,includebuming:!0}};this.$https(e).then(function(e){t.CapitalPoolDtos=[];var a=e.Data,n=a.BBOCDtos,o=a.CapitalPoolDtos;null!=n&&e.Data.BBOCDtos.forEach(function(e){e.LB="挂帐款",e.CreateDate=e.CreateDate.split("T")[0],t.$set(e,"Number",""),""!=e.SystemInfo&&null!=e.SystemInfo?e.SystemInfo2=e.SystemInfo.split("@"):element.SystemInfo2=[],t.CapitalPoolDtos.push(e)}),null!=o&&o.forEach(function(e){e.LB=e.Type,e.CreateDate=e.CreateDate.split("T")[0],t.$set(e,"Number",""),""!=e.SystemInfo&&null!=e.SystemInfo?e.SystemInfo2=e.SystemInfo.split("@"):element.SystemInfo2=[],t.CapitalPoolDtos.push(e)}),console.log(t.CapitalPoolDtos)})},DeleteInvoices:function(t){var e=this;this.API_POST("Finance/DelInvoice",{ID:t.ID}).then(function(t){e.$message.success("删除成功！"),e.init()})},OperationInvoice:function(t){var e=this;this.$prompt("请输入内容","操作发票",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(a){var n=a.value;e.API_POST("Finance/ApplyHandleInvoice",{ID:t.ID,Str:n}).then(function(t){e.$message.success("操作成功"),e.init()})}).catch(function(){e.$message("取消操作发票")})},LookReturnRefund_fun:function(t){console.log(t.ID),this.$router.push({path:"/EditOrderGetSOReturnsEdit",query:{row:t,mode:!1}})},ReturnRefund_fun:function(){this.$router.push({path:"/ReturnRefund2",query:{Id:this.$store.state.Vuex.SOId,From:2,EquDtos:this.SOEquipmentList}})},ResetMC:function(){var t=this,e={api:"post",url:this.$store.state.http+"SO/ResetSO",data:{Id:this.$store.state.Vuex.SOId}};this.$https(e).then(function(e){t.$message({message:"恢复成功！",type:"success"}),t.init()})},AddSOInvoice:function(){var t=this.DiscountAmount;console.log(t);for(var e=0;e<this.Data.InvoiceDtos.length;e++){var a=this.Data.InvoiceDtos[e];console.log(a),3!=a.InvoiceState&&(t-=a.Amount,console.log(a.Amount))}if(t<=0)return this.$message.warning("暂无可开票金额！"),!1;this.$router.push({path:"/LPJbilling",query:{API:"SO/AddSOInvoice",Id:this.$store.state.Vuex.SOId,CusId:this.CusId,InvoiceAmount:t}})},rowDrops:function(){var t=document.querySelector("#LEtetabes .el-table__body-wrapper tbody"),e=this;p.a.create(t,{onEnd:function(t){var a=t.newIndex,n=t.oldIndex;if(a==n)return!1;console.log(a,n);var o=e.SOEquipmentList;console.log(o);var s=o[n];o.splice(n,1),o.splice(a,0,s);for(var i=[],l=0;l<o.length;l++){var r=o[l];i[l]={Id:r.SOGoodId,Sort:l+1}}var u={url:e.$store.state.http+"SO/AfreshEquSort",api:"post",data:{Id:e.$store.state.Vuex.SOId,Dtos:i}};e.$https(u).then(function(t){console.log(t),e.SOEquipmentList=[],e.init()})}})},sortchange:function(){var t=this;console.log(t.$refs.Order.tableData);for(var e=[],a=0;a<EqList.length;a++){var n=EqList[a];e[a]={MaintainEquId:n.MCEquId,Desc:n.Desc,Pos:n.Pos,Sort:a+1}}console.log(e);var o={url:t.$store.state.http+"Maintain/AfreshEquSort",api:"post",data:{MaintainId:t.$store.state.Vuex.SOId,Dtos:e}};t.$https(o).then(function(e){t.EquDtos1=[],setTimeout(function(){t.initMaintenan()},500)})},Tkey2:function(){0!=this.TkeyData.length?this.Tkey(this.TkeyData[0]):(this.$message({showClose:!0,message:"退货成功！",type:"success"}),this.onSubmitTuiOut(),this.GetSoReturnPurchases())},Tkey:function(t){var e=this;return i()(o.a.mark(function a(){var n;return o.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:n={url:e.$store.state.http+"SO/AddSoReturnPurchase",api:"post",data:{CusFullName:e.Data.CusName,ContractCode:e.Data.SOCode,SourceType:e.formTuiHuo.SourceType,SourceId:e.$store.state.Vuex.SOId,TotalAmount:t.TotalAmount,Memo:e.formTuiHuo.textarea||"",ProductId:t.ProductId,Quantity:t.Tkey}},e.$https(n).then(function(t){console.log(t),0==t.Code&&(e.TkeyData.splice(0,1),e.Tkey2())});case 2:case"end":return a.stop()}},a,e)}))()},GetSoReturnPurchases:function(){var t=this,e={url:this.$store.state.http+"SO/GetSoReturnPurchases",api:"get",data:{pageNum:1,numPerPage:9999,orderField:"",orderDirection:"",fullname:"",begin:"",end:"",sourceType:"",state:"-1",sourecId:this.$store.state.Vuex.SOId}};this.$https(e).then(function(e){console.log(e),t.GetSoReturnPurchasesData=e.Data.Dtos;for(var a=0;a<t.GetSoReturnPurchasesData.length;a++){var n=t.GetSoReturnPurchasesData[a];n.CreateDate=n.CreateDate.split("T")[0]}})},CompleteTheTask:function(){var t=this,e={url:this.$store.state.http+"SO/CompleteTheTask",api:"post",data:{Id:this.$store.state.Vuex.SOId}};this.$https(e).then(function(e){t.init(),t.$message.success("工程师已完成任务")})},GetRebateData:function(){var t=this,e={url:this.$store.state.http+"Finance/GetRebates",api:"get",data:{pageNum:1,numPerPage:9999,orderField:"",orderDirection:"",fullname:"",begin:"",end:"",sourceType:"",type:"-1",state:"-1",sourecId:this.$store.state.Vuex.SOId}};this.$https(e).then(function(e){console.log(e),t.RebateData=e.Data.Dtos;for(var a=0;a<t.RebateData.length;a++){var n=t.RebateData[a];n.CreateDate=n.CreateDate.split("T")[0],1==n.Type&&(n.Type="现金"),2==n.Type&&(n.Type="购物卡"),3==n.Type&&(n.Type="其他")}console.log(t.RebateData)})},onSubmit:function(){var t=this;if(console.log(this.form.SourceType),""==this.form.SourceType)return this.$message.warning("请选择来源业务！"),!1;if(""==this.form.region)return this.$message.warning("请选择类型！"),!1;var e={api:"post",url:this.$store.state.http+"Finance/AddRebate",data:{SourceId:this.$store.state.Vuex.SOId,Type:this.form.region,SourceType:this.form.SourceType,Amount:this.form.num,Memo:this.form.textarea}};this.$https(e).then(function(e){t.RebateState=!1,t.$message.success("创建成功！"),t.GetRebateData()})},handleClose:function(t){this.$confirm("确认关闭？").then(function(e){t()}).catch(function(t){})},ReverseSelection:function(){if(console.log(this.SOEquipmentList),0==this.SOEquipmentList)return!1;for(var t=!this.SOEquipmentList[0].IsAssembly,e=0;e<this.SOEquipmentList.length;e++){this.SOEquipmentList[e].IsAssembly=t}this.pricesOfPartsJS()},ConsigneeS:function(t){console.log(t),this.Consignee.Name=t.Name,this.Consignee.EnginnerName=t.NameEn,this.Consignee.MobilePhone=t.Mobile,this.Consignee.Tel=t.Tel,this.Consignee.EMail=t.Email,this.Consignee.Address=t.Address,this.dialogTableVisible=!1},SelectConsignee:function(){var t=this;console.log(this.CusId);var e={data:{cusId:this.CusId},api:"get",url:this.$store.state.http+"CRM/GetCusLinkManMini",header:this.$store.state.token};this.$https(e).then(function(e){console.log(e.Data.Dtos),t.gridData=e.Data.Dtos,t.dialogTableVisible=!0})},Invoice:function(){if(""==this.BelongCompany||null==this.BelongCompany||void 0==this.BelongCompany)return this.$message.warning("请选择隶属公司！"),!1;var t={url:d.encodeURI(this.$store.state.http+"SO/GetSo"),soId:d.encodeURI(this.$store.state.Vuex.SOId),token:d.encodeURI(this.$store.state.token),index:d.encodeURI("技术公司"==this.BelongCompany?"1":"2")};this.jump("List/Delivery.html",t)},Orderlistmag:function(){if(console.log(this.BelongCompany),""==this.BelongCompany||null==this.BelongCompany||void 0==this.BelongCompany)return this.$message.warning("请选择隶属公司！"),!1;var t={url:d.encodeURI(this.$store.state.http+"SO/GetSo"),soId:d.encodeURI(this.$store.state.Vuex.SOId),token:d.encodeURI(this.$store.state.token)};"技术公司"===this.BelongCompany?this.jump("List/technology.html",t):this.jump("List/service.html",t)},NumberIndex:function(t){return"Number"+t},DeliverysHttp:function(t){var e=this.Data.Deliverys[t].LogisticsInfo;window.open("https://www.sf-express.com/cn/sc/dynamic_function/waybill/#search/bill-number/"+e,"_blank")},deliverGoods:function(){var t=this;if(""==this.GoodsDH)return this.$message.warning("请输入物流信息！"),!1;for(var e=[],a=0;a<this.SOEquipmentList.length;a++){this.SOEquipmentList[a].arr.map(function(t){""!=t.value&&0!=t.value&&e.push(t)})}for(var n=[],o=0;o<e.length;o++){var s=e[o];if(""==s.name)return this.$message.warning("没有库位不可发"),!1;n.push({Location:s.name.split("[")[0],Quantity:Number(s.value)})}console.log(n),0==n.length&&this.$message.warning("请输入发货数量");var i={api:"post",url:this.$store.state.http+"SO/ShipmentSO",data:{SOId:this.$store.state.Vuex.SOId,LogisticsInfo:this.GoodsDH,Dtos:n}};this.$https(i).then(function(e){console.log(e),t.$emit("refresh"),t.$router.push({path:"/SpareParts"})})},dele:function(t){var e=this;console.log(t);var a={api:"post",url:this.$store.state.http+"SO/DelSoGood",data:{Id:t.SOGoodId}};this.$https(a).then(function(t){e.init()})},handleSelect:function(t){this.TravelAmounts=t.Price,this.pricesOfPartsJS()},Qingk:function(){this.TravelAmounts="",this.TravelAmount="",this.pricesOfPartsJS()},InoutgB:function(t){2==t.split("-").length||(this.TravelAmounts=t),this.pricesOfPartsJS()},querySearch:function(t,e){"0"==t&&(t="");var a={data:{province:"",City:t},api:"get",url:this.$store.state.http+"System/GetTravelExpenses"};this.$https(a).then(function(t){console.log(t.Data);for(var a=0;a<t.Data.length;a++)t.Data[a].value=t.Data[a].City+" - "+t.Data[a].Price;console.log(t.Data),e(t.Data)})},pricesOfPartsJS:function(t){for(var e=0,a=0,n=0;n<this.SOEquipmentList.length;n++){var o=this.SOEquipmentList[n];console.log(o),"RMB"==o.BuyingCurrency?a+=Number(o.BuyingUnitPrice)*o.Number:a+=10*Number(o.BuyingUnitPrice)*o.Number,o.IsAssembly?e+=(o.AssemblyPeice+o.UnitPrice)*o.Number:e+=o.UnitPrice*o.Number}this.TotalPrice.NumberCG=a;var s=Number(this.Discount);if(void 0!=this.Discount&&""!=s||(s=0),this.TotalPrice.Amount=(Number(this.TotalPrice.LogisticCharge)+e+Number(this.TravelAmounts)).toFixed(2),0==this.DiscountAmountIndex)return this.DiscountAmountIndex=!0,!1;this.DiscountAmount=this.TotalPrice.Amount*(1-.01*s),"SaveOrderS"==t&&this.SaveOrderS()},SaveOrderS:function(){for(var t=[],e=0;e<this.SOEquipmentList.length;e++){var a=this.SOEquipmentList[e];console.log(a.SOGoodId);var n={};n.SOGoodId=a.SOGoodId,n.Number=a.Number,n.IsAssembly=a.IsAssembly,t.push(n)}var o={name:this.Consignee.Name,EnginnerName:this.Consignee.EnginnerName,Mobile:this.Consignee.MobilePhone,Tel:this.Consignee.Tel,Email:this.Consignee.EMail,Address:this.Consignee.Address};console.log(o),console.log(t),console.log(this.Data.Memo);var s={api:"post",url:this.$store.state.http+"SO/SaveSO",data:{Memo:this.Data.Memo,SOId:this.$store.state.Vuex.SOId,QuoteCode:this.Data.QuoteCode,Amount:this.TotalPrice.Amount,DiscountProportion:this.Discount,SaveSOConsignee:o,TravelAmount:this.TravelAmounts,LogisticCharge:this.TotalPrice.LogisticCharge,DiscountAmount:this.DiscountAmount,SaveSOGoodDtos:t,BelongCompany:this.BelongCompany,SoQuoteType:this.SoQuoteType}};console.log(s),this.$https(s).then(function(t){})},SaveOrder:function(t){var e=this;if(console.log(t),console.log(1!=t&&7!=t),1!=t&&7!=t&&(""==this.SoQuoteType||null==this.SoQuoteType||void 0==this.SoQuoteType))return this.$message.warning("请选择报价类型！"),!1;for(var a=[],n=0;n<this.SOEquipmentList.length;n++){var o=this.SOEquipmentList[n];console.log(o.SOGoodId);var s={};s.SOGoodId=o.SOGoodId,s.Number=o.Number,s.IsAssembly=o.IsAssembly,a.push(s)}var i={name:this.Consignee.Name,EnginnerName:this.Consignee.EnginnerName,Mobile:this.Consignee.MobilePhone,Tel:this.Consignee.Tel,Email:this.Consignee.EMail,Address:this.Consignee.Address};console.log(i),console.log(a),console.log(this.Data.Memo);var l={api:"post",url:this.$store.state.http+"SO/SaveSO",data:{Memo:this.Data.Memo,SOId:this.$store.state.Vuex.SOId,QuoteCode:this.Data.QuoteCode,Amount:this.TotalPrice.Amount,DiscountProportion:this.Discount,SaveSOConsignee:i,TravelAmount:this.TravelAmounts,LogisticCharge:this.TotalPrice.LogisticCharge,DiscountAmount:this.DiscountAmount,SaveSOGoodDtos:a,BelongCompany:this.BelongCompany,SoQuoteType:this.SoQuoteType}};console.log(l),this.$https(l).then(function(a){if(e.init(),"BC"==t)return e.$message({message:"保存成功！",type:"success"}),!1;void 0!=t&&(e.init(),e.Edit(t))})},RefreshOrderUnitPrice:function(){var t=this,e={api:"post",url:this.$store.state.http+"SO/SORefreshPrice",data:{Id:this.$store.state.Vuex.SOId}};this.$https(e).then(function(e){t.init()})},inits:function(){this.init(),this.pricesOfPartsJS(),this.ShowAdd=!0},init:function(){var t=this,e={api:"get",url:this.$store.state.http+"SO/GetSo",data:{soId:this.$store.state.Vuex.SOId}};this.$https(e).then(function(e){console.log(e.Data),t.CusId=e.Data.CusId,t.Data=JSON.parse(r()(e.Data)),console.log(JSON.parse(r()(t.Data))),t.SOEquipmentList=e.Data.SOEquipmentList,console.log(t.SOEquipmentList),t.TotalPrice=e.Data.TotalPrice,t.Discount=Number(t.TotalPrice.DiscountProportion),t.TravelAmount=String(t.TotalPrice.TravelAmount),t.TravelAmounts=Number(t.TotalPrice.TravelAmount),t.Consignee=e.Data.Consignee,t.State=Number(e.Data.State),t.BelongCompany=e.Data.BelongCompany,t.SoQuoteType=e.Data.SoQuoteType,t.pricesOfPartsJS(),t.DiscountAmount=Number(t.TotalPrice.DiscountAmount),0==Number(t.TotalPrice.DiscountAmount)&&(t.DiscountAmountIndex=!0,t.pricesOfPartsJS()),console.log(t.Data.Deliverys);for(var a=[],n=0;n<t.Data.Deliverys.length;n++){for(var o=t.Data.Deliverys[n].DeliveryDetails,s=[],i=0,l=o.length;i<l;i++){for(var u=0,c=s.length;u<c;u++)if(o[i].ProductId===s[u].ProductId){s[u].Number+=o[i].Number;break}u===c&&s.push(o[i])}console.log(s),a.push(s)}console.log(JSON.parse(r()(a))),t.DeliDetails=a;for(var p=0;p<a.length;p++)for(var d=a[p],h=0;h<d.length;h++){var m=d[h];console.log(p);for(var v=0;v<t.SOEquipmentList.length;v++){var f=t.SOEquipmentList[v].ProductId;console.log(t.SOEquipmentList[v].Locations);var b="Number"+p;m.ProductId==f&&(t.SOEquipmentList[v][b]=m.Number)}}console.log(t.SOEquipmentList);for(var S=0;S<t.SOEquipmentList.length;S++){var g=t.SOEquipmentList[S];g.PurchaseUnitPrice=g.BuyingUnitPrice+" "+g.BuyingCurrency;for(var _=g.Locations.split("、"),y=[],C=0;C<_.length;C++){var w=_[C];y[C]={name:w,Number:g.Number},t.$set(y[C],"value","");var D=w;-1!=D.indexOf("供应商库")&&(D=D.split("-")[0]+"["+D.split("[")[1]),t.$set(y[C],"name2",D)}g.arr=y}console.log(t.SOEquipmentList),t.ShipmentQuantity=[];for(var x=0,I=0;I<t.SOEquipmentList.length;I++){var O=t.SOEquipmentList[I];O.Locations=O.Locations.split("[")[0],"RMB"==O.BuyingCurrency?x+=Number(O.BuyingUnitPrice)*O.Number:x+=10*Number(O.BuyingUnitPrice)*O.Number}t.TotalPrice.NumberCG=x,t.rowDrops()})},Edit:function(t){var e=this;if(console.log(t),""==this.BelongCompany||null==this.BelongCompany||void 0==this.BelongCompany)return this.$message.warning("请选择隶属公司！"),!1;if(""==this.Consignee.Name||null==this.Consignee.Name||void 0==this.Consignee.Name)return this.$message.warning("请输入收货人姓名！"),!1;if(""==this.Consignee.MobilePhone||null==this.Consignee.MobilePhone||void 0==this.Consignee.MobilePhone)return this.$message.warning("请输入收货人手机！"),!1;if(""==this.Consignee.Address||null==this.Consignee.Address||void 0==this.Consignee.Address)return this.$message.warning("请输入收货人地址！"),!1;var a={api:"post",url:this.$store.state.http+"SO/UpdateSOState",data:{SoId:this.$store.state.Vuex.SOId,SOStatus:t,QuoteCode:"",IsNeedInstall:""}};return 1==t&&(a.url=this.$store.state.http+"SO/ConfirmSO"),7==t&&(a.url=this.$store.state.http+"SO/CancelSO"),1==this.State?(this.$https(a).then(function(t){e.$emit("refresh"),e.$router.push({path:"/SpareParts"})}),!1):3==t?(this.$confirm(" 是否需要安装?","提示",{confirmButtonText:"需要",cancelButtonText:"不需要",distinguishCancelAndClose:!0,type:"warning"}).then(function(){a.data.IsNeedInstall=!0,e.$https(a).then(function(t){e.$emit("refresh"),e.$router.push({path:"/SpareParts"})})}).catch(function(t){if("cancel"!=t)return!1;a.data.IsNeedInstall=!1,e.$https(a).then(function(t){e.$emit("refresh"),e.$router.push({path:"/SpareParts"})})}),!1):void this.$https(a).then(function(t){e.$emit("refresh"),e.$router.push({path:"/SpareParts"})})},AddSb:function(){this.$router.push({path:"/AddOrderMsg"}),this.ShowAdd=!1},AddOrderindex:function(){this.$router.push({path:"/AddOrderindex2"})}}},m={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"box_s"},[a("div",{staticClass:"router"}),t._v(" "),a("div",{staticClass:"box_s2"},[a("router-view",{on:{refresh:t.inits}}),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.ShowAdd,expression:"ShowAdd"}],staticStyle:{width:"100%；height：100%"}},[a("div",{staticClass:"message_header",on:{click:t.ResetMC}},[t._v("基础信息")]),t._v(" "),a("div",{staticClass:"text itemxxxxX"},[a("p",[a("span",[t._v("客户:")]),t._v(t._s(t.Data.CusName+"【"+(t.Data.BelongEnginners||" - ")+"】"))])]),t._v(" "),a("div",{staticClass:"text itemxxxxx"},[a("p",[a("span",[t._v("订单单号:")]),t._v(t._s(t.Data.SOCode))])]),t._v(" "),a("div",{staticClass:"text itemxxxxx"},[a("p",[a("span",[t._v("报价单号:")]),t._v(t._s(t.Data.QuoteCode||" - "))])]),t._v(" "),a("div",{staticClass:"text itemxxxxx"},[a("p",[a("span",[t._v("状态:")]),t._v(t._s(t.Data.StateStr))])]),t._v(" "),a("div",{staticClass:"text itemxxxxx"},[a("p",[a("span",[t._v("是否需要安装:")]),t._v(t._s(t.Data.IsNeedInstall?"是":"否"))])]),t._v(" "),a("div",{staticClass:"text itemxxxxx"},[a("p",[a("span",[t._v("工程师是否完成任务:")]),t._v(t._s(t.Data.CompleteTheTask?"是":"否"))])]),t._v(" "),a("div",{staticClass:"text itemxxxxx"},[null==t.Data.CompleteTheTaskDt?a("p",[a("span",[t._v("工程师完成任务时间:")]),t._v(" -- ")]):t._e(),t._v(" "),null!=t.Data.CompleteTheTaskDt?a("p",[a("span",[t._v("工程师完成任务时间:")]),t._v(t._s(t.Data.CompleteTheTaskDt.split("T")[0])+"\n                ")]):t._e()]),t._v(" "),a("div",{staticClass:"text itemxxxxx"},[null==t.Data.PayDate?a("p",[a("span",[t._v("付款时间:")]),t._v(" -- ")]):t._e(),t._v(" "),null!=t.Data.PayDate?a("p",[a("span",[t._v("付款时间:")]),t._v(t._s(t.Data.PayDate.split("T")[0]))]):t._e()]),t._v(" "),a("div",{staticClass:"text itemxxxxx"},[a("p",[a("span",[t._v("报价类型:")]),t._v(" "),a("el-select",{staticStyle:{width:"150px"},attrs:{size:"mini",placeholder:"请选择AS/SP"},model:{value:t.SoQuoteType,callback:function(e){t.SoQuoteType=e},expression:"SoQuoteType"}},t._l(t.optionsASAndSP,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1)]),t._v(" "),a("div",{staticClass:"text itemxxxxx"},[a("p",[a("span",[t._v("隶属公司:")]),t._v(" "),a("el-select",{staticStyle:{width:"150px"},attrs:{size:"mini",placeholder:"请选择"},model:{value:t.BelongCompany,callback:function(e){t.BelongCompany=e},expression:"BelongCompany"}},t._l(t.options,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1)]),t._v(" "),a("div",{staticClass:"text itemxxxx9"},[a("p",[a("span",[t._v("工程师备注:")]),t._v(t._s(t.Data.EngineerMemo)+"\n                ")])]),t._v(" "),a("div",{staticClass:"textNB"},[a("div",{staticStyle:{}},[t._v("备注：")]),t._v(" "),a("el-input",{staticStyle:{float:"left",width:"500px"},attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"请输入内容"},model:{value:t.Data.Memo,callback:function(e){t.$set(t.Data,"Memo",e)},expression:"Data.Memo"}})],1),t._v(" "),a("div",{staticClass:"message_header"},[t._v("\n                设备清单\n                "),1==t.State||2==t.State||0==t.State?a("el-button",{staticStyle:{float:"right",marginLeft:"10px"},attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.ReverseSelection()}}},[t._v("反选所有安装")]):t._e(),t._v(" "),1==t.State||2==t.State||0==t.State?a("el-button",{staticStyle:{float:"right",marginLeft:"10px"},attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.AddOrderindex()}}},[t._v("从零件图添加设备")]):t._e(),t._v(" "),1==t.State||2==t.State||0==t.State?a("el-button",{staticStyle:{float:"right",marginLeft:"10px"},attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.AddSb()}}},[t._v("从产品资料库添加设备")]):t._e(),t._v(" "),1==t.State||2==t.State||0==t.State?a("el-button",{staticStyle:{float:"right"},attrs:{size:"mini",type:"primary"},on:{click:t.RefreshOrderUnitPrice}},[t._v("刷新订单设备单价")]):t._e()],1),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.Data.ShowPurchase,expression:"Data.ShowPurchase"}]},[a("el-table",{staticStyle:{width:"98%",marginTop:"10px",float:"left"},attrs:{data:t.SOEquipmentList,size:"mini","highlight-current-row":"",border:"","header-cell-style":{background:"#e1e1e1"}}},[a("el-table-column",{attrs:{type:"index",label:"序号",width:"50"}}),t._v(" "),a("el-table-column",{attrs:{prop:"ProcodeCode",label:"产品编号",width:"150"}}),t._v(" "),a("el-table-column",{attrs:{prop:"Brand",label:"品牌",width:"150"}}),t._v(" "),a("el-table-column",{attrs:{prop:"Desc",label:"描述","show-overflow-tooltip":!0}}),t._v(" "),a("el-table-column",{attrs:{label:"数量",width:"70"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("input",{directives:[{name:"model",rawName:"v-model",value:e.row.Number,expression:"scope.row.Number"}],staticStyle:{width:"100%"},attrs:{type:"text",min:1},domProps:{value:e.row.Number},on:{change:function(e){return t.pricesOfPartsJS()},input:function(a){a.target.composing||t.$set(e.row,"Number",a.target.value)}}})]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"库位",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row.arr,function(e,n){return a("p",{key:n},[t._v(t._s(e.name2))])})}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"NetInventory",label:"库存",width:"70"}}),t._v(" "),a("el-table-column",{attrs:{prop:"PurchaseUnitPrice",label:"采购单价",width:"120"}}),t._v(" "),a("el-table-column",{attrs:{prop:"UnitPrice",label:"销售单价",width:"90"}}),t._v(" "),a("el-table-column",{attrs:{prop:"AssemblyPeice",label:"安装费单价",width:"90"}}),t._v(" "),a("el-table-column",{attrs:{label:"甲方安装",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:t.pricesOfPartsJS},model:{value:e.row.IsAssembly,callback:function(a){t.$set(e.row,"IsAssembly",a)},expression:"scope.row.IsAssembly"}})]}}])}),t._v(" "),1==t.State||2==t.State?a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-delete"},on:{click:function(a){return t.dele(e.row)}}})]}}],null,!1,4094896075)}):t._e()],1)],1),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.Data.ShowPurchase,expression:"!Data.ShowPurchase"}]},[a("el-table",{staticStyle:{width:"98%",marginTop:"10px",float:"left"},attrs:{data:t.SOEquipmentList,size:"mini","highlight-current-row":"",border:"","header-cell-style":{background:"#e1e1e1"}}},[a("el-table-column",{attrs:{type:"index",label:"序号",width:"50"}}),t._v(" "),a("el-table-column",{attrs:{prop:"ProcodeCode",label:"产品编号",width:"150"}}),t._v(" "),a("el-table-column",{attrs:{prop:"Brand",label:"品牌",width:"150"}}),t._v(" "),a("el-table-column",{attrs:{prop:"Desc",label:"描述","show-overflow-tooltip":!0}}),t._v(" "),a("el-table-column",{attrs:{label:"数量",width:"70"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("input",{directives:[{name:"model",rawName:"v-model",value:e.row.Number,expression:"scope.row.Number"}],staticStyle:{width:"100%"},attrs:{type:"text",min:1},domProps:{value:e.row.Number},on:{change:function(e){return t.pricesOfPartsJS()},input:function(a){a.target.composing||t.$set(e.row,"Number",a.target.value)}}})]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"库位",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row.arr,function(e,n){return a("p",{key:n},[t._v(t._s(e.name2))])})}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"NetInventory",label:"库存",width:"70"}}),t._v(" "),a("el-table-column",{attrs:{prop:"UnitPrice",label:"销售单价",width:"90"}}),t._v(" "),a("el-table-column",{attrs:{prop:"AssemblyPeice",label:"安装费单价",width:"90"}}),t._v(" "),a("el-table-column",{attrs:{label:"甲方安装",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:t.pricesOfPartsJS},model:{value:e.row.IsAssembly,callback:function(a){t.$set(e.row,"IsAssembly",a)},expression:"scope.row.IsAssembly"}})]}}])}),t._v(" "),1==t.State||2==t.State?a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-delete"},on:{click:function(a){return t.dele(e.row)}}})]}}],null,!1,4094896075)}):t._e()],1)],1),t._v(" "),a("br"),t._v(" "),a("div",{staticClass:"message_header"},[t._v("\n                费用合计\n                "),a("el-button",{staticStyle:{float:"right",marginLeft:"10px"},attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.Orderlistmag()}}},[t._v("报价单")])],1),t._v(" "),a("div",{staticClass:"segation"},[a("el-input",{attrs:{placeholder:"",size:"mini"},on:{change:t.pricesOfPartsJS},model:{value:t.TotalPrice.LogisticCharge,callback:function(e){t.$set(t.TotalPrice,"LogisticCharge",e)},expression:"TotalPrice.LogisticCharge"}},[a("template",{slot:"prepend"},[t._v("空运费：￥")])],2),t._v(" "),a("el-autocomplete",{staticClass:"inline-input",staticStyle:{width:"250px"},attrs:{size:"mini","show-overflow-tooltip":!0,"fetch-suggestions":t.querySearch,placeholder:"请选择市区",clearable:"","automatic-dropdown":!0},on:{select:t.handleSelect,clear:t.Qingk,input:t.InoutgB},model:{value:t.TravelAmount,callback:function(e){t.TravelAmount=e},expression:"TravelAmount"}},[a("template",{slot:"prepend"},[t._v("差旅费：￥")])],2),t._v(" "),t.Data.ShowPurchase?a("el-input",{attrs:{placeholder:"",size:"mini",disabled:""},model:{value:t.TotalPrice.NumberCG,callback:function(e){t.$set(t.TotalPrice,"NumberCG",e)},expression:"TotalPrice.NumberCG"}},[a("template",{slot:"prepend"},[t._v("采购总金额：￥")])],2):t._e(),t._v(" "),a("el-input",{attrs:{placeholder:"",size:"mini",disabled:""},model:{value:t.TotalPrice.Amount,callback:function(e){t.$set(t.TotalPrice,"Amount",e)},expression:"TotalPrice.Amount"}},[a("template",{slot:"prepend"},[t._v("产品总金额：￥")])],2),t._v(" "),a("el-input",{attrs:{placeholder:"",size:"mini"},on:{change:t.pricesOfPartsJS},model:{value:t.Discount,callback:function(e){t.Discount=e},expression:"Discount"}},[a("template",{slot:"prepend"},[t._v("优惠比例（%）：")])],2),t._v(" "),a("el-input",{attrs:{placeholder:"",size:"mini"},model:{value:t.DiscountAmount,callback:function(e){t.DiscountAmount=e},expression:"DiscountAmount"}},[a("template",{slot:"prepend"},[t._v("优惠后金额：￥")])],2),t._v(" "),a("el-input",{staticStyle:{width:"300px"},attrs:{placeholder:"",size:"mini"},model:{value:t.Data.QuoteCode,callback:function(e){t.$set(t.Data,"QuoteCode",e)},expression:"Data.QuoteCode"}},[a("template",{slot:"prepend"},[t._v("报价单号：")])],2)],1),t._v(" "),3==t.State||4==t.State||6==t.State||8==t.State?a("div",[a("div",{staticClass:"message_header"},[t._v("发货\n                    "),t.Data.IsAS?a("span",{staticStyle:{float:"right",color:"red"}},[t._v("当前客户为保养大包(AS)客户，优先使用AS专用配件")]):t._e()]),t._v(" "),a("el-input",{staticStyle:{width:"400px",marginTop:"10px",float:"right"},attrs:{placeholder:"",size:"mini"},model:{value:t.GoodsDH,callback:function(e){t.GoodsDH=e},expression:"GoodsDH"}},[a("template",{slot:"prepend"},[t._v("物流信息:")])],2),t._v(" "),a("el-table",{staticStyle:{width:"100%",marginTop:"10px",float:"left"},attrs:{data:t.SOEquipmentList,size:"mini","highlight-current-row":"",border:"","header-cell-style":{background:"#e1e1e1"}}},[a("el-table-column",{attrs:{type:"index",label:"序号",width:"50"}}),t._v(" "),a("el-table-column",{attrs:{prop:"ProcodeCode",label:"产品编号",width:"150"}}),t._v(" "),a("el-table-column",{attrs:{prop:"Brand",label:"品牌",width:"150"}}),t._v(" "),a("el-table-column",{attrs:{prop:"Desc",label:"描述","show-overflow-tooltip":!0}}),t._v(" "),a("el-table-column",{attrs:{label:"库位",width:"90"},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row.arr,function(e,n){return a("p",{key:n},[t._v(t._s(e.name2))])})}}],null,!1,3367164509)}),t._v(" "),a("el-table-column",{attrs:{prop:"NetInventory",label:"库存",width:"70"}}),t._v(" "),a("el-table-column",{attrs:{prop:"Number",label:"订单数量",width:"80"}}),t._v(" "),t._l(t.DeliDetails,function(e,n){return a("el-table-column",{key:n,attrs:{label:"发货单",width:"100",prop:t.NumberIndex(n)}},[a("template",{slot:"header"},[a("p",{staticStyle:{color:"#409EFF"},on:{click:function(e){return t.DownloadShippingList(n)}}},[t._v(t._s("发货单"+(n+1))+"\n                                "),a("i",{staticClass:"el-icon-download"})])])],2)}),t._v(" "),3==t.State||8==t.State||4==t.State?a("el-table-column",{attrs:{fixed:"right",label:"发货",width:"90"},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row.arr,function(e,n){return a("input",{directives:[{name:"model",rawName:"v-model",value:e.value,expression:"item12.value"}],key:n,attrs:{type:"number",size:"mini"},domProps:{value:e.value},on:{input:function(a){a.target.composing||t.$set(e,"value",a.target.value)}}})})}}],null,!1,1848928233)}):t._e()],2),t._v(" "),a("div",{staticStyle:{width:"100%",float:"left",padding:"10px","box-sizing":"border-box","text-align":"right"}},[3==t.State||8==t.State||4==t.State?a("saxo-button",{attrs:{mini:""},on:{click:t.deliverGoods}},[t._v("发货")]):t._e(),t._v("\n                     \n                    "),3==t.State||8==t.State||4==t.State||6==t.State?a("saxo-button",{attrs:{mini:"",type:"success"},on:{click:t.Invoice}},[t._v("发货单")]):t._e(),t._v("\n                     \n                    "),a("saxo-button",{attrs:{mini:""},on:{click:function(e){return t.oneClickShipping()}}},[t._v("一键发货")])],1)],1):t._e(),t._v(" "),a("div",{staticClass:"message_header"},[t._v("收货人\n                "),1==t.State||2==t.State||0==t.State?a("el-button",{staticStyle:{float:"right",marginLeft:"10px"},attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.SelectConsignee()}}},[t._v("选择收货人")]):t._e()],1),t._v(" "),a("div",{staticClass:"consignee"},[a("span",[t._v("姓名：")]),t._v(" "),a("el-input",{attrs:{size:"mini"},model:{value:t.Consignee.Name,callback:function(e){t.$set(t.Consignee,"Name",e)},expression:"Consignee.Name"}})],1),t._v(" "),a("div",{staticClass:"consignee"},[a("span",[t._v("英文名：")]),t._v(" "),a("el-input",{attrs:{size:"mini"},model:{value:t.Consignee.EnginnerName,callback:function(e){t.$set(t.Consignee,"EnginnerName",e)},expression:"Consignee.EnginnerName"}})],1),t._v(" "),a("div",{staticClass:"consignee"},[a("span",[t._v("手机：")]),t._v(" "),a("el-input",{attrs:{size:"mini"},model:{value:t.Consignee.MobilePhone,callback:function(e){t.$set(t.Consignee,"MobilePhone",e)},expression:"Consignee.MobilePhone"}})],1),t._v(" "),a("div",{staticClass:"consignee"},[a("span",[t._v("电话：")]),t._v(" "),a("el-input",{attrs:{size:"mini"},model:{value:t.Consignee.Tel,callback:function(e){t.$set(t.Consignee,"Tel",e)},expression:"Consignee.Tel"}})],1),t._v(" "),a("div",{staticClass:"consignee"},[a("span",[t._v("邮箱：")]),t._v(" "),a("el-input",{attrs:{size:"mini"},model:{value:t.Consignee.EMail,callback:function(e){t.$set(t.Consignee,"EMail",e)},expression:"Consignee.EMail"}})],1),t._v(" "),a("div",{staticClass:"consignee",staticStyle:{width:"800px"}},[a("span",[t._v("地址：")]),t._v(" "),a("el-input",{attrs:{size:"mini"},model:{value:t.Consignee.Address,callback:function(e){t.$set(t.Consignee,"Address",e)},expression:"Consignee.Address"}})],1),t._v(" "),a("div",{staticClass:"message_header"},[t._v("\n                付款清单\n                "),"AS"!=t.SoQuoteType&&-1!=[3,4,5,6].indexOf(t.Data.State)?a("saxo-button",{staticStyle:{float:"right","margin-top":"13px"},attrs:{mini:"",type:"primary"},on:{click:function(e){return t.paymentList()}}},[t._v("认款")]):t._e()],1),t._v(" "),a("div",{staticClass:"setUp"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.Data.SOPayments,"header-cell-style":t.$store.state.headerCellStyle,"cell-style":t.$store.state.cellStyle,stripe:""}},[a("el-table-column",{attrs:{label:"付款金额"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                            "+t._s(t.FinancialAmountFormat(e.row.PaymentAmount))+"\n                        ")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"付款比例"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                            "+t._s((e.row.PaymentAmount/t.DiscountAmount*100).toFixed(2)+"%")+"\n                        ")]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"Confirmer",label:"确认人_财务"}}),t._v(" "),a("el-table-column",{attrs:{prop:"ConfirmDt",label:"确认日期"}}),t._v(" "),a("el-table-column",{attrs:{label:"系统信息","show-overflow-tooltip":!0},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-popover",{attrs:{placement:"top-start",title:"系统信息",trigger:"hover"}},[t._l(e.row.SystemInfo.split("@"),function(e,n){return a("p",{key:n},[t._v(t._s(e))])}),t._v(" "),a("span",{attrs:{slot:"reference"},slot:"reference"},[t._v("系统信息"),a("i",{staticClass:"el-icon-warning-outline"})])],2)]}}])})],1)],1),t._v(" "),a("div",{staticClass:"message_header"},[t._v("\n                发票清单\n                "),"AS"!=t.SoQuoteType&&-1!=[3,4,5,6].indexOf(t.Data.State)?a("saxo-button",{staticStyle:{float:"right","margin-top":"13px"},attrs:{mini:"",type:"primary"},on:{click:function(e){return t.AddSOInvoice()}}},[t._v("申请开票")]):t._e()],1),t._v(" "),a("el-table",{staticStyle:{width:"98%",marginTop:"10px",float:"left"},attrs:{data:t.Data.InvoiceDtos,size:"mini","highlight-current-row":"",border:"","header-cell-style":{background:"#e1e1e1"}}},[a("el-table-column",{attrs:{label:"创建时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.CreateDate.split("T")[0]))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"发票金额",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticStyle:{float:"right"}},[t._v(" "+t._s(t.FinancialAmountFormat(e.row.Amount)))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"发票比例",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticStyle:{float:"right"}},[t._v(t._s((e.row.Amount/t.DiscountAmount*100).toFixed(2)+"%"))])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"Creater",label:"申请人"}}),t._v(" "),a("el-table-column",{attrs:{prop:"Confirmer",label:"财务确认人"}}),t._v(" "),a("el-table-column",{attrs:{prop:"InvoiceStateStr",label:"发票状态"}}),t._v(" "),a("el-table-column",{attrs:{prop:"Receiver",label:"收票人"}}),t._v(" "),a("el-table-column",{attrs:{prop:"ReceiverEmail",label:"收票人邮箱"}}),t._v(" "),a("el-table-column",{attrs:{prop:"Logistics",label:"物流单号"}}),t._v(" "),a("el-table-column",{attrs:{prop:"InvCode",label:"发票号"}}),t._v(" "),a("el-table-column",{attrs:{label:"操作",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.InvoiceState?a("saxo-button",{attrs:{mini:"",type:"danger"},on:{click:function(a){return t.DeleteInvoices(e.row)}}},[t._v("删除发票")]):t._e(),t._v(" "),2==e.row.InvoiceState?a("saxo-button",{attrs:{mini:"",type:"success"},on:{click:function(a){return t.OperationInvoice(e.row)}}},[t._v("申请操作")]):t._e()]}}])})],1),t._v(" "),a("br"),t._v(" "),t.RebateData!=[]?a("div",{staticClass:"message_header"},[t._v("返点\n                "),a("el-link",{attrs:{type:"info",underline:!1},on:{click:function(e){t.ViewRebate=!t.ViewRebate}}},[t._v("查看返点("+t._s(t.RebateData.length)+"\n                    条)")]),t._v(" "),!t.ViewRebate||3!=t.State&&4!=t.State&&5!=t.State&&6!=t.State?t._e():a("el-button",{staticClass:"C33 animate__animated animate__fadeInDown",attrs:{size:"mini",type:"success",loading:this.$store.state.Vuex.loading},on:{click:function(e){t.RebateState=!0}}},[t._v("创建返点")])],1):t._e(),t._v(" "),t.ViewRebate?a("el-table",{staticClass:"animate__animated animate__fadeInDown",staticStyle:{width:"100%"},attrs:{data:t.RebateData,size:"mini","highlight-current-row":"",border:"","header-cell-style":{background:"#e1e1e1"}}},[a("el-table-column",{attrs:{prop:"CreateDate",label:"创建时间"}}),t._v(" "),a("el-table-column",{attrs:{prop:"Type",label:"类型"}}),t._v(" "),a("el-table-column",{attrs:{prop:"SourceType",label:"来源业务","show-overflow-tooltip":!0}}),t._v(" "),a("el-table-column",{attrs:{prop:"CusFullName",label:"客户"}}),t._v(" "),a("el-table-column",{attrs:{prop:"StateStr",label:"状态"}}),t._v(" "),a("el-table-column",{attrs:{prop:"Amount",label:"金额","show-overflow-tooltip":!0}})],1):t._e(),t._v(" "),a("el-dialog",{attrs:{title:"返点",visible:t.RebateState,width:"30%","modal-append-to-body":!1,"before-close":t.handleClose},on:{"update:visible":function(e){t.RebateState=e}}},[a("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"来源业务"}},[a("el-select",{attrs:{placeholder:"请选择来源业务",size:"mini"},model:{value:t.form.SourceType,callback:function(e){t.$set(t.form,"SourceType",e)},expression:"form.SourceType"}},[a("el-option",{attrs:{label:"零配件销售",value:"零配件销售"}})],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"类型"}},[a("el-select",{attrs:{placeholder:"请选择类型",size:"mini"},model:{value:t.form.region,callback:function(e){t.$set(t.form,"region",e)},expression:"form.region"}},[a("el-option",{attrs:{label:"现金",value:"1"}}),t._v(" "),a("el-option",{attrs:{label:"购物卡",value:"2"}}),t._v(" "),a("el-option",{attrs:{label:"其他",value:"3"}})],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"金额"}},[a("el-input-number",{attrs:{min:0,max:99999999,label:"金额",size:"mini"},model:{value:t.form.num,callback:function(e){t.$set(t.form,"num",e)},expression:"form.num"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"备注"}},[a("el-input",{attrs:{type:"textarea",rows:4,placeholder:"请输入内容"},model:{value:t.form.textarea,callback:function(e){t.$set(t.form,"textarea",e)},expression:"form.textarea"}})],1)],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini"},on:{click:function(e){t.RebateState=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.onSubmit}},[t._v("确 定")])],1)],1),t._v(" "),a("saxo-pop",{ref:"primary",attrs:{type:"primary",title:"关于退(换)货操作指南",width:"800px"},on:{close:function(e){return t.$refs.primary.start()}}},[a("h3",[t._v("1、退货时")]),t._v(" "),a("br"),t._v(" "),a("p",[t._v(" 1.如财务已收款，退货时可选择要退的货物，并填写需要退款的金额 ")]),t._v(" "),a("p",[t._v(" 2.如财务未收款，退货时只选择要退的货物，不填写退款金额或者退款金额填写0")]),t._v(" "),a("p",[t._v(" 3.向财务部发送退货的确认函，财务部根据确认函更新大表")]),t._v(" "),a("p",[t._v(" 4.财务部在系统中操作退款(退款金额不为0时)，物流部在系统中操作收货 ")]),t._v(" "),a("br"),t._v(" "),a("h3",[t._v(" 2、换货时 ")]),t._v(" "),a("br"),t._v(" "),a("p",[t._v(" 1.执行退货操作 ")]),t._v(" "),a("p",[t._v(" 2.发起新订单，新订单的金额要求与退款的金额一致")]),t._v(" "),a("p",[t._v(" 3.新订单的确认函中应包括以下信息：旧订单的信息、使用挂账款(退款额)付款 ")]),t._v(" "),a("p",[t._v(" 4.财务部根据确认函在系统中操作收款")])]),t._v(" "),t.RebateData!=[]?a("div",{staticClass:"message_header"},[t._v("退货\n                "),a("el-link",{attrs:{type:"info",underline:!1},on:{click:function(e){t.returngoods=!t.returngoods}}},[t._v("查看退货("+t._s(t.Data.MsoReturnDtos.length)+" 条)")]),t._v(" "),t.returngoods?a("el-button",{staticClass:"C33 animate__animated animate__fadeInDown",attrs:{size:"mini",type:"success"},on:{click:function(e){return t.ReturnRefund_fun()}}},[t._v("创建退货")]):t._e(),t._v(" "),t.returngoods?a("el-link",{staticClass:"C33 animate__animated animate__fadeInDown",attrs:{type:"warning"},on:{click:function(e){return t.$refs.primary.start()}}},[t._v("关于退(换)货操作指南")]):t._e()],1):t._e(),t._v(" "),t.returngoods?a("el-table",{staticClass:"animate__animated animate__fadeInDown",staticStyle:{width:"100%"},attrs:{data:t.Data.MsoReturnDtos,size:"mini","highlight-current-row":"",border:"","header-cell-style":{background:"#e1e1e1"}}},[a("el-table-column",{attrs:{label:"创建时间","header-align":"center",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(" "+t._s(e.row.CreateDate.split("T")[0]))])]}}],null,!1,338188898)}),t._v(" "),a("el-table-column",{attrs:{label:"金额","header-align":"center",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticStyle:{float:"right"}},[t._v(" "+t._s(t.FinancialAmountFormat(e.row.TotalAmount)))])]}}],null,!1,4119309815)}),t._v(" "),a("el-table-column",{attrs:{label:"挂账款","header-align":"center",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticStyle:{float:"right"}},[t._v(" "+t._s(t.FinancialAmountFormat(e.row.BuyerBuyingOnCreditAmount)))])]}}],null,!1,1224542542)}),t._v(" "),a("el-table-column",{attrs:{prop:"InvoiceStateStr",label:"发票状态"}}),t._v(" "),a("el-table-column",{attrs:{prop:"Creater",label:"申请人"}}),t._v(" "),a("el-table-column",{attrs:{prop:"PayStateStr",label:"付款状态"}}),t._v(" "),a("el-table-column",{attrs:{prop:"ReturnStateStr",label:"任务状态"}}),t._v(" "),a("el-table-column",{attrs:{label:"操作","header-align":"center",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"info",size:"mini"},on:{click:function(a){return t.LookReturnRefund_fun(e.row)}}},[t._v("查看")])]}}],null,!1,2526433405)})],1):t._e(),t._v(" "),a("div",{staticStyle:{width:"98%",border:"1px solid #fff",float:"left"}}),t._v(" "),0==t.State||1==t.State||2==t.State?a("el-button",{staticClass:"C33",attrs:{size:"mini",type:"danger"},on:{click:function(e){return t.SaveOrder(7)}}},[t._v("撤单")]):t._e(),t._v(" "),0==t.State?a("el-button",{staticClass:"C33",attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.SaveOrder(1)}}},[t._v("提交")]):t._e(),t._v(" "),1==t.State||2==t.State||7==t.State?a("el-button",{staticClass:"C33",attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.SaveOrder(2)}}},[t._v("报价")]):t._e(),t._v(" "),2==t.State?a("el-button",{staticClass:"C33",attrs:{size:"mini",type:"success"},on:{click:function(e){return t.SaveOrder(3)}}},[t._v("确认报价")]):t._e(),t._v(" "),6!=t.State&&3!=t.State&&4!=t.State&&5!=t.State||""==t.Data.BelongEnginners||t.Data.CompleteTheTask?t._e():a("el-button",{staticClass:"C33",attrs:{size:"mini",type:"success"},on:{click:function(e){return t.CompleteTheTask()}}},[t._v("工程师完成任务")]),t._v(" "),t.Data.CompleteTheTask?a("el-button",{staticClass:"C33",attrs:{size:"mini",type:"info",plain:"",disabled:""}},[t._v("工程师完成任务")]):t._e(),t._v(" "),1==t.State||2==t.State?a("el-button",{staticStyle:{float:"left",margin:"10px"},attrs:{size:"mini",type:"primary"},on:{click:function(e){return t.SaveOrder("BC")}}},[t._v("保存")]):t._e()],1),t._v(" "),a("el-dialog",{attrs:{title:"选择收货人",visible:t.dialogTableVisible,"modal-append-to-body":!1},on:{"update:visible":function(e){t.dialogTableVisible=e}}},[a("el-table",{attrs:{data:t.gridData},on:{"row-click":t.ConsigneeS}},[a("el-table-column",{attrs:{property:"Name",label:"姓名",width:"100"}}),t._v(" "),a("el-table-column",{attrs:{property:"Mobile",label:"手机",width:"150"}}),t._v(" "),a("el-table-column",{attrs:{property:"Email",label:"邮箱",width:"260"}}),t._v(" "),a("el-table-column",{attrs:{property:"Address",label:"地址"}})],1)],1)],1),t._v(" "),a("SaxoDrawer",{attrs:{show:t.SaxoDrawer,title:t.Data.CusName+"(挂账款 & 不明款 & 资金池)"},on:{ShowFalse:function(e){t.SaxoDrawer=!1}}},[a("div",{staticClass:"DeawerBox"},[a("div",{staticClass:"table"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.CapitalPoolDtos,height:"100%"}},[a("el-table-column",{attrs:{label:"类别",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return["挂帐款"==e.row.LB?a("span",[t._v(" "+t._s(e.row.LB+"("+e.row.InvoiceStateStr+")"))]):t._e(),t._v(" "),"挂帐款"!=e.row.LB?a("span",[t._v(" "+t._s(e.row.LB))]):t._e()]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"资金量",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticStyle:{float:"right"}},[t._v(" "+t._s(t.FinancialAmountFormat(e.row.Amount,t.FinancialAmountSymbol(e.row.BuyingCurrency))))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"使用量",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticStyle:{float:"right"}},[t._v(" "+t._s(t.FinancialAmountFormat(e.row.UsageAmount,t.FinancialAmountSymbol(e.row.BuyingCurrency))))])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"Creater",label:"创建人",width:"120"}}),t._v(" "),a("el-table-column",{attrs:{prop:"CreateDate",label:"创建时间",width:"120"}}),t._v(" "),a("el-table-column",{attrs:{prop:"StateStr",label:"状态",width:"120"}}),t._v(" "),a("el-table-column",{attrs:{label:"系统信息","show-overflow-tooltip":!0,width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-popover",{attrs:{placement:"top-start",title:"系统信息",trigger:"hover"}},[t._l(e.row.SystemInfo2,function(e,n){return a("p",{key:n},[t._v(t._s(e))])}),t._v(" "),a("span",{attrs:{slot:"reference"},slot:"reference"},[t._v("系统信息"),a("i",{staticClass:"el-icon-warning-outline"})])],2)]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"Memo",label:"备注"}}),t._v(" "),a("el-table-column",{attrs:{label:"使用量",fixed:"right",width:"150px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{size:"mini",type:"number",placeholder:"请输入使用量"},model:{value:e.row.Number,callback:function(a){t.$set(e.row,"Number",a)},expression:"scope.row.Number"}})]}}])})],1)],1),t._v(" "),a("div",{staticClass:"but"},[a("div",[t._v("认款合计 ￥"),a("span",[t._v(" "+t._s(t.Subscription))])]),t._v(" "),a("div",[t._v("优惠后价格 ￥"),a("span",[t._v(" "+t._s(t.DiscountAmount))])]),t._v(" "),a("saxo-button",{staticClass:"butState",attrs:{mini:"",type:"primary"},on:{click:t.AddMSOPaymentFun}},[t._v("确认")])],1)])])],1)},staticRenderFns:[]};var v=a("VU/8")(h,m,!1,function(t){a("IzpI")},"data-v-5cea12b9",null);e.default=v.exports}});