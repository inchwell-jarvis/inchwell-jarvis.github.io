webpackJsonp([52],{"+Kn5":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("Xu46"),n={data:function(){return{autoplay:!0,oIndex:0,To:1,loading:!0,dialogVisible:!1,dialogVisibleMainGraph:!1,activeName:"first",uploadFileUrlapp:"https://httpbin.org/post",UpTitle:"",col:[{label:"序号",prop:"Pos",width:"50",sortable:!0},{label:"标题",prop:"ProductCode",width:"200",sortable:!0},{label:"创建时间",prop:"Brand",width:"200",sortable:!0}],dropCol:[{label:"删除",prop:"Pos",width:"50",sortable:!0},{label:"标题",prop:"Title",width:"200",sortable:!0},{label:"创建时间",prop:"CreateDate",width:"200",sortable:!0}],tableData:[],imageUrlList:[],imgVideoBase64List:[],imageUrl:{}}},computed:{},watch:{},methods:{clickChange:function(e){this.autoplay=!1,this.oIndex=e,this.$refs.carouse.setActiveItem(e)},handleDelete:function(e){var t=this;this.API_POST("System/DelIndexBanner",{Id:e.ID}).then(function(e){t.init(),t.$message.success("删除成功！")})},UpImgVideo:function(){var e=this;if(""==this.UpTitle)return this.$message.warning("请输入标题！");if(0==this.imageUrlList.length)return this.$message.warning("请上传资源或等待资源加载完成！");if(1==this.imageUrlList.length&&-1!=this.imageUrlList[0].raw.type.indexOf("video"))return this.$message.warning("不可单独上传视频！");var t={For:this.To,Type:1==this.imageUrlList.length?1:2,Title:this.UpTitle};this.API_POST("System/AddIndexBanner",t).then(function(t){e.UpimgBase64(res.Data,0),2==e.imageUrlList.length&&e.UpimgBase64(res.Data,1)})},UpimgBase64:function(e,t){var i=this,a={Id:e,FileStr:this.imgVideoBase64List[t].base64,Type:-1!=this.imageUrlList[t].raw.type.indexOf("video")?2:1};this.API_POST("System/UploadIndexBanner",a).then(function(e){i.$refs.success.start(),i.init()})},compress:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){var t=new Image;t.src=e;var i,a=document.createElement("canvas"),n=a.getContext("2d"),r=.8*t.width,s=.8*t.height;return a.width=r,a.height=s,n.drawImage(t,0,0,r,s),(i=a.toDataURL("image/jpeg").replace("data:image/jpeg;base64,","")).toString().length>204800?compress(i):(console.log(i),i)}),beforeuploadMainGraph:function(e){if(1==this.imageUrlList.length&&-1!=this.imageUrlList[0].raw.type.indexOf(e.type.split("/")[0]))return this.$message.warning("类型重复！");var t=this,i=new FileReader;i.readAsDataURL(e),i.onload=function(a){var n=i.result;t.imgVideoBase64List.push({uid:e.uid,base64:n})}},handleSuccessMainGraph:function(e,t,i){this.imageUrlList=i},handlePreviewMainGraph:function(e){this.imageUrl.type=e.raw.type,this.imageUrl.url=e.url,console.log(e),this.dialogVisibleMainGraph=!0},handleRemoveMainGraph:function(e,t){for(var i=0;i<this.imgVideoBase64List.length;i++){this.imgVideoBase64List[i].uid===e.uid&&this.imgVideoBase64List.splice(i,1)}},handleClose:function(e){this.$confirm("确认关闭？").then(function(t){e()}).catch(function(e){})},handleClick:function(e,t){console.log(e.index,t),this.To=Number(e.index)+1,this.init()},init:function(){var e=this;this.API_GET("System/GetIndexBanners",{to:e.To}).then(function(t){for(var i=t.Dtos,a=0;a<i.length;a++){var n=i[a];n.CreateDate=n.CreateDate.split("T")[0],n.Pos=a+1}e.tableData=i,e.loading=!1,e.rowDrops()})},rowDrops:function(){var e=document.querySelector("#Swiper .el-table__body-wrapper tbody"),t=this;a.a.create(e,{onEnd:function(e){var i=e.newIndex,a=e.oldIndex;if(console.log(i,a),i==a)return!1;t.loading=!0;var n=t.tableData,r=n[a];n.splice(a,1),n.splice(i,0,r);for(var s=[],o=0;o<n.length;o++){var l=n[o];console.log(l.Title,l.ID),s[o]={Id:l.ID,Sort:o+1}}t.API_POST("System/SortIndexBanner",{Dtos:s}).then(function(e){t.tableData=[],t.init()})}})}},created:function(){this.init()},mounted:function(){},beforeCreate:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){},destroyed:function(){},activated:function(){}},r={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"box"},[i("el-tabs",{attrs:{type:"card"},on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[i("el-tab-pane",{attrs:{label:"客户端App",name:"first"}}),e._v(" "),i("el-tab-pane",{attrs:{label:"工程师端App",name:"second"}}),e._v(" "),i("el-tab-pane",{attrs:{label:"ERP 系统",name:"third"}})],1),e._v(" "),i("el-carousel",{ref:"carouse",staticStyle:{width:"1300px",margin:"auto"},attrs:{autoplay:e.autoplay,"initial-index":e.oIndex,interval:4e3,type:"card",height:"300px"}},e._l(e.tableData,function(e,t){return i("el-carousel-item",{key:t},[i("img",{staticStyle:{height:"100%","border-radius":"10px"},attrs:{src:"http://icms.inchwell.com.cn/file/IndexBanner/"+e.Image,alt:""}})])}),1),e._v(" "),i("div",{staticStyle:{width:"100%",height:"70px",margin:"50px 0",display:"flex","justify-content":"center"}},e._l(e.tableData,function(t,a){return i("img",{key:a,staticStyle:{height:"100%","border-radius":"10px",margin:"0px 10px"},attrs:{src:"http://icms.inchwell.com.cn/file/IndexBanner/"+t.Image,alt:""},on:{mouseover:function(t){return e.clickChange(a)},mouseleave:function(t){e.autoplay=!0}}})}),0),e._v(" "),i("div",{staticStyle:{width:"531px",margin:"auto"},attrs:{id:"Swiper"}},[i("el-table",{ref:"MC",attrs:{data:e.tableData,border:"","row-key":"id",size:"mini","header-cell-style":{background:"#e1e1e1"},align:"left"}},[e._l(e.col,function(t,a){return i("el-table-column",{key:"col_"+t.label,attrs:{prop:e.dropCol[a].prop,width:e.dropCol[a].width,"show-overflow-tooltip":e.dropCol[a].widths,label:t.label}})}),e._v(" "),i("el-table-column",{attrs:{align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(i){return e.handleDelete(t.row)}}},[e._v("删除")])]}}])},[i("template",{slot:"header"},[i("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(t){e.UpTitle="",e.$refs.success.start(),e.imageUrlList=[],e.imgVideoBase64List=[]}}},[e._v("添加")])],1)],2)],2)],1),e._v(" "),i("saxo-pop",{ref:"success",attrs:{type:"success",title:"添加首页轮播信息",width:"800px"},on:{close:function(t){return e.$refs.success.start()}}},[i("div",[i("el-input",{attrs:{placeholder:"请输入内容",size:"mini"},model:{value:e.UpTitle,callback:function(t){e.UpTitle=t},expression:"UpTitle"}},[i("template",{slot:"prepend"},[e._v("标题：")])],2)],1),e._v(" "),i("el-divider",{attrs:{"content-position":"left"}},[e._v("上传图片 / 视频")]),e._v(" "),i("el-upload",{attrs:{action:e.uploadFileUrlapp,data:{attachType:0},name:"appFile",limit:2,multiple:!0,accept:"image/*,video/*","before-upload":e.beforeuploadMainGraph,"on-success":e.handleSuccessMainGraph,"on-preview":e.handlePreviewMainGraph,"on-remove":e.handleRemoveMainGraph,"list-type":"picture-card","file-list":e.imageUrlList}},[i("i",{staticClass:"el-icon-plus spc1"})]),e._v(" "),i("el-dialog",{staticClass:"spc12",attrs:{visible:e.dialogVisibleMainGraph,"modal-append-to-body":!1},on:{"update:visible":function(t){e.dialogVisibleMainGraph=t}}},["video/mp4"!=e.imageUrl.type?i("img",{attrs:{width:"100%",src:e.imageUrl.url,alt:""}}):e._e(),e._v(" "),"video/mp4"==e.imageUrl.type?i("video",{staticClass:"avatar video-avatar",staticStyle:{width:"100%"},attrs:{src:e.imageUrl.url,controls:"controls"}},[e._v("\n                您的浏览器不支持视频播放\n            ")]):e._e()]),e._v(" "),i("div",{staticStyle:{width:"100%","text-align":"right"}},[i("saxo-button",{attrs:{type:"info",mini:""},on:{click:function(t){return e.$refs.success.start()}}},[e._v("取 消")]),e._v(" "),i("saxo-button",{attrs:{type:"primary",mini:""},on:{click:function(t){return e.UpImgVideo()}}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var s=i("VU/8")(n,r,!1,function(e){i("RooE")},"data-v-c34ab036",null);t.default=s.exports},RooE:function(e,t){}});