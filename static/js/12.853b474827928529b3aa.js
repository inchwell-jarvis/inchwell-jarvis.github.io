webpackJsonp([12],{s1ck:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("mvHQ"),r=n.n(i),a=n("BO1k"),o=n.n(a),u={data:function(){return{Id:"",EquDtos:[],returnEquipment:[],buyEquipment:[],textarea:"",drawer:!1,databasebool:!1,protype:"3",BuyingCurrency:""}},created:function(){var t=this;console.log(this.$route.query),this.Id=this.$route.query.Id,this.EquDtos=this.$route.query.EquDtos,this.BuyingCurrency=this.$route.query.BuyingCurrency,this.EquDtos.forEach(function(e){t.$set(e,"Quantity",e.POQuantity),t.$set(e,"Quantity2",e.POQuantity)}),3==this.$route.query.From&&(this.protype="6"),2==this.$route.query.From&&(this.protype="1")},mounted:function(){},computed:{totalReturnEquipmentValue:function(){return this.returnEquipment.reduce(function(t,e){return t+e.Quantity2*e.UnitPrice},0).toFixed(2)},totalBuyEquipmentValue:function(){return this.buyEquipment.reduce(function(t,e){return t+e.Quantity*e.BuyingUnitPrice},0).toFixed(2)}},watch:{},methods:{choose:function(t){1===t?this.drawer=!0:this.databasebool=!0,console.log(this.EquDtos)},database:function(t){var e=this;console.log(t);var n=function(t){var n=e.buyEquipment.findIndex(function(e){return e.ID===t.ID});-1!==n?e.buyEquipment[n].Quantity+=t.Quantity:e.BuyingCurrency==t.BuyingCurrency?(e.$set(t,"Discount",100),e.$set(t,"DiscountPrice",t.UnitPrice),e.buyEquipment.push(t)):e.$message.warning("只能添加与当前订单货币相同的设备！")},i=!0,r=!1,a=void 0;try{for(var u,s=o()(t);!(i=(u=s.next()).done);i=!0){n(u.value)}}catch(t){r=!0,a=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw a}}console.log(this.buyEquipment)},returnQuantity:function(t,e,n){if("Del"==e||"Add"==e){if(1==t.Quantity2&&"Del"==e)return this.$message.warning("最少退回一个！");if(t.Quantity2==t.Quantity&&"Add"==e)return this.$message.warning("最多退回购买量！");t.Quantity2="Del"==e?t.Quantity2-1:t.Quantity2+1}"saxo"==e&&(t.Quantity2=n)},UpdateMSOEquPrice:function(t,e,n){if("Del"==e||"Add"==e){if(1==t.Quantity&&"Del"==e)return this.$message.warning("最少购买一个！");t.Quantity="Del"==e?t.Quantity-1:t.Quantity+1}"saxo"==e&&(t.Quantity=Number(n))},UpdateMSOEquPrice2:function(t,e,n){if("Del"==e||"Add"==e){if(1==t.Quantity2&&"Del"==e)return this.$message.warning("最少退回一个！");if(t.Quantity2==t.Quantity&&"Add"==e)return this.$message.warning("最多退回购买量！");t.Quantity2="Del"==e?t.Quantity2-1:t.Quantity2+1}"saxo"==e&&(t.Quantity2=Number(n))},Check:function(t){var e=JSON.parse(r()(t)),n=this.returnEquipment.findIndex(function(t){return t.ID===e.ID});-1!==n?this.returnEquipment[n].Quantity2+=e.Quantity2:this.returnEquipment.push(e)},dele:function(t,e){1===e?this.returnEquipment=this.returnEquipment.filter(function(e){return e.ID!==t.ID}):this.buyEquipment=this.buyEquipment.filter(function(e){return e.ID!==t.ID})},confirm:function(){var t=this;if(!this.returnEquipment.length&&!this.buyEquipment.length)return this.$message.warning("退回设备与换新设备至少选其一！");var e=[],n=0;this.returnEquipment.forEach(function(t){e.push({NewOrOri:1,TotalAmount:t.Quantity2*t.UnitPrice,ProId:t.ProductId,DiscountPrice:t.UnitPrice,Quantity:Number(t.Quantity2),Desc:t.Describe2,ProCode:t.ProductCode}),n+=t.Quantity2*t.UnitPrice,console.log(t)});var i=0;this.buyEquipment.forEach(function(t){e.push({NewOrOri:2,TotalAmount:t.Quantity*t.BuyingUnitPrice,ProId:t.ID,DiscountPrice:t.BuyingUnitPrice,Quantity:Number(t.Quantity),Desc:t.Characteristics,ProCode:t.ProductCode}),i+=t.Quantity*t.BuyingUnitPrice,console.log(t)}),console.log(e),console.log(n-i);var r={Id:this.Id,chaAmount:Number((n-i).toFixed(2)),Memo:this.textarea,Dtos:e};console.log(r),this.API_POST("MachineSO/MpoEquChange",r).then(function(e){t.$message.success(e.split("：")[1]),t.$emit("refresh"),3==t.$route.query.From&&t.$router.push({path:"/machine-purchase-edit"}),2==t.$route.query.From&&t.$router.push({path:"/sp-procurement-edit"})})}},beforeCreate:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){},destroyed:function(){},activated:function(){}},s={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("SaxoPage",{scopedSlots:t._u([{key:"title",fn:function(){return[n("saxo-button",{attrs:{mini:"",type:"success"},on:{click:t.confirm}},[t._v("申请")])]},proxy:!0},{key:"content",fn:function(){return[n("div",{staticClass:"alert"},[n("i",{staticClass:"el-icon-warning"}),t._v(" "),n("h4",[t._v("温馨提示")]),t._v(" "),n("p",[t._v("1.只退货表示从采购单中删除设备(只能删除未发货未收货的设备)")]),t._v(" "),n("p",[t._v("2.只增购表示向采购单中添加新设备")]),t._v(" "),n("p",[t._v("3.既有退货又有增购表示换货")])]),t._v(" "),n("h3",[t._v("退回设备\n            "),n("saxo-button",{attrs:{type:"success",mini:"",plain:""},on:{click:function(e){return t.choose(1)}}},[n("i",{staticClass:"el-icon-plus"})])],1),t._v(" "),n("el-table",{staticStyle:{width:"100%"},attrs:{data:t.returnEquipment,stripe:"","header-cell-style":t.$store.state.headerCellStyle,size:"mini"}},[n("el-table-column",{attrs:{label:"序号",type:"index",width:"60"}}),t._v(" "),n("el-table-column",{attrs:{prop:"ProductCode",label:"对内编码",width:"150"}}),t._v(" "),n("el-table-column",{attrs:{prop:"LongCode",label:"对外编码",width:"150"}}),t._v(" "),n("el-table-column",{attrs:{prop:"Brand",label:"品牌",width:"120"}}),t._v(" "),n("el-table-column",{attrs:{prop:"Describe2",label:"描述","show-overflow-tooltip":!0}}),t._v(" "),n("el-table-column",{attrs:{label:"采购单价","header-align":"center",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("span",{staticStyle:{float:"right"}},[t._v(" "+t._s(t.FinancialAmountFormat(e.row.UnitPrice,t.FinancialAmountSymbol(e.row.BuyingCurrency))))])]}}])}),t._v(" "),n("el-table-column",{attrs:{fixed:"right",label:"数量",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("div",{attrs:{id:"Number_input"}},[n("div",{staticClass:"div_icon_text",on:{click:function(n){return t.UpdateMSOEquPrice2(e.row,"Del")}}},[n("i",{staticClass:"el-icon-minus"})]),t._v(" "),n("div",{staticClass:"div_icon_textConter"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.row.Quantity2,expression:"scope.row.Quantity2"}],staticStyle:{"text-align":"center","border-style":"none",outline:"none",width:"100%"},attrs:{type:"text",name:"",id:""},domProps:{value:e.row.Quantity2},on:{blur:function(n){return t.UpdateMSOEquPrice2(e.row,"saxo",e.row.Quantity2)},input:function(n){n.target.composing||t.$set(e.row,"Quantity2",n.target.value)}}})]),t._v(" "),n("div",{staticClass:"div_icon_text",on:{click:function(n){return t.UpdateMSOEquPrice2(e.row,"Add")}}},[n("i",{staticClass:"el-icon-plus"})])])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"操作",fixed:"right",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("saxo-button",{attrs:{mini:"",type:"danger"},on:{click:function(n){return t.dele(e.row,1)}}},[t._v("删除")])]}}])})],1),t._v(" "),n("h3",[t._v("换新设备\n            "),n("saxo-button",{attrs:{type:"success",mini:"",plain:""},on:{click:function(e){return t.choose()}}},[n("i",{staticClass:"el-icon-plus"})])],1),t._v(" "),n("el-table",{staticStyle:{width:"100%"},attrs:{data:t.buyEquipment,stripe:"","header-cell-style":t.$store.state.headerCellStyle,size:"mini"}},[n("el-table-column",{attrs:{label:"序号",type:"index",width:"60"}}),t._v(" "),n("el-table-column",{attrs:{prop:"ProductCode",label:"产品编号",width:"170"}}),t._v(" "),n("el-table-column",{attrs:{label:"内部编码",width:"140"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("p",{domProps:{innerHTML:t._s(e.row.BarcodeMemo)}})]}}])}),t._v(" "),n("el-table-column",{attrs:{prop:"Manufacturer",label:"品牌",width:"120"}}),t._v(" "),n("el-table-column",{attrs:{prop:"Characteristics",label:"描述","show-overflow-tooltip":!0}}),t._v(" "),n("el-table-column",{attrs:{label:"采购单价","header-align":"center",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(t.FinancialAmountSymbol(e.row.BuyingCurrency))+"\n                    "),n("el-input",{staticStyle:{width:"calc(100% - 30px)"},attrs:{placeholder:"请输入内容",size:"mini",type:"number",step:.01},model:{value:e.row.BuyingUnitPrice,callback:function(n){t.$set(e.row,"BuyingUnitPrice",n)},expression:"scope.row.BuyingUnitPrice"}})]}}])}),t._v(" "),n("el-table-column",{attrs:{fixed:"right",label:"数量",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("div",{attrs:{id:"Number_input"}},[n("div",{staticClass:"div_icon_text",on:{click:function(n){return t.UpdateMSOEquPrice(e.row,"Del")}}},[n("i",{staticClass:"el-icon-minus"})]),t._v(" "),n("div",{staticClass:"div_icon_textConter"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.row.Quantity,expression:"scope.row.Quantity"}],staticStyle:{"text-align":"center","border-style":"none",outline:"none",width:"100%"},attrs:{type:"text",name:"",id:""},domProps:{value:e.row.Quantity},on:{blur:function(n){return t.UpdateMSOEquPrice(e.row,"saxo",e.row.Quantity)},input:function(n){n.target.composing||t.$set(e.row,"Quantity",n.target.value)}}})]),t._v(" "),n("div",{staticClass:"div_icon_text",on:{click:function(n){return t.UpdateMSOEquPrice(e.row,"Add")}}},[n("i",{staticClass:"el-icon-plus"})])])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"操作",fixed:"right",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("saxo-button",{attrs:{mini:"",type:"danger"},on:{click:function(n){return t.dele(e.row,2)}}},[t._v("删除")])]}}])})],1),t._v(" "),n("div",{staticStyle:{width:"100%"}},[n("div",{staticStyle:{width:"50%",float:"left"}},[n("h3",[t._v("备注")]),t._v(" "),n("el-input",{staticStyle:{width:"500px"},attrs:{type:"textarea",rows:6,placeholder:"请输入内容"},model:{value:t.textarea,callback:function(e){t.textarea=e},expression:"textarea"}})],1),t._v(" "),n("div",{staticStyle:{width:"50%",float:"left"}},[n("h3",[t._v("差额")]),t._v(" "),n("p",{staticStyle:{"font-size":"16px"}},[n("span",{staticStyle:{"margin-right":"10px"}}),t._v("\n                    "+t._s(t.totalReturnEquipmentValue)+"\n                    "),n("span",{staticStyle:{"margin-right":"10px"}}),t._v("\n                    -\n                    "),n("span",{staticStyle:{"margin-right":"10px"}}),t._v("\n                    "+t._s(t.totalBuyEquipmentValue)+"\n                    "),n("span",{staticStyle:{"margin-right":"10px"}}),t._v("\n                    =\n                    "),n("span",{staticStyle:{"margin-right":"10px"}}),t._v("\n                    "+t._s((t.totalReturnEquipmentValue-t.totalBuyEquipmentValue).toFixed(2))+"\n                ")])])]),t._v(" "),n("SaxoDrawer",{attrs:{show:t.drawer,title:"退回设备"},on:{ShowFalse:function(e){t.drawer=!1}}},[n("el-table",{staticStyle:{width:"100%"},attrs:{data:t.EquDtos,size:"mini",stripe:"",height:"100%"}},[n("el-table-column",{attrs:{label:"序号",type:"index",width:"60"}}),t._v(" "),n("el-table-column",{attrs:{prop:"ProductCode",label:"对内编码",width:"150"}}),t._v(" "),n("el-table-column",{attrs:{prop:"LongCode",label:"对外编码",width:"150"}}),t._v(" "),n("el-table-column",{attrs:{prop:"Describe2",label:"描述","show-overflow-tooltip":!0}}),t._v(" "),n("el-table-column",{attrs:{label:"数量",width:"70",prop:"Quantity"}}),t._v(" "),n("el-table-column",{attrs:{fixed:"right",label:"退回数量",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("div",{attrs:{id:"Number_input"}},[n("div",{staticClass:"div_icon_text",on:{click:function(n){return t.returnQuantity(e.row,"Del")}}},[n("i",{staticClass:"el-icon-minus"})]),t._v(" "),n("div",{staticClass:"div_icon_textConter"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.row.Quantity2,expression:"scope.row.Quantity2"}],staticStyle:{"text-align":"center","border-style":"none",outline:"none",width:"100%"},attrs:{type:"text"},domProps:{value:e.row.Quantity2},on:{blur:function(n){return t.returnQuantity(e.row,"saxo",e.row.Quantity2)},input:function(n){n.target.composing||t.$set(e.row,"Quantity2",n.target.value)}}})]),t._v(" "),n("div",{staticClass:"div_icon_text",on:{click:function(n){return t.returnQuantity(e.row,"Add")}}},[n("i",{staticClass:"el-icon-plus"})])])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"已发量",width:"70",prop:"NoSentQuantity"}}),t._v(" "),n("el-table-column",{attrs:{label:"操作",width:"100px",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("saxo-button",{attrs:{mini:"",type:"primary"},on:{click:function(n){return t.Check(e.row)}}},[t._v("添加")])]}}])})],1)],1),t._v(" "),n("DeviceDatabase",{attrs:{show:t.databasebool,protype:t.protype},on:{ShowFalse:function(e){t.databasebool=!1},DataBase:t.database}})]},proxy:!0}])})},staticRenderFns:[]};var l=n("VU/8")(u,s,!1,function(t){n("yuoW")},"data-v-2c57b742",null);e.default=l.exports},yuoW:function(t,e){}});