webpackJsonp([68],{RnZy:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("Xxa5"),o=a.n(n),l=a("gRE1"),r=a.n(l),i=a("//Fk"),s=a.n(i),u=a("exGp"),c=a.n(u),p=a("mvHQ"),d=a.n(p),m={data:function(){return{SubordinateCompany:[{value:"服务公司",label:"服务公司"},{value:"技术公司",label:"技术公司"}],pickerOptions:{disabledDate:function(t){return t.getFullYear()>(new Date).getFullYear()}},retrieval:{year:(new Date).getFullYear().toString(),month:"",belongCompany:""},months:0,monthst:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],data:[],finalOutput:[],merageArr:[],meragePos:0,popdata:{},defaultProps:{children:"FTJieByMonthDetailDtos",label:"label"},dialogVisible:!1,dialogVisible2:!1}},created:function(){var t=this.$route.query.CName;console.log(t),this.retrieval.belongCompany=t},mounted:function(){},computed:{retrievalJT:function(){return d()(this.retrieval)}},watch:{retrievalJT:function(t,e){console.log(t),this.start()}},methods:{start:function(){var t=this;return c()(o.a.mark(function e(){var a,n,l,i;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.months=t.calculateMonthsPassed(t.retrieval.year),t.retrieval.belongCompany){e.next=3;break}return e.abrupt("return",t.$message.warning("请选择隶属公司！"));case 3:return e.next=5,s.a.all(t.months.map(function(e){return t.GetFTJieByMonth(e)}));case 5:for(e.sent.forEach(function(e){var a=e.FTJieByMonthDtos[0].Month.split("-")[1]-1;t.data[a]=e.FTJieByMonthDtos}),console.log(t.data),a={},t.data.forEach(function(t,e){t.forEach(function(t){var n=t.Project,o=t.Month,l=t.Amount,r=t.FTJieByMonthDetailDtos,i=t.Category;a[n]||(a[n]={}),a[n].Project=n,a[n].Category=i,a[n]["Month"+e]=o,a[n]["Amount"+e]=l,void 0===a[n].TotalAmount&&(a[n].TotalAmount=0),a[n].TotalAmount+=l,console.log(e),a[n]["FTJieByMonthDetailDtos"+e]=r})}),t.finalOutput=r()(a),console.log(t.finalOutput),n={Category:"合计"},l=function(e){n["Amount"+e]=t.finalOutput.reduce(function(t,a){return t+(Number(a["Amount"+e])||0)},0),n.TotalAmount=t.finalOutput.reduce(function(t,e){return t+(Number(e.TotalAmount)||0)},0)},i=0;i<t.months.length;i++)l(i);t.finalOutput.push(n),t.merage(t.finalOutput);case 17:case"end":return e.stop()}},e,t)}))()},GetFTJieByMonth:function(t){var e=this;return c()(o.a.mark(function a(){return o.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",e.API_GET("Finance/GetFTJieByMonth",t));case 1:case"end":return a.stop()}},a,e)}))()},calculateMonthsPassed:function(t){t=Number(t);var e=new Date,a=e.getFullYear(),n=e.getMonth()+1,o=void 0;o=t===a?n:t<a?12:null;for(var l=[],r=0;r<o;r++)l.push({month:t+"-"+(r+1),belongCompany:this.retrieval.belongCompany});return l},objectSpanMethod:function(t){t.row,t.column;var e=t.rowIndex;if(0===t.columnIndex){var a=this.merageArr[e];return{rowspan:a,colspan:a>0?1:0}}return{rowspan:1,colspan:1}},merage:function(t){this.merageInit();for(var e=0;e<t.length;e++)0===e?(this.merageArr.push(1),this.meragePos=0):t[e].Category===t[e-1].Category?(this.merageArr[this.meragePos]+=1,this.merageArr.push(0)):(this.merageArr.push(1),this.meragePos=e)},merageInit:function(){this.merageArr=[],this.meragePos=0},changheader:function(t,e){var a=this.monthst.indexOf(t.label);if(-1!=a){var n,o=this.data[a];n=o.map(function(t){return Number(t.Amount)}).reduce(function(t,e){return t+e},0);var l=(a+1).toString().padStart(2,"0"),r=this.retrieval.year+"-"+l;this.popdata={subscriptList:o,Time:r,label:"111",Amount:n},console.log(this.popdata),this.dialogVisible2=!0}},changCell:function(t,e,a,n){var o=this.monthst.indexOf(e.label);if(-1!=o){var l=this.data[o].find(function(e){return e.Project===t.Project}),r=(o+1).toString().padStart(2,"0");l.Time=this.retrieval.year+"-"+r,this.popdata=l,this.dialogVisible=!this.dialogVisible,console.log(l)}}},beforeCreate:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){},destroyed:function(){},activated:function(){}},h={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("SaxoPage",{scopedSlots:t._u([{key:"title",fn:function(){return[a("div",{staticClass:"department"},[a("span",[t._v("年份")]),t._v(" "),a("el-date-picker",{attrs:{type:"year",placeholder:"选择年份",size:"mini","value-format":"yyyy","picker-options":t.pickerOptions},model:{value:t.retrieval.year,callback:function(e){t.$set(t.retrieval,"year",e)},expression:"retrieval.year"}})],1),t._v(" "),a("div",{staticClass:"department"},[a("span",[t._v("隶属公司")]),t._v(" "),a("el-select",{attrs:{placeholder:"请选择隶属公司",size:"mini"},model:{value:t.retrieval.belongCompany,callback:function(e){t.$set(t.retrieval,"belongCompany",e)},expression:"retrieval.belongCompany"}},t._l(t.SubordinateCompany,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1),t._v(" "),a("saxo-button",{attrs:{mini:""},on:{click:function(e){return t.start()}}},[t._v("搜索")])]},proxy:!0},{key:"content",fn:function(){return[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.finalOutput,"header-cell-style":t.$store.state.headerCellStyle,"cell-style":t.$store.state.cellStyle,stripe:"",height:"100%","span-method":t.objectSpanMethod},on:{"header-click":t.changheader,"cell-click":t.changCell}},[a("el-table-column",{attrs:{label:"类别",prop:"Category","header-align":"center",width:"100",fixed:"left"}}),t._v(" "),a("el-table-column",{attrs:{label:"项目名称",prop:"Project","header-align":"center",width:"200",fixed:"left"}}),t._v(" "),t._l(t.months,function(e,n){return a("el-table-column",{key:n,attrs:{label:t.monthst[n],width:"120","header-align":"center",prop:"Amount"+n},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row["Amount"+n]?a("span",{staticStyle:{float:"right"}},[t._v(t._s(t.FinancialAmountFormat(e.row["Amount"+n],"")))]):t._e(),t._v(" "),e.row["Amount"+n]?t._e():a("span",{staticStyle:{float:"right"}},[t._v(" - ")])]}}],null,!0)})}),t._v(" "),a("el-table-column",{attrs:{label:"汇总",width:"120","header-align":"center",prop:"TotalAmount"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticStyle:{float:"right"}},[t._v(t._s(t.FinancialAmountFormat(e.row.TotalAmount,"")))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:""},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row?t._e():a("span")]}}])})],2),t._v(" "),a("el-dialog",{attrs:{title:"提示",visible:t.dialogVisible,width:"800px","modal-append-to-body":!1},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("h2",{staticStyle:{"margin-bottom":"20px","line-height":"50px"}},[a("span",{staticStyle:{width:"100px",display:"block",float:"left"}},[t._v(t._s(t.popdata.Time))]),t._v("\n                "+t._s(t.popdata.Project)+"\n                "),a("span",{staticStyle:{float:"right",color:"red"}},[t._v(t._s(t.FinancialAmountFormat(t.popdata.Amount))+" ")])]),t._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.popdata.FTJieByMonthDetailDtos,size:"mini"}},[a("el-table-column",{attrs:{prop:"Category",label:"类别",width:"100"}}),t._v(" "),a("el-table-column",{attrs:{prop:"Project",label:"项目名称",width:"150"}}),t._v(" "),a("el-table-column",{attrs:{prop:"Summary",label:"摘要","show-overflow-tooltip":!0}}),t._v(" "),a("el-table-column",{attrs:{prop:"ToName",label:"收(付)方名称","show-overflow-tooltip":!0}}),t._v(" "),a("el-table-column",{attrs:{label:"金额",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticStyle:{float:"right"}},[t._v(t._s(t.FinancialAmountFormat(e.row.Amount)))])]}}])})],1)],1),t._v(" "),a("el-dialog",{attrs:{title:"提示",visible:t.dialogVisible2,width:"800px","modal-append-to-body":!1},on:{"update:visible":function(e){t.dialogVisible2=e}}},[a("h2",{staticStyle:{"margin-bottom":"20px","line-height":"50px"}},[t._v("\n                "+t._s(t.popdata.Time)+"\n                "),a("span",{staticStyle:{float:"right",color:"red"}},[t._v(t._s(t.FinancialAmountFormat(t.popdata.Amount))+" ")])]),t._v(" "),a("el-collapse",{attrs:{accordion:""}},t._l(t.popdata.subscriptList,function(e,n){return a("el-collapse-item",{key:n,attrs:{size:"mini"}},[a("template",{slot:"title"},[a("span",{staticStyle:{width:"100px"}},[t._v(" "+t._s(e.Category))]),t._v(" "),a("span",{staticStyle:{width:"200px"}},[t._v(" "+t._s(e.Project))]),t._v(" "),a("span",{staticStyle:{width:"100px"}},[t._v(" "+t._s(t.FinancialAmountFormat(e.Amount)))])]),t._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.FTJieByMonthDetailDtos,size:"mini"}},[a("el-table-column",{attrs:{prop:"Category",label:"类别",width:"100"}}),t._v(" "),a("el-table-column",{attrs:{prop:"Project",label:"项目名称",width:"150"}}),t._v(" "),a("el-table-column",{attrs:{prop:"Summary",label:"摘要","show-overflow-tooltip":!0}}),t._v(" "),a("el-table-column",{attrs:{prop:"ToName",label:"收(付)方名称","show-overflow-tooltip":!0}}),t._v(" "),a("el-table-column",{attrs:{label:"金额",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticStyle:{float:"right"}},[t._v(t._s(t.FinancialAmountFormat(e.row.Amount)))])]}}],null,!0)})],1)],2)}),1)],1)]},proxy:!0}])})},staticRenderFns:[]};var f=a("VU/8")(m,h,!1,function(t){a("isB6")},"data-v-7ffd88ed",null);e.default=f.exports},isB6:function(t,e){}});