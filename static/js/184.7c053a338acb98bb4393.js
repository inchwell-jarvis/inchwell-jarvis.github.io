webpackJsonp([184],{i0AI:function(t,e){},wbHJ:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={name:"",data:function(){return{optionss:[],value:[],kehuCusiD:"",loading:!1,UploadEquInstallOrderFile:[],stateType:1,optionsType:[{Name:"整机安装",ID:0,value:1},{Name:"零配件安装",ID:0,value:2},{Name:"设备拆装服务",ID:0,value:3}],tableData:[],Dials:!0}},created:function(){},components:{},watch:{$route:function(t,e){"/AddOrderindex"==t.path&&(this.Dials=!0)}},methods:{deleteDD:function(t){console.log(t);for(var e=0;e<this.tableData.length;e++){this.tableData[e].ID==t.ID&&this.tableData.splice(e,1)}},Suat:function(){var t=this.$store.state.Vuex.AddindexequipmentList;if(this.$store.state.Vuex.AddindexequipmentList=[],console.log(t),0==this.tableData.length)return this.tableData=t,!1;for(var e=0;e<this.tableData.length;e++){if(this.tableData[e].ID==t[0].ID)return!1}this.tableData.push(t[0])},addtProuder:function(){this.$router.push({path:"/Addindexequipment"}),this.Dials=!1},addtrue:function(){var t=this;if(console.log(this.kehuCusiD),console.log(this.stateType),console.log(this.UploadEquInstallOrderFile),console.log(this.tableData),""==this.kehuCusiD)return this.$message.warning("请选择客户！"),!1;for(var e=[],a=0;a<this.tableData.length;a++){var i=this.tableData[a];e.push({ProductId:i.ID,Number:i.index})}var s={api:"post",url:this.$store.state.http+"WO/CreateEquInstallOrder",data:{CusId:this.kehuCusiD,Type:this.stateType,EquList:e}};this.$https(s).then(function(e){if(0==t.UploadEquInstallOrderFile.length)return t.$message.success("创建成功未上传附件！"),t.UploadEquInstallOrderFile=[],t.kehuCusiD="",t.$emit("refresh"),t.$router.push({path:"/Installationtask"}),!1;t.$message.success("创建成功正在上传附件！"),t.UploadEquInstallOrderFilefunction(e.Data),t.$emit("refresh"),t.$router.push({path:"/Installationtask"})})},UploadEquInstallOrderFilefunction:function(t){for(var e=this,a=this.UploadEquInstallOrderFile.length,i=0;i<this.UploadEquInstallOrderFile.length;i++){var s={api:"post",url:this.$store.state.http+"WO/UploadEquInstallOrderFile",data:{Id:t,Str:this.UploadEquInstallOrderFile[i].base64,Type:this.UploadEquInstallOrderFile[i].type}};this.$https(s).then(function(t){0==(a-=1)&&(e.$message.success("创建完成！"),e.UploadEquInstallOrderFile=[],e.kehuCusiD="",e.value="")})}},remoteMethod:function(t){var e=this;console.log(t),""==t&&(t="北京"),this.loading=!0;var a={api:"get",url:this.$store.state.http+"CRM/GetCustomerMini",data:{search:t}};this.$https(a).then(function(t){console.log(t),e.optionss=t.Data.Dtos,e.loading=!1})},CusiD:function(t){console.log(t),this.kehuCusiD=t},getFile:function(t){var e=t.target.files[0];console.log(e);var a=this;if(e){var i=new FileReader;i.readAsDataURL(e),i.onload=function(t){var i=this.result;a.UploadEquInstallOrderFile.push({name:e.name,base64:i,type:"."+e.type.split("/")[1]})}}console.log(a.UploadEquInstallOrderFile)}}},s={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"box_s"},[a("router-view",{on:{refresh:t.Suat}}),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.Dials,expression:"Dials"}],staticClass:"dial",staticStyle:{width:"100%",height:"350px"}},[a("div",{staticClass:"segmentation"},[t._v("选择客户")]),t._v(" "),a("div",{staticClass:"demo"},[a("div",[t._v("选择客户:")]),t._v(" "),a("el-select",{staticStyle:{width:"300px"},attrs:{filterable:"",remote:"","reserve-keyword":"",placeholder:"请输入关键词","remote-method":t.remoteMethod,loading:t.loading,size:"mini"},on:{change:t.CusiD},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}},t._l(t.optionss,function(t){return a("el-option",{key:t.CusId,attrs:{label:t.FullName,value:t.CusId}})}),1)],1),t._v(" "),a("div",{staticClass:"segmentation"},[t._v("选择类型")]),t._v(" "),a("div",{staticClass:"demo"},[a("div",[t._v("选择类型:")]),t._v(" "),a("el-select",{staticStyle:{width:"200px"},attrs:{placeholder:"请选择任务类型",clearable:"",size:"mini"},model:{value:t.stateType,callback:function(e){t.stateType=e},expression:"stateType"}},t._l(t.optionsType,function(t){return a("el-option",{key:t.value,attrs:{label:t.Name,value:t.value}})}),1)],1),t._v(" "),a("div",{staticClass:"segmentation"},[t._v("选择设备\n      "),a("el-button",{staticStyle:{float:"right"},attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.addtProuder()}}},[t._v("添加设备")])],1),t._v(" "),a("div",{staticStyle:{width:"95%",margin:"auto"}},[a("el-table",{staticStyle:{width:"100%",marginTop:"10px",float:"left"},attrs:{data:t.tableData,size:"mini",height:this.$store.state.TableOptimumHeight,"highlight-current-row":"",border:"","header-cell-style":{background:"#e1e1e1"}}},[a("el-table-column",{attrs:{fixed:"",prop:"Manufacturer",label:"品牌",width:"120"}}),t._v(" "),a("el-table-column",{attrs:{fixed:"",prop:"Characteristics",label:"描述","show-overflow-tooltip":!0}}),t._v(" "),a("el-table-column",{attrs:{fixed:"",prop:"Unit",label:"单位",width:"80"}}),t._v(" "),a("el-table-column",{attrs:{fixed:"",label:"数量",width:"151"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input-number",{attrs:{size:"mini",min:1,label:"描述文字"},model:{value:e.row.index,callback:function(a){t.$set(e.row,"index",a)},expression:"scope.row.index"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{fixed:"",label:"操作",width:"151"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){return t.deleteDD(e.row)}}},[t._v("删除")])]}}])})],1)],1),t._v(" "),a("div",{staticClass:"segmentation"},[t._v("上传附件")]),t._v(" "),a("div",{staticClass:"dome2"},[a("div",{staticClass:"leftdiv"},[t._v("上传文件：")]),t._v(" "),a("div",{staticClass:"rightdiv"},[a("el-button",{attrs:{type:"text",size:"mini"}},[a("label",{attrs:{for:"int"}},[t._v("↑ 上传")]),t._v(" "),a("input",{ref:"clearFile",staticStyle:{"margin-left":"70px",display:"none"},attrs:{id:"int",type:"file",accept:".pdf"},on:{change:function(e){return t.getFile(e)}}})]),t._v(" "),t._l(t.UploadEquInstallOrderFile,function(e,i){return a("div",{key:i,staticClass:"work"},[t._v(t._s(i+" - "+e.name))])})],2)]),t._v(" "),a("el-button",{staticStyle:{float:"right",marginRight:"30px"},attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.addtrue()}}},[t._v("创建")])],1)],1)},staticRenderFns:[]};var l=a("VU/8")(i,s,!1,function(t){a("i0AI")},"data-v-101154c0",null);e.default=l.exports}});