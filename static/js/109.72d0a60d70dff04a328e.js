webpackJsonp([109],{"m/Im":function(t,e){},rGiK:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=a("mvHQ"),n=a.n(o),l=a("bOdI"),s=a.n(l),i={data:function(){var t;return{Data:{},RepairBase:{},RepairMan:{},InvoiceDtos:[],WorkOrderPayDtos:[],CapitalPoolDtos:[],SaxoDrawer:!1,Subscription:0,Type:"",headerCellStyle:(t={background:"#f7f8fd",fontSize:"12px",fontWeight:400,fontStyle:"normal"},s()(t,"fontSize","11px"),s()(t,"padding","5px"),s()(t,"paddingLeft","0px"),t),cellStyle:{height:"48px",fontSize:"12px"}}},computed:{newCapitalPoolDtos:function(){return JSON.parse(n()(this.CapitalPoolDtos))}},watch:{newCapitalPoolDtos:function(t){var e=this;this.Subscription=0,t.forEach(function(t){t.Number>0&&(e.Subscription+=Number(t.Number))})}},methods:{DeleteInvoices:function(t){var e=this;this.API_POST("Finance/DelInvoice",{ID:t.ID}).then(function(t){e.$message.success("删除成功！"),e.start()})},OperationInvoice:function(t){var e=this;this.$prompt("请输入内容","操作发票",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(a){var o=a.value;e.API_POST("Finance/ApplyHandleInvoice",{ID:t.ID,Str:o}).then(function(t){e.$message.success("操作成功"),e.start()})}).catch(function(){e.$message("取消操作发票")})},start:function(){var t=this,e={url:this.$store.state.http+"WO/"+this.APIurl,api:"get",data:{woId:this.$route.query.Id}};this.$https(e).then(function(e){console.log(e.Data),t.Data=e.Data,t.RepairBase=e.Data.RepairBase,t.RepairMan=e.Data.RepairMan,t.InvoiceDtos=e.Data.InvoiceDtos,t.WorkOrderPayDtos=e.Data.WorkOrderPayDtos,t.WorkOrderPayDtos.forEach(function(t){""!=t.SystemInfo&&null!=t.SystemInfo?t.SystemInfo2=t.SystemInfo.split("@"):t.SystemInfo2=[],t.CreateDate=t.CreateDate.split("T")[0]})})},CreateMSO:function(){this.$router.push({path:"/GDbilling",query:{Type:"WorkOrder",API:"WO/AddWOInvoice",Id:this.$route.query.Id,CusId:this.RepairBase.CusId}})},GetCusCapitalPool:function(){var t=this;this.CapitalPoolDtos=[],this.SaxoDrawer=!0;var e={api:"get",url:this.$store.state.http+"CRM/GetCusCapitalPool",data:{cusId:this.RepairBase.CusId,onlyPart:!0,includebboc:!0,includebuming:!0}};this.$https(e).then(function(e){var a=e.Data,o=a.BBOCDtos,n=a.CapitalPoolDtos;null!=o&&e.Data.BBOCDtos.forEach(function(e){e.LB="挂帐款",e.CreateDate=e.CreateDate.split("T")[0],""!=e.SystemInfo&&null!=e.SystemInfo?e.SystemInfo2=e.SystemInfo.split("@"):element.SystemInfo2=[],t.CapitalPoolDtos.push(e)}),null!=n&&n.forEach(function(e){e.LB=e.Type,e.CreateDate=e.CreateDate.split("T")[0],""!=e.SystemInfo&&null!=e.SystemInfo?e.SystemInfo2=e.SystemInfo.split("@"):element.SystemInfo2=[],t.CapitalPoolDtos.push(e)}),console.log(t.CapitalPoolDtos)})},AddMSOPaymentFun:function(){var t=this;console.log(this.CapitalPoolDtos);for(var e=[],a=0;a<this.CapitalPoolDtos.length;a++){var o=this.CapitalPoolDtos[a];isNaN(parseFloat(o.Number))||e.push({SourceId:o.ID,UsageAmount:Number(o.Number),From:"资金池"==o.LB||"不明款"==o.LB?1:2})}if(0==e.length)return this.$message.error("请输入使用量！"),!1;if(""==this.Type)return this.$message.error("请选择类型！"),!1;var n={api:"post",url:this.$store.state.http+"WO/AddWOPayment",data:{Id:this.$route.query.Id,PayAmount:this.Subscription,UsageFeeDtos:e,Type:this.Type}};this.$https(n).then(function(e){t.SaxoDrawer=!1,t.$message({showClose:!0,message:"认款成功!",type:"success"}),t.start()})}},created:function(){this.APIurl=this.$route.query.Type,this.start()},mounted:function(){},beforeCreate:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){this.$emit("refresh")},destroyed:function(){},activated:function(){}},r={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("SaxoPage",{scopedSlots:t._u([{key:"content",fn:function(){return[a("router-view",{on:{refresh:t.start}}),t._v(" "),a("h3",[t._v("基础信息")]),t._v(" "),t.RepairBase.CusName?t._e():a("el-skeleton"),t._v(" "),t.RepairBase.CusName?a("el-descriptions",{attrs:{column:3,size:"mini",border:""}},[a("el-descriptions-item",[a("template",{slot:"label"},[t._v("\n                    客户信息\n                ")]),t._v("\n                "+t._s("  "+t.RepairBase.CusName)+"\n            ")],2),t._v(" "),a("el-descriptions-item",[a("template",{slot:"label"},[t._v("\n                    报修单号\n                ")]),t._v("\n                "+t._s("  "+t.RepairBase.RepairCode)+"\n            ")],2),t._v(" "),a("el-descriptions-item",[a("template",{slot:"label"},[a("i",{staticClass:"el-icon-mobile-phone"}),t._v("\n                    报修人\n                ")]),t._v("\n                "+t._s("  "+t.RepairMan.RepairName)+"\n\n            ")],2),t._v(" "),a("el-descriptions-item",[a("template",{slot:"label"},[a("i",{staticClass:"el-icon-location-outline"}),t._v("\n                    英文名\n                ")]),t._v("\n                "+t._s("  "+t.RepairMan.RepairNameEn)+"\n\n            ")],2),t._v(" "),a("el-descriptions-item",[a("template",{slot:"label"},[a("i",{staticClass:"el-icon-tickets"}),t._v("\n                    手机号码\n                ")]),t._v("\n                "+t._s("  "+t.RepairMan.MobilePhone)+"\n            ")],2),t._v(" "),a("el-descriptions-item",[a("template",{slot:"label"},[a("i",{staticClass:"el-icon-office-building"}),t._v("\n                    固定号码\n                ")]),t._v("\n                "+t._s("  "+t.RepairMan.Tel)+"\n            ")],2),t._v(" "),a("el-descriptions-item",[a("template",{slot:"label"},[a("i",{staticClass:"el-icon-office-building"}),t._v("\n                    邮箱\n                ")]),t._v("\n                "+t._s("  "+t.RepairMan.Email)+"\n            ")],2),t._v(" "),a("el-descriptions-item",[a("template",{slot:"label"},[a("i",{staticClass:"el-icon-office-building"}),t._v("\n                    公司地址\n                ")]),t._v("\n                "+t._s("  "+t.RepairMan.AddressDetail)+"\n            ")],2),t._v(" "),a("el-descriptions-item",[a("template",{slot:"label"},[a("i",{staticClass:"el-icon-office-building"}),t._v("\n                    客户备注\n                ")]),t._v("\n                "+t._s("  "+t.RepairBase.Remark)+"\n            ")],2)],1):t._e(),t._v(" "),a("h3",[t._v("认款\n            "),a("saxo-button",{staticStyle:{float:"right"},attrs:{mini:"",type:"success"},on:{click:function(e){return t.GetCusCapitalPool()}}},[t._v("认款")])],1),t._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.WorkOrderPayDtos,"header-cell-style":t.headerCellStyle,"cell-style":t.cellStyle,stripe:""}},[a("el-table-column",{attrs:{prop:"CreateDate",label:"创建时间","show-overflow-tooltip":!0}}),t._v(" "),a("el-table-column",{attrs:{prop:"Amount",label:"付款金额","show-overflow-tooltip":!0}}),t._v(" "),a("el-table-column",{attrs:{prop:"Other",label:"类型"}}),t._v(" "),a("el-table-column",{attrs:{label:"系统信息","show-overflow-tooltip":!0},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-popover",{attrs:{placement:"top-start",title:"系统信息",trigger:"hover"},scopedSlots:t._u([{key:"default",fn:function(o){return t._l(e.row.SystemInfo2,function(e,o){return a("p",[t._v(t._s(e))])})}}],null,!0)},[t._v(" "),a("span",{attrs:{slot:"reference"},slot:"reference"},[t._v("系统信息"),a("i",{staticClass:"el-icon-warning-outline"})])])]}}])})],1),t._v(" "),a("SaxoDrawer",{attrs:{show:t.SaxoDrawer,title:t.RepairBase.CusName+"(挂账款 & 不明款 & 资金池)"},on:{ShowFalse:function(e){t.SaxoDrawer=!1}}},[a("div",{staticClass:"DeawerBox"},[a("div",{staticClass:"table"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.CapitalPoolDtos,height:"100%"}},[a("el-table-column",{attrs:{label:"类别",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return["挂帐款"==e.row.LB?a("span",[t._v(" "+t._s(e.row.LB+"("+e.row.InvoiceStateStr+")"))]):t._e(),t._v(" "),"挂帐款"!=e.row.LB?a("span",[t._v(" "+t._s(e.row.LB))]):t._e()]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"资金量",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticStyle:{float:"right"}},[t._v(" "+t._s(t.FinancialAmountFormat(e.row.Amount,t.FinancialAmountSymbol(e.row.BuyingCurrency))))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"使用量",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticStyle:{float:"right"}},[t._v(" "+t._s(t.FinancialAmountFormat(e.row.UsageAmount,t.FinancialAmountSymbol(e.row.BuyingCurrency))))])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"Creater",label:"创建人",width:"120"}}),t._v(" "),a("el-table-column",{attrs:{prop:"CreateDate",label:"创建时间",width:"120"}}),t._v(" "),a("el-table-column",{attrs:{prop:"StateStr",label:"状态",width:"120"}}),t._v(" "),a("el-table-column",{attrs:{label:"系统信息","show-overflow-tooltip":!0},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-popover",{attrs:{placement:"top-start",title:"系统信息",trigger:"hover"},scopedSlots:t._u([{key:"default",fn:function(o){return t._l(e.row.SystemInfo2,function(e,o){return a("p",[t._v(t._s(e))])})}}],null,!0)},[t._v(" "),a("span",{attrs:{slot:"reference"},slot:"reference"},[t._v("系统信息"),a("i",{staticClass:"el-icon-warning-outline"})])])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"Memo",label:"备注","show-overflow-tooltip":!0}}),t._v(" "),a("el-table-column",{attrs:{label:"使用量",fixed:"right",width:"150px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{size:"mini",type:"number",placeholder:"请输入使用量"},model:{value:e.row.Number,callback:function(a){t.$set(e.row,"Number",a)},expression:"scope.row.Number"}})]}}])})],1)],1),t._v(" "),a("div",{staticClass:"but"},[a("div",[t._v("认款合计：￥"),a("span",[t._v(" "+t._s(t.Subscription))])]),t._v(" "),a("saxo-button",{staticClass:"butState",attrs:{mini:"",type:"primary"},on:{click:t.AddMSOPaymentFun}},[t._v("确认")]),t._v(" "),a("div",{staticStyle:{float:"right",padding:"0",margin:"2px 50px"}},[a("el-radio-group",{staticStyle:{padding:"0px",height:"30px"},attrs:{size:"mini"},model:{value:t.Type,callback:function(e){t.Type=e},expression:"Type"}},[a("el-radio-button",{attrs:{label:"SC"}}),t._v(" "),a("el-radio-button",{attrs:{label:"RV"}}),t._v(" "),a("el-radio-button",{attrs:{label:"SP"}})],1)],1)],1)])]),t._v(" "),a("h3",[t._v("发票\n            "),a("saxo-button",{staticStyle:{float:"right"},attrs:{mini:"",type:"success"},on:{click:function(e){return t.CreateMSO()}}},[t._v("申请开票")])],1),t._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.InvoiceDtos,"header-cell-style":t.headerCellStyle,"cell-style":t.cellStyle,stripe:""}},[a("el-table-column",{attrs:{label:"创建时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.CreateDate.split("T")[0]))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"付款金额",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticStyle:{float:"right"}},[t._v(" "+t._s("￥"+e.row.Amount.toFixed(2)))])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"Creater",label:"申请人"}}),t._v(" "),a("el-table-column",{attrs:{prop:"Confirmer",label:"财务确认人"}}),t._v(" "),a("el-table-column",{attrs:{prop:"InvoiceStateStr",label:"发票状态"}}),t._v(" "),a("el-table-column",{attrs:{prop:"Type",label:"类型"}}),t._v(" "),a("el-table-column",{attrs:{label:"操作",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.InvoiceState?a("saxo-button",{attrs:{mini:"",type:"danger"},on:{click:function(a){return t.DeleteInvoices(e.row)}}},[t._v("删除发票")]):t._e(),t._v(" "),2==e.row.InvoiceState?a("saxo-button",{attrs:{mini:"",type:"success"},on:{click:function(a){return t.OperationInvoice(e.row)}}},[t._v("申请操作")]):t._e()]}}])})],1)]},proxy:!0}])})},staticRenderFns:[]};var c=a("VU/8")(i,r,!1,function(t){a("m/Im")},"data-v-5b2962fc",null);e.default=c.exports}});