webpackJsonp([165],{"+KbQ":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={data:function(){return{Want:{FullName:"",CustomerId:"",RepairName:"",RepairNameEn:"",MobilePhone:"",Tel:"",Email:"",AddressDetail:"",FaultDescription:"",CustomerRemark:"",RequestType:"1",DeviceId:""},dialogTableVisible:!1,search:"",searchHeader:"",gridData:[],pageNum:1,total:0,X:{},dialogVisibleMainGraph:!1,imageUrlList:[],imageUrl:{type:"",url:""},uploadFileUrlapp:"https://httpbin.org/post",imgVideoBase64List:[],UpFileDataLength:0,UpImgVideoId:"",loading:!1,res:{}}},created:function(){},methods:{beforeuploadMainGraph:function(t){var e=(t.size/1024/1024).toFixed(3);if(console.log(e+"MB"),console.log(t),e>10&&"video/mp4"==t.type)return this.$message.warning("视频文件大小不得超过10MB"),!1;var a=this,i=new FileReader;i.readAsDataURL(t),i.onload=function(e){var s=i.result;a.imgVideoBase64List.push({uid:t.uid,base64:s})}},handleSuccessMainGraph:function(t,e,a){this.imageUrlList=a},handlePreviewMainGraph:function(t){this.imageUrl.type=t.raw.type,this.imageUrl.url=t.url,console.log(t),this.dialogVisibleMainGraph=!0,this.$refs.primary2.start()},beforeremoveMainGraph:function(t,e){},handleRemoveMainGraph:function(t,e){console.log(t.uid);for(var a=0;a<this.imgVideoBase64List.length;a++){this.imgVideoBase64List[a].uid===t.uid&&this.imgVideoBase64List.splice(a,1)}console.log(this.imgVideoBase64List)},RowClick:function(t){console.log(t),this.X=t,this.Want.DeviceId=t.Id,this.$refs.primary.start()},func:function(t,e){this.pageNum=e,this.select2()},eacrh:function(){console.log(this.searchHeader),this.pageNum=1,this.search=this.searchHeader,this.select2()},submitForm:function(){return console.log(this.Want),""===this.Want.CustomerId?(this.$message.warning("请选择客户！"),!1):""===this.Want.RepairName?(this.$message.warning("请选择报修人！"),!1):""===this.Want.RepairNameEn?(this.$message.warning("请输入报修人英文名！"),!1):""===this.Want.MobilePhone?(this.$message.warning("请输入报修人手机号！"),!1):""===this.Want.Email?(this.$message.warning("请输入报修人邮箱！"),!1):""===this.Want.AddressDetail?(this.$message.warning("请输入详细地址！"),!1):""===this.Want.DeviceId?(this.$message.warning("请选择客户设备！"),!1):""===this.Want.FaultDescription?(this.$message.warning("请输入故障描述"),!1):void this.CreateMC()},CreateMC:function(){var t=this,e={api:"post",url:this.$store.state.http+"WO/CusApplyRepair",data:this.Want};this.$https(e).then(function(e){t.res=e,0==t.imgVideoBase64List.length?(
//!没上传直接跳转到列表
t.$store.state.Vuex.Id=t.res.Data,t.$router.push({path:"/RepairDetails"})):(t.loading=!0,t.UpImgVideoId=e.Data,t.IfImgVideoMB())})},IfImgVideoMB:function(){this.UpImgVideo(this.imgVideoBase64List[this.UpFileDataLength].base64)},UpImgVideo:function(t){var e=this,a=t.split("base64")[0],i={api:"post",url:this.$store.state.http+"WO/UploadRepairImage",data:{Id:this.UpImgVideoId,FileStr:t,Type:a.split("video/mp4").length}};this.$https(i).then(function(t){e.UpFileDataLength+1==e.imgVideoBase64List.length?(console.log("上传完成！"),e.$store.state.Vuex.Id=e.res.Data,e.$router.push({path:"/RepairDetails"})):(e.UpFileDataLength+=1,e.IfImgVideoMB())})},select2:function(){var t=this;if(""===this.Want.CustomerId)return this.$message.warning("请先选择客户！"),!1;var e={api:"GET",url:this.$store.state.http+"CRM/GetCustomerEqus",data:{pageNum:this.pageNum,numPerPage:10,orderField:"",orderDirection:"",search:this.search,cusId:this.Want.CustomerId,onlyhavesn:1,sourceId:"",otherType:""}};this.$https(e).then(function(e){console.log(e),t.gridData=e.Data.Dtos,t.total=e.Data.DataBars})},select:function(){var t=this;if(""===this.Want.CustomerId)return this.$message.warning("请先选择客户！"),!1;var e={api:"GET",url:this.$store.state.http+"CRM/GetCustomerEqus",data:{pageNum:this.pageNum,numPerPage:10,orderField:"",orderDirection:"",search:this.search,cusId:this.Want.CustomerId,onlyhavesn:1,sourceId:"",otherType:""}};this.$https(e).then(function(e){console.log(e),t.gridData=e.Data.Dtos,t.total=e.Data.DataBars}),this.$refs.primary.start()},querySearchs:function(t,e){if(""==this.Want.CustomerId)return!1;var a={data:{cusId:this.Want.CustomerId},api:"get",url:this.$store.state.http+"CRM/GetCusLinkManMini",header:this.$store.state.token};this.$https(a).then(function(t){console.log(t.Data.Dtos);if(0==t.Data.Dtos.length)return e([]),!1;for(var a=0;a<t.Data.Dtos.length;a++)t.Data.Dtos[a].value=t.Data.Dtos[a].Name;e(t.Data.Dtos)})},querySearch:function(t,e){if(console.log(t),void 0==t)return t="",!1;""==t&&(t="北京");var a={data:{search:t},api:"get",url:this.$store.state.http+"CRM/GetCustomerMini",header:this.$store.state.token};this.$https(a).then(function(t){console.log(t.Data.Dtos);if(0==t.Data.Dtos.length)return e([]),!1;for(var a=0;a<t.Data.Dtos.length;a++)t.Data.Dtos[a].value=t.Data.Dtos[a].FullName;e(t.Data.Dtos)})},handleSelects:function(t){console.log(t),this.Want.RepairName=t.Name,this.Want.RepairNameEn=t.NameEn,this.Want.MobilePhone=t.Mobile,this.Want.Tel=t.Tel,this.Want.Email=t.Email,this.Want.AddressDetail=t.Address},handleSelect:function(t){console.log(t),this.Want.CustomerId=t.CusId}}},s={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"box  managementHTbox_s",attrs:{"element-loading-text":"努力创建中 ···"}},[a("div",{staticClass:"select"},[a("el-autocomplete",{staticClass:"inline-input",staticStyle:{width:"500px"},attrs:{size:"mini","show-overflow-tooltip":!0,"fetch-suggestions":t.querySearch,placeholder:"请选择客户",clearable:""},on:{select:t.handleSelect},model:{value:t.Want.FullName,callback:function(e){t.$set(t.Want,"FullName",e)},expression:"Want.FullName"}},[a("template",{slot:"prepend"},[t._v("选择客户")])],2)],1),t._v(" "),a("div",{staticClass:"select"},[a("el-autocomplete",{staticClass:"inline-input",staticStyle:{width:"500px"},attrs:{size:"mini","show-overflow-tooltip":!0,"fetch-suggestions":t.querySearchs,placeholder:"请选择联系人",clearable:""},on:{select:t.handleSelects},model:{value:t.Want.RepairName,callback:function(e){t.$set(t.Want,"RepairName",e)},expression:"Want.RepairName"}},[a("template",{slot:"prepend"},[t._v("联 系 人")])],2)],1),t._v(" "),a("div",{staticClass:"select"},[a("el-input",{staticStyle:{width:"500px"},attrs:{placeholder:"请输入英文名",prop:"Mobile",size:"mini"},model:{value:t.Want.RepairNameEn,callback:function(e){t.$set(t.Want,"RepairNameEn",e)},expression:"Want.RepairNameEn"}},[a("template",{slot:"prepend"},[t._v("英 文 名")])],2)],1),t._v(" "),a("div",{staticClass:"select"},[a("el-input",{staticStyle:{width:"500px"},attrs:{placeholder:"请输入手机",prop:"Mobile",size:"mini"},model:{value:t.Want.MobilePhone,callback:function(e){t.$set(t.Want,"MobilePhone",e)},expression:"Want.MobilePhone"}},[a("template",{slot:"prepend"},[t._v("手   机")])],2)],1),t._v(" "),a("div",{staticClass:"select"},[a("el-input",{staticStyle:{width:"500px"},attrs:{placeholder:"请输入电话",prop:"Mobile",size:"mini"},model:{value:t.Want.Tel,callback:function(e){t.$set(t.Want,"Tel",e)},expression:"Want.Tel"}},[a("template",{slot:"prepend"},[t._v("电   话")])],2)],1),t._v(" "),a("div",{staticClass:"select"},[a("el-input",{staticStyle:{width:"500px"},attrs:{placeholder:"请输入邮箱",prop:"Mobile",size:"mini"},model:{value:t.Want.Email,callback:function(e){t.$set(t.Want,"Email",e)},expression:"Want.Email"}},[a("template",{slot:"prepend"},[t._v("邮   箱")])],2)],1),t._v(" "),a("div",{staticClass:"select"},[a("el-input",{staticStyle:{width:"500px"},attrs:{placeholder:"请输入详细地址",prop:"Mobile",size:"mini"},model:{value:t.Want.AddressDetail,callback:function(e){t.$set(t.Want,"AddressDetail",e)},expression:"Want.AddressDetail"}},[a("template",{slot:"prepend"},[t._v("详细地址")])],2)],1),t._v(" "),a("div",{staticClass:"textNB"},[a("div",{staticClass:"textBZ",staticStyle:{cursor:"pointer"},on:{click:function(e){return t.select()}}},[t._v("选择设备")]),t._v(" "),a("el-card",{staticClass:"box-card one"},[a("div",{attrs:{slot:"header"},slot:"header"},[a("div",{staticClass:"Tit"},[a("span",[t._v(t._s(t.X.ProdcutCode||"未选择"))])])]),t._v(" "),a("div",{staticClass:"bot"},[a("p",{staticStyle:{fontSize:"12px"}},[t._v(t._s(t.X.Desc||"未选择"))])])])],1),t._v(" "),a("div",{staticClass:"textNB"},[a("div",{staticClass:"textBZ"},[t._v("故障描述")]),t._v(" "),a("el-input",{staticStyle:{float:"left",width:"500px"},attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"故障描述"},model:{value:t.Want.FaultDescription,callback:function(e){t.$set(t.Want,"FaultDescription",e)},expression:"Want.FaultDescription"}})],1),t._v(" "),a("div",{staticClass:"textNB"},[a("div",{staticClass:"textBZ"},[t._v("客户备注")]),t._v(" "),a("el-input",{staticStyle:{float:"left",width:"500px"},attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"客户备注"},model:{value:t.Want.CustomerRemark,callback:function(e){t.$set(t.Want,"CustomerRemark",e)},expression:"Want.CustomerRemark"}})],1),t._v(" "),a("div",{staticClass:"textNB"},[a("el-upload",{attrs:{action:t.uploadFileUrlapp,data:{attachType:0},name:"appFile",limit:10,multiple:!0,accept:"image/*,video/*","before-upload":t.beforeuploadMainGraph,"on-success":t.handleSuccessMainGraph,"on-preview":t.handlePreviewMainGraph,"before-remove":t.beforeremoveMainGraph,"on-remove":t.handleRemoveMainGraph,"list-type":"picture-card","file-list":t.imageUrlList}},[a("i",{staticClass:"el-icon-plus spc1"})]),t._v(" "),a("saxo-pop",{ref:"primary2",attrs:{type:"primary",title:"查看图片",width:"500px"},on:{close:function(e){return t.$refs.primary2.start()}}},["video/mp4"!=t.imageUrl.type?a("img",{attrs:{width:"100%",src:t.imageUrl.url,alt:""}}):t._e(),t._v(" "),"video/mp4"==t.imageUrl.type?a("video",{staticClass:"avatar video-avatar",attrs:{src:t.imageUrl.url,controls:"controls"}},[t._v("\n        您的浏览器不支持视频播放\n      ")]):t._e()])],1),t._v(" "),a("div",{staticClass:"bottom_but"},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.submitForm()}}},[t._v("立即创建")])],1),t._v(" "),a("saxo-pop",{ref:"primary",attrs:{type:"primary",title:"选择设备",width:"800px",height:"400px"},on:{close:function(e){return t.$refs.primary.start()}}},[a("el-table",{staticStyle:{marginBottom:"20px"},attrs:{data:t.gridData},on:{"row-click":t.RowClick}},[a("el-table-column",{attrs:{property:"SN",label:"SN",width:"150","show-overflow-tooltip":!0}}),t._v(" "),a("el-table-column",{attrs:{property:"Brand",label:"品牌",width:"130","show-overflow-tooltip":!0}}),t._v(" "),a("el-table-column",{attrs:{property:"ProdcutCode",label:"产品编码",width:"150","show-overflow-tooltip":!0}}),t._v(" "),a("el-table-column",{attrs:{align:"right","show-overflow-tooltip":!0},scopedSlots:t._u([{key:"header",fn:function(e){return[a("el-input",{attrs:{size:"mini",placeholder:"输入关键字搜索"},on:{input:function(a){return t.eacrh(e.row)}},model:{value:t.searchHeader,callback:function(e){t.searchHeader=e},expression:"searchHeader"}})]}},{key:"default",fn:function(e){return[a("p",{staticStyle:{textAlign:"left"}},[t._v(t._s(e.row.Desc))])]}}])})],1),t._v(" "),a("div",{staticClass:"pagetion",staticStyle:{marginTop:"0px",height:"50px"}},[a("SaxoFenYe",{attrs:{total:t.total},on:{func:t.func}})],1)],1)],1)},staticRenderFns:[]};var o=a("VU/8")(i,s,!1,function(t){a("+UMX")},"data-v-213321a9",null);e.default=o.exports},"+UMX":function(t,e){}});